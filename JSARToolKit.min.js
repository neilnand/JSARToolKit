if(!window)var window={};window.console||(console={log:function(){}}),ASVector=function(a){if(a=a||0,a.length){this.length=a.length;for(var b=0;b<a.length;b++)this[b]=a[b]}else{this.length=a;for(var b=0;a>b;b++)this[b]=0}},ASVector.prototype={},ASVector.prototype.set=function(a,b){a.length?ASVector.call(this,a):this[a]=b},"undefined"==typeof Float32Array?(FloatVector=ASVector,IntVector=ASVector,UintVector=ASVector):(FloatVector=Float32Array,IntVector=Int32Array,UintVector=Uint32Array),toInt=Math.floor,Object.extend=function(a,b){for(var c in b)try{a[c]=b[c]}catch(d){}return a},toArray=function(a){for(var b=new Array(a.length),c=0;c<a.length;c++)b[c]=a[c];return b},Klass=function(){var a=function(){this.initialize&&this.initialize.apply(this,arguments)};a.ancestors=toArray(arguments),a.prototype={};for(var b=0;b<arguments.length;b++){var c=arguments[b];c.prototype?Object.extend(a.prototype,c.prototype):Object.extend(a.prototype,c)}return Object.extend(a,a.prototype),a},Object.asCopy=function(a){if("object"!=typeof a)return a;if(a instanceof FloatVector){for(var b=new FloatVector(a.length),c=0;c<b.length;c++)b[c]=a[c];return b}if(a instanceof IntVector){for(var b=new IntVector(a.length),c=0;c<b.length;c++)b[c]=a[c];return b}if(a instanceof UintVector){for(var b=new UintVector(a.length),c=0;c<b.length;c++)b[c]=a[c];return b}if(a instanceof Array)return a.map(Object.asCopy);var d={};for(var c in a){var b=a[c];"object"==typeof b&&(b=Object.asCopy(b)),d[c]=b}return d},ASKlass=function(a){var b=function(){for(var a=this.__copyObjects__,b=0;b<a.length;b++)this[a[b]]=Object.asCopy(this[a[b]]);this.initialize&&this.initialize.apply(this,arguments)};b.ancestors=toArray(arguments).slice(1),b.prototype={};for(var c=1;c<arguments.length;c++){var d=arguments[c];d.prototype?Object.extend(b.prototype,d.prototype):Object.extend(b.prototype,d)}b.prototype.className=a,b.prototype.initialize=b.prototype[a],b.prototype.__copyObjects__=[];for(var c in b.prototype){var e=b.prototype[c];"__copyObjects__"!=c&&"object"==typeof e&&b.prototype.__copyObjects__.push(c)}return Object.extend(b,b.prototype),b},BitmapData=Klass({initialize:function(a,b,c,d){this.width=a,this.height=b,this.transparent=null==c?!0:c,this.fill=null==d?4294967295:d,this.data=new UintVector(a*b);for(var e=0;e<this.data.length;e++)this.data[e]=d;this.rect=new Rectangle(0,0,this.width,this.height)},fillRect:function(a,b){for(var c=this.width,d=Math.clamp(a.y,0,this.height)*c,e=Math.clamp(a.y+a.height,0,this.height)*c,f=Math.clamp(a.x,0,this.width),g=Math.clamp(a.x+a.width,0,this.width),h=this.data,i=d;e>i;i+=c)for(var j=f;g>j;j++)h[i+j]=b},getPixel32:function(a,b){return this.data[b*this.width+a]},setPixel32:function(a,b,c){return this.data[b*this.width+a]=c},getPixel:function(a,b){return 16777215&this.data[b*this.width+a]},setPixel:function(a,b,c){return this.data[b*this.width+a]=c|4278190080&this.data[b*this.width+a]},getWidth:function(){return this.width},getHeight:function(){return this.height},copyPixels:function(a,b,c){for(var d=this.width,e=a.width,f=a.data,g=this.data,h=Math.clamp(c.y,0,this.height)*d,i=Math.clamp(c.y+b.height,0,this.height)*d,j=Math.clamp(c.x,0,this.width),k=Math.clamp(c.x+b.width,0,this.width),l=Math.clamp(b.y,0,a.height)*e,m=Math.clamp(b.y+b.height,0,a.height)*e,n=Math.clamp(b.x,0,a.width),o=Math.clamp(b.x+b.width,0,a.width),p=l,q=h;m>p&&i>q;p+=e,q+=d)for(var r=n,s=j;o>r&&k>s;r++,s++)g[q+s]=f[p+r]},getColorBoundsRect:function(a,b,c){return c?this.getColorBoundsRect_true(a,b):this.getColorBoundsRect_false(a,b)},getColorBoundsRect_true:function(a,b){var c=this.width,d=this.height,e=0,f=0,g=this.width;h=this.height;var i=this.data,j=0,k=0;a:for(var l=0;l<h;l++){k=l*g-1;for(var m=0;g>m;m++)if(j=(i[++k]&a)-b,!j){c=e=m,d=f=l;break a}}a:for(var l=h-1;l>d;l--){k=l*g-1;for(var m=0;g>m;m++)if(j=(i[++k]&a)-b,!j){c>m&&(c=m),m>e&&(e=m),f=l;break a}}for(var l=d;f>=l;l++){k=l*g-1;for(var m=0;c>m;m++)if(j=(i[++k]&a)-b,!j){c=m;break}k=l*g+g;for(var m=g-1;m>e;m--)if(j=(i[--k]&a)-b,!j){e=m;break}}return new Rectangle(c,d,Math.max(0,e-c),Math.max(0,f-d))},getColorBoundsRect_false:function(a,b){var c=this.width,d=this.height,e=0,f=0,g=this.width;h=this.height;var i=this.data;a:for(var j=0;j<h;j++)for(var k=0;g>k;k++){var l=(i[j*g+k]&a)-b;if(l){c=e=k,d=f=j;break a}}a:for(var j=h-1;j>d;j--)for(var k=0;g>k;k++){var l=(i[j*g+k]&a)-b;if(l){c>k&&(c=k),k>e&&(e=k),f=j;break a}}for(var j=d;f>=j;j++){for(var k=0;c>k;k++){var l=(i[j*g+k]&a)-b;if(l){c=k;break}}for(var k=h-1;k>e;k--){var l=(i[j*g+k]&a)-b;if(l){e=k;break}}}return new Rectangle(c,d,Math.max(0,e-c),Math.max(0,f-d))},putImageData:function(a,b,c,d,e){d=Math.clamp(d,0,a.width),e=Math.clamp(e,0,a.height);for(var f=this.width,g=this.data,h=a.data,c=Math.clamp(c,0,this.height)*f,i=Math.clamp(c+e,0,this.height)*f,b=Math.clamp(b,0,this.width),j=Math.clamp(b+d,0,this.width),k=c,l=0;i>k;k+=f,l+=4*a.width)for(var m=b,n=0;j>m;m++,n+=4)g[k+m]=h[l+n]<<16|h[l+n+1]<<8|h[l+n+2]|h[l+n+3]<<24},drawCanvas:function(a,b,c,d,e){this.putImageData(a.getContext("2d").getImageData(0,0,d,e),b,c,d,e)},drawOnCanvas:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,this.width,this.height),d=this.width,e=this.height*d,f=this.data,g=c.data,h=0;e>h;h+=d)for(var i=0;d>i;i++){var j=4*(h+i),k=f[h+i];g[j]=k>>16&255,g[++j]=k>>8&255,g[++j]=255&k,g[++j]=k>>24&255}b.putImageData(c,0,0)},floodFill:function(a,b,c){var d=0,e=0,f=0,g=0,h=0,i=[],j=this.width,k=this.height,l=this.width,m=this.data;if(h=m[b*l+a],!(h==c||0>a||a>=j||0>b||b>=k))for(i.push([b,a,a,1]),i.push([b+1,a,a,-1]);i.length>0;){var n=i.pop();for(b=n[0]+n[3],e=n[1],f=n[2],g=n[3],a=e;a>=0&&m[b*l+a]==h;a--)m[b*l+a]=c;if(e>a){for(d=a+1,e>d&&i.push([b,d,e-1,-g]),a=e+1;j>a&&m[b*l+a]==h;a++)m[b*l+a]=c;i.push([b,d,a-1,g]),a>f+1&&i.push([b,f+1,a-1,-g])}for(a++;f>=a&&m[b*l+a]!=h;a++);for(d=a;f>=a;){for(;j>a&&m[b*l+a]==h;a++)m[b*l+a]=c;for(i.push([b,d,a-1,g]),a>f+1&&i.push([b,f+1,a-1,-g]),a++;f>=a&&m[b*l+a]!=h;a++);d=a}}}}),Rectangle=Klass({initialize:function(a,b,c,d){this.x=a,this.y=b,this.top=b,this.left=a,this.bottom=b+d,this.right=a+c,this.width=c,this.height=d,this.updateCalc()},updateCalc:function(){this.top=this.y,this.left=this.x,this.bottom=this.y+this.height,this.right=this.x+this.width},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},inflate:function(a,b){this.x-=a,this.y-=b,this.width+=2*a,this.height+=2*b,this.updateCalc()},isEmpty:function(){return this.width<=0&&this.height<=0}}),NyARException=Klass(Error,{initialize:function(a){Error.call(this,a)},trap:function(a){throw new NyARException("trap:"+a)},notImplement:function(){throw new NyARException("Not Implement!")}}),NyAS3Const_Inherited=Klass({}),NyAS3Utils=Klass({assert:function(a,b){if(!a)throw new Error("NyAS3Utils.assert:"+b!=null?b:"")}}),NyARVec=Klass({clm:null,v:null,initialize:function(a){this.v=new FloatVector(a),this.clm=a},getClm:function(){return this.clm},getArray:function(){return this.v}}),NyARMat=Klass({m:null,__matrixSelfInv_nos:null,clm:null,row:null,initialize:function(a,b){this.m=new Array(a);for(var c=0;a>c;c++){this.m[c]=new FloatVector(b);for(var d=0;b>d;d++)this.m[c][d]=0}this.__matrixSelfInv_nos=new FloatVector(a),this.clm=b,this.row=a},getClm:function(){return this.clm},getRow:function(){return this.row},getArray:function(){return this.m},matrixSelfInv:function(){var a,b,c,d,e,f,g,h,i,j=this.m,k=this.row,l=k-1,m=this.__matrixSelfInv_nos;switch(k){case 0:throw new NyARException;case 1:return j[0][0]=1/j[0][0],!0}var n;for(n=0;k>n;n++)m[n]=n;for(e=0,n=0;k>n;n++){a=j[n],g=0;for(var o=n;k>o;o++)g<(h=Math.abs(j[o][0]))&&(g=h,e=o);if(0==g)return!1;for(f=m[e],m[e]=m[n],m[n]=f,b=j[e],d=0;k>d;d++)i=b[d],b[d]=a[d],a[d]=i;for(i=a[0],d=0;l>d;d++)a[d]=a[d+1]/i;for(a[d]=1/i,o=0;k>o;o++)if(o!=n){for(c=j[o],i=c[0],d=0;l>d;d++)c[d]=c[d+1]-i*a[d];c[d]=-i*a[d]}}for(n=0;k>n;n++){for(d=n;k>d&&m[d]!=n;d++);for(m[d]=m[n],o=0;k>o;o++)c=j[o],i=c[d],c[d]=c[n],c[n]=i}return!0}}),ArrayUtils=ASKlass("ArrayUtils",{create2dInt:function(a,b){for(var c=new Array(a),d=0;a>d;d++)c[d]=new IntVector(b);return c},create2dNumber:function(a,b){for(var c=new Array(a),d=0;a>d;d++)c[d]=new FloatVector(b);return c},copyInt:function(a,b,c,d,e){for(var f=0;e>f;f++)c[d+f]=a[b+f]}}),ArrayUtil=ASKlass("ArrayUtil",{createJaggedArray:function(a){for(var b=new Array(a),c=toArray(arguments).slice(1);a--;)b[a]=c.length?this.createJaggedArray.apply(null,c):0;return b},create2d:function(a,b){return this.createJaggedArray(a,b)},create3d:function(a,b,c){return this.createJaggedArray(a,b,c)},copy:function(a,b,c,d,e){for(var f=0;e>f;f++)c[d+f]=a[b+f]}}),FLARException=ASKlass("FLARException",NyARException,{FLARException:function(a){NyARException.initialize.call(this,a||"")},trap:function(a){throw new FLARException("trap:"+a)},notImplement:function(){throw new FLARException("Not Implement!")}}),FLARMat=NyARMat,FLARRgbPixelReader_BitmapData=ASKlass("FLARRgbPixelReader_BitmapData",{_ref_bitmap:null,FLARRgbPixelReader_BitmapData:function(a){this._ref_bitmap=a},getPixel:function(a,b,c){var d=this._ref_bitmap.getPixel(a,b);c[0]=d>>16&255,c[1]=d>>8&255,c[2]=255&d},getPixelSet:function(a,b,c,d){var e,f,g=this._ref_bitmap;for(f=0;c>f;f++)e=g.getPixel(a[f],b[f]),d[3*f+0]=e>>16&255,d[3*f+1]=e>>8&255,d[3*f+2]=255&e},setPixel:function(a,b,c){NyARException.notImplement()},setPixels:function(a,b,c,d){NyARException.notImplement()},switchBuffer:function(a){NyARException.notImplement()}}),FLARGrayPixelReader_BitmapData=ASKlass("FLARGrayPixelReader_BitmapData",{_ref_bitmap:null,FLARGrayPixelReader_BitmapData:function(a){this._ref_bitmap=a},getPixel:function(a,b,c,d){NyARException.notImplement();var e=this._ref_bitmap.getWidth(),f=this._ref_bitmap.getBuffer();d[0]=d[1]=d[2]=255&~f(a+e*b)},getPixelSet:function(a,b,c,d){for(var e=this._ref_bitmap.getWidth(),f=this._ref_bitmap.data,g=0;c>g;g++)d[g]=255&~f[a[g]+e*b[g]]},setPixel:function(a,b,c){NyARException.notImplement()},setPixels:function(a,b,c,d){NyARException.notImplement()},switchBuffer:function(a){NyARException.notImplement()}}),INyARHistogramAnalyzer_Threshold=ASKlass("INyARHistogramAnalyzer_Threshold",{getThreshold:function(a){}}),NyARHistogramAnalyzer_SlidePTile=ASKlass("NyARHistogramAnalyzer_SlidePTile",INyARHistogramAnalyzer_Threshold,{_persentage:0,NyARHistogramAnalyzer_SlidePTile:function(a){NyAS3Utils.assert(a>=0&&50>=a),this._persentage=a},getThreshold:function(a){var b,c,d,e=a.length,f=a.total_of_data,g=a.data,h=f*this._persentage/100;for(b=h,d=0;e-2>d&&(b-=g[d],!(0>=b));d++);for(b=h,c=e-1;c>1&&(b-=g[c],!(0>=b));c--);return(c+d)/2}}),INyARPca2d=ASKlass("INyARPca2d",{pca:function(a,b,c,d,e,f){}}),NyARPca2d_MatrixPCA_O2=ASKlass("NyARPca2d_MatrixPCA_O2",INyARPca2d,{PCA_EPS:1e-6,PCA_MAX_ITER:100,PCA_VZERO:1e-16,PCA_QRM:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;j=a.m00,i=a.m01,k=a.m11,l=o=1,m=n=0;var p=0;do{if(p++,p>this.PCA_MAX_ITER)break;c=(j-k)/2,d=i*i,e=Math.sqrt(c*c+d),0>c&&(e=-e),f=j-k+d/(c+e),g=i,Math.abs(f)>=Math.abs(g)?Math.abs(f)>this.PCA_VZERO?(d=-g/f,h=1/Math.sqrt(d*d+1),e=d*h):(h=1,e=0):(d=-f/g,e=1/Math.sqrt(d*d+1),h=d*e),c=j-k,d=(c*e+2*h*i)*e,j-=d,k+=d,i+=e*(h*c-2*e*i),f=l,g=n,l=h*f-e*g,n=e*f+h*g,f=m,g=o,m=h*f-e*g,o=e*f+h*g}while(Math.abs(i)>this.PCA_EPS*(Math.abs(j)+Math.abs(k)));d=j,k>d?(d=k,k=j,j=d,a.m00=n,a.m01=o,a.m10=l,a.m11=m):(a.m00=l,a.m01=m,a.m10=n,a.m11=o),b[0]=j,b[1]=k},PCA_PCA:function(a,b,c,d,e,f){var g,h=0,i=0;for(g=0;c>g;g++)h+=a[g],i+=b[g];h/=c,i/=c;var j,k,l,m=Math.sqrt(c);for(j=k=l=0,g=0;c>g;g++){var n=(a[g]-h)/m,o=(b[g]-i)/m;j+=n*n,l+=n*o,k+=o*o}d.m00=j,d.m01=d.m10=l,d.m11=k,this.PCA_QRM(d,e),e[0]<this.PCA_VZERO&&(e[0]=0,d.m00=0,d.m01=0),e[1]<this.PCA_VZERO&&(e[1]=0,d.m10=0,d.m11=0),f[0]=h,f[1]=i},pca:function(a,b,c,d,e,f){this.PCA_PCA(a,b,c,d,e,f);var g=e[0]+e[1];e[0]/=g,e[1]/=g}}),INyARRgbPixelReader=ASKlass("INyARRgbPixelReader",{getPixel:function(a,b,c){},getPixelSet:function(a,b,c,d){},setPixel:function(a,b,c){},setPixels:function(a,b,c,d){},switchBuffer:function(a){}}),NyARRgbPixelReader_INT1D_X8R8G8B8_32=ASKlass("NyARRgbPixelReader_INT1D_X8R8G8B8_32",INyARRgbPixelReader,{_ref_buf:null,_size:null,NyARRgbPixelReader_INT1D_X8R8G8B8_32:function(a,b){this._ref_buf=a,this._size=b},getPixel:function(a,b,c){var d=this._ref_buf[a+b*this._size.w];c[0]=d>>16&255,c[1]=d>>8&255,c[2]=255&d},getPixelSet:function(a,b,c,d){for(var e=this._size.w,f=this._ref_buf,g=c-1;g>=0;g--){var h=f[a[g]+b[g]*e];d[3*g+0]=h>>16&255,d[3*g+1]=h>>8&255,d[3*g+2]=255&h}},setPixel:function(a,b,c){this._ref_buf[a+b*this._size.w]=c[0]<<16&255|c[1]<<8&255|255&c[2]},setPixels:function(a,b,c,d){throw new NyARException},switchBuffer:function(a){NyAS3Utils.assert(a.length>=this._size.w*this._size.h),this._ref_buf=a}}),NyARRgbPixelReader_Canvas2D=ASKlass("NyARRgbPixelReader_Canvas2D",INyARRgbPixelReader,{_ref_canvas:null,_data:null,NyARRgbPixelReader_Canvas2D:function(a){this._ref_canvas=a},getData:function(){if(this._ref_canvas.changed||!this._data){var a=this._ref_canvas,b=a.getContext("2d");this._data=b.getImageData(0,0,a.width,a.height),this._ref_canvas.changed=!1}return this._data},getPixel:function(a,b,c){var d=this.getData(),e=d.width,f=(d.height,d.data);c[0]=f[b*e+a],c[1]=f[b*e+a+1],c[2]=f[b*e+a+2]},getPixelSet:function(a,b,c,d){for(var e=this.getData(),f=e.width,g=(e.height,e.data),h=0;c>h;h++){var i=b[h]*f*4+4*a[h];d[3*h+0]=g[i+0],d[3*h+1]=g[i+1],d[3*h+2]=g[i+2]}},setPixel:function(a,b,c){NyARException.notImplement()},setPixels:function(a,b,c,d){NyARException.notImplement()},switchBuffer:function(a){NyARException.notImplement()}}),INyARDoubleMatrix=Klass({setValue:function(a){},getValue:function(a){}}),NyARDoubleMatrix22=Klass(INyARDoubleMatrix,{m00:0,m01:0,m10:0,m11:0,setValue:function(a){this.m00=a[0],this.m01=a[1],this.m10=a[3],this.m11=a[4]},getValue:function(a){a[0]=this.m00,a[1]=this.m01,a[3]=this.m10,a[4]=this.m11},inverse:function(a){var b,c,d,e;b=a.m00,c=a.m01,d=a.m10,e=a.m11;var f=b*e-c*d;return 0==f?!1:(f=1/f,this.m00=e*f,this.m01=-c*f,this.m10=-d*f,this.m11=b*f,!0)}}),NyARDoubleMatrix33=Klass(INyARDoubleMatrix,{m00:0,m01:0,m02:0,m10:0,m11:0,m12:0,m20:0,m21:0,m22:0,createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARDoubleMatrix33;return b},setValue:function(a){this.m00=a[0],this.m01=a[1],this.m02=a[2],this.m10=a[3],this.m11=a[4],this.m12=a[5],this.m20=a[6],this.m21=a[7],this.m22=a[8]},setValue_NyARDoubleMatrix33:function(a){this.m00=a.m00,this.m01=a.m01,this.m02=a.m02,this.m10=a.m10,this.m11=a.m11,this.m12=a.m12,this.m20=a.m20,this.m21=a.m21,this.m22=a.m22},getValue:function(a){a[0]=this.m00,a[1]=this.m01,a[2]=this.m02,a[3]=this.m10,a[4]=this.m11,a[5]=this.m12,a[6]=this.m20,a[7]=this.m21,a[8]=this.m22},inverse:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;b=a.m00,c=a.m01,d=a.m02,e=a.m10,f=a.m11,g=a.m12,h=a.m20,i=a.m21,j=a.m22,k=f*j-g*i,l=i*d-j*c,m=c*g-d*f,n=g*h-e*j,o=j*b-h*d,p=d*e-b*g,q=e*i-f*h,r=h*c-i*b,s=b*f-c*e;var t=b*k+e*l+h*m;return 0==t?!1:(t=1/t,this.m00=k*t,this.m01=l*t,this.m02=m*t,this.m10=n*t,this.m11=o*t,this.m12=p*t,this.m20=q*t,this.m21=r*t,this.m22=s*t,!0)},getZXYAngle:function(a){var b=this.m21;b>=1?(a.x=Math.PI/2,a.y=0,a.z=Math.atan2(-this.m10,this.m00)):-1>=b?(a.x=-Math.PI/2,a.y=0,a.z=Math.atan2(-this.m10,this.m00)):(a.x=Math.asin(b),a.z=Math.atan2(-this.m01,this.m11),a.y=Math.atan2(-this.m20,this.m22))},setZXYAngle_NyARDoublePoint3d:function(a){this.setZXYAngle_Number(a.x,a.y,a.z)},setZXYAngle_Number:function(a,b,c){var d=Math.sin(a),e=Math.cos(a),f=Math.sin(b),g=Math.cos(b),h=Math.sin(c),i=Math.cos(c);this.m00=i*g-h*d*f,this.m01=-h*e,this.m02=i*f+h*d*g,this.m10=h*g+i*d*f,this.m11=i*e,this.m12=h*f-i*d*g,this.m20=-e*f,this.m21=d,this.m22=g*e},transformVertex_NyARDoublePoint3d:function(a,b){transformVertex_double(a.x,a.y,a.z,b)},transformVertex_double:function(a,b,c,d){d.x=this.m00*a+this.m01*b+this.m02*c,d.y=this.m10*a+this.m11*b+this.m12*c,d.z=this.m20*a+this.m21*b+this.m22*c}}),NyARDoubleMatrix34=Klass(INyARDoubleMatrix,{m00:0,m01:0,m02:0,m03:0,m10:0,m11:0,m12:0,m13:0,m20:0,m21:0,m22:0,m23:0,setValue:function(a){this.m00=a[0],this.m01=a[1],this.m02=a[2],this.m03=a[3],this.m10=a[4],this.m11=a[5],this.m12=a[6],this.m13=a[7],this.m20=a[8],this.m21=a[9],this.m22=a[10],this.m23=a[11]},setValue_NyARDoubleMatrix34:function(a){this.m00=a.m00,this.m01=a.m01,this.m02=a.m02,this.m03=a.m03,this.m10=a.m10,this.m11=a.m11,this.m12=a.m12,this.m13=a.m13,this.m20=a.m20,this.m21=a.m21,this.m22=a.m22,this.m23=a.m23},getValue:function(a){a[0]=this.m00,a[1]=this.m01,a[2]=this.m02,a[3]=this.m03,a[4]=this.m10,a[5]=this.m11,a[6]=this.m12,a[7]=this.m13,a[8]=this.m20,a[9]=this.m21,a[10]=this.m22,a[11]=this.m23}}),NyARDoubleMatrix44=Klass(INyARDoubleMatrix,{m00:0,m01:0,m02:0,m03:0,m10:0,m11:0,m12:0,m13:0,m20:0,m21:0,m22:0,m23:0,m30:0,m31:0,m32:0,m33:0,createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARDoubleMatrix44;return b},setValue:function(a){this.m00=a[0],this.m01=a[1],this.m02=a[2],this.m03=a[3],this.m10=a[4],this.m11=a[5],this.m12=a[6],this.m13=a[7],this.m20=a[8],this.m21=a[9],this.m22=a[10],this.m23=a[11],this.m30=a[12],this.m31=a[13],this.m32=a[14],this.m33=a[15]},getValue:function(a){a[0]=this.m00,a[1]=this.m01,a[2]=this.m02,a[3]=this.m03,a[4]=this.m10,a[5]=this.m11,a[6]=this.m12,a[7]=this.m13,a[8]=this.m20,a[9]=this.m21,a[10]=this.m22,a[11]=this.m23,a[12]=this.m30,a[13]=this.m31,a[14]=this.m32,a[15]=this.m33},inverse:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;b=a.m00,c=a.m01,d=a.m02,e=a.m03,f=a.m10,g=a.m11,h=a.m12,i=a.m13,j=a.m20,k=a.m21,l=a.m22,m=a.m23,n=a.m30,o=a.m31,p=a.m32,q=a.m33,H=l*q-m*p,I=m*o-k*q,J=k*p-l*o,K=m*n-j*q,L=j*p-l*n,M=j*o-k*n,r=g*H+h*I+i*J,v=-(h*K+i*L+f*H),z=i*M-f*I+g*K,D=-(f*J-g*L+h*M),H=p*e-q*d,I=q*c-o*e,J=o*d-p*c,K=q*b-n*e,L=n*d-p*b,M=n*c-o*b,s=-(k*H+l*I+m*J),w=l*K+m*L+j*H,A=-(m*M-j*I+k*K),E=j*J-k*L+l*M,H=d*i-e*h,I=e*g-c*i,J=c*h-d*g,K=e*f-b*i,L=b*h-d*f,M=b*g-c*f,t=o*H+p*I+q*J,x=-(p*K+q*L+n*H),B=q*M-n*I+o*K,F=-(n*J-o*L+p*M),H=h*m-i*l,I=i*k-g*m,J=g*l-h*k,K=i*j-f*m,L=f*l-h*j,M=f*k-g*j,u=-(c*H+d*I+e*J),y=d*K+e*L+b*H,C=-(e*M-b*I+c*K),G=b*J-c*L+d*M;var N=b*r+f*s+j*t+n*u;return 0==N?!1:(N=1/N,this.m00=r*N,this.m01=s*N,this.m02=t*N,this.m03=u*N,this.m10=v*N,this.m11=w*N,this.m12=x*N,this.m13=y*N,this.m20=z*N,this.m21=A*N,this.m22=B*N,this.m23=C*N,this.m30=D*N,this.m31=E*N,this.m32=F*N,this.m33=G*N,!0)}}),NyARObjectStack=Klass({_items:null,_length:0,initialize:function(a){a=toInt(a),this._items=this.createArray(a),this._length=0},createArray:function(a){throw new NyARException},prePush:function(){if(this._length>=this._items.length)return null;var a=this._items[this._length];return this._length++,a},init:function(a){if(a>=this._items.length)throw new NyARException;this._length=a},pop:function(){return NyAS3Utils.assert(this._length>=1),this._length--,this._items[this._length]},pops:function(a){NyAS3Utils.assert(this._length>=a),this._length-=a},getArray:function(){return this._items},getItem:function(a){return this._items[a]},getLength:function(){return this._length},clear:function(){this._length=0}}),NyARIntPointStack=Klass(NyARObjectStack,{initialize:function(a){NyARObjectStack.initialize.call(this,a)},createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARIntPoint2d;return b}}),NyARIntRectStack=Klass({_items:null,_length:null,initialize:function(a){this._items=this.createArray(a),this._length=0},createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARIntRect;return b},prePush:function(){if(this._length>=this._items.length)return null;var a=this._items[this._length];return this._length++,a},init:function(a){if(a>=this._items.length)throw new NyARException;this._length=a},pop:function(){return NyAS3Utils.assert(this._length>=1),this._length--,this._items[this._length]},pops:function(a){NyAS3Utils.assert(this._length>=a),this._length-=a},getArray:function(){return this._items},getItem:function(a){return this._items[a]},getLength:function(){return this._length},clear:function(){this._length=0}}),NyARBufferType=Klass(function(){var a=65536,b=131072,c=196608,d=262144,e=1048576,f=16711680;return{NULL_ALLZERO:1,USER_DEFINE:f,BYTE1D_R8G8B8_24:1|a,BYTE1D_B8G8R8_24:2|a,BYTE1D_B8G8R8X8_32:257|a,BYTE1D_X8R8G8B8_32:258|a,BYTE1D_R5G6B5_16LE:513|a,BYTE1D_R5G6B5_16BE:514|a,WORD1D_R5G6B5_16LE:513|c,WORD1D_R5G6B5_16BE:514|c,INT2D:0|b,INT2D_GRAY_8:1|b,INT2D_BIN_8:2|b,INT1D:0|d,INT1D_GRAY_8:1|d,INT1D_BIN_8:2|d,INT1D_X8R8G8B8_32:258|d,INT1D_X7H9S8V8_32:259|d,OBJECT_Java:256|e,OBJECT_CS:512|e,OBJECT_AS3:768|e,OBJECT_JS:1024|e,OBJECT_Java_BufferedImage:256|e|1,OBJECT_AS3_BitmapData:768|e|1,OBJECT_JS_Canvas:1024|e|1}}()),NyARDoublePoint2d=Klass({x:0,y:0,createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARDoublePoint2d;return b},initialize:function(){switch(arguments.length){case 0:return this.x=0,void(this.y=0);case 1:return this.x=args[0].x,void(this.y=args[0].y);case 2:return this.x=Number(args[0]),void(this.y=Number(args[1]))}throw new NyARException},setValue_NyARDoublePoint2d:function(a){this.x=a.x,this.y=a.y},setValue_NyARIntPoint2d:function(a){this.x=a.x,this.y=a.y},dist:function(){return Math.sqrt(this.x*this.x+this.y+this.y)},sqNorm:function(){return this.x*this.x+this.y+this.y}}),NyARDoublePoint3d=Klass({x:0,y:0,z:0,createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARDoublePoint3d;return b},setValue:function(a){this.x=a.x,this.y=a.y,this.z=a.z},dist:function(a){var b,c,d;return b=this.x-a.x,c=this.y-a.y,d=this.z-a.z,Math.sqrt(b*b+c*c+d*d)}}),NyARHistogram=Klass({data:null,length:0,total_of_data:0,initialize:function(a){this.data=new FloatVector(a),this.length=a,this.total_of_data=0},getTotal:function(a,b){NyAS3Utils.assert(b>a&&b<this.length);for(var c=0,d=this.data,e=a;b>=e;e++)c+=d[e];return c},lowCut:function(a){for(var b=0,c=0;a>c;c++)b+=this.data[c],this.data[c]=0;this.total_of_data-=b},highCut:function(a){for(var b=0,c=this.length-1;c>=a;c--)b+=this.data[c],this.data[c]=0;this.total_of_data-=b},getMinSample:function(){for(var a=this.data,b=this.length-1,c=a[b],d=this.length-2;d>=0;d--)a[d]<c&&(c=a[d],b=d);return b},getMinData:function(){return this.data[this.getMinSample()]},getAverage:function(){for(var a=0,b=this.length-1;b>=0;b--)a+=this.data[b]*b;return toInt(a/this.total_of_data)}}),NyARIntPoint2d=Klass({x:0,y:0,createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARIntPoint2d;return b},copyArray:function(a,b){for(var c=a.length-1;c>=0;c--)b[c].x=a[c].x,b[c].y=a[c].y}}),NyARIntRect=Klass({x:0,y:0,w:0,h:0}),NyARIntSize=Klass({h:0,w:0,initialize:function(){switch(arguments.length){case 0:return this.w=0,void(this.h=0);case 1:return this.w=arguments[0].w,void(this.h=arguments[0].h);case 2:return this.w=toInt(arguments[0]),void(this.h=toInt(arguments[1]))}throw new NyARException},isEqualSize_int:function(a,b){return a==this.w&&b==this.h?!0:!1},isEqualSize_NyARIntSize:function(a){return a.w==this.w&&a.h==this.h?!0:!1}}),NyARLinear=Klass({dx:0,dy:0,c:0,createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARLinear;return b},copyFrom:function(a){this.dx=a.dx,this.dy=a.dy,this.c=a.c},crossPos:function(a,b,c){var d=b.dy*a.dx-a.dy*b.dx;return 0==d?!1:(c.x=(b.dx*a.c-a.dx*b.c)/d,c.y=(a.dy*b.c-b.dy*a.c)/d,!0)}}),IFLdoThFilterImpl=ASKlass("IFLdoThFilterImpl",{doThFilter:function(a,b,c,d){}}),FLARRasterFilter_Threshold=ASKlass("FLARRasterFilter_Threshold",{_threshold:0,_do_threshold_impl:null,FLARRasterFilter_Threshold:function(a){},setThreshold:function(a){this._threshold=a},doFilter:function(a,b){NyAS3Utils.assert(a._width==b._width&&a._height==b._height);for(var c=b.getBuffer(),d=a.getRgbPixelReader(),e=d.getData().data,f=c.data,g=1e4*this._threshold,h=0,i=0;h<e.length;h+=4,++i){var j=2989*e[h]+5866*e[h+1]+1145*e[h+2],k=g>=j?4294967295:4278190080;f[i]=k}if(window.DEBUG){var l=document.getElementById("debugCanvas");c.drawOnCanvas(l)}}}),Point=function(a,b){this.x=a||0,this.y=b||0},doThFilterImpl_BUFFERFORMAT_OBJECT_AS_BitmapData={doThFilter:function(a,b,c){for(var d=b.getBuffer(),e=a.getBuffer(),f=e.data,g=d.data,h=0;h<f.length;h++){var i=f[h],k=.2989*(i>>16&255)+.5866*(i>>8&255)+.1145*(255&i),l=c>=k,m=4294967295*l+4278190080*(1-l);g[j]=m}}},FLARDoublePoint2d=NyARDoublePoint2d,FLARDoublePoint3d=NyARDoublePoint3d,FLARIntSize=NyARIntSize,NyARLabelInfo=ASKlass("NyARLabelInfo",{area:0,clip_r:0,clip_l:0,clip_b:0,clip_t:0,pos_x:0,pos_y:0,NyARLabelInfo:function(){}}),NyARLabelInfoStack=ASKlass("NyARLabelInfoStack",{_items:null,_length:0,NyARLabelInfoStack:function(a){this._items=this.createArray(a),this._length=0},createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARLabelInfo;return b},sortByArea:function(){var a=this._length;if(!(1>a))for(var b=Math.floor(13*a/10),c=this._items;;){for(var d=0,e=0;a>e+b;e++)if(c[e+b].area>c[e].area){var f=c[e+b];c[e+b]=c[e],c[e]=f,d++}if(1==b){if(0==d)break}else b=Math.floor(10*b/13)}},prePush:function(){if(this._length>=this._items.length)return null;var a=this._items[this._length];return this._length++,a},init:function(a){if(a>=this._items.length)throw new NyARException;this._length=a},pop:function(){return NyAS3Utils.assert(this._length>=1),this._length--,this._items[this._length]},pops:function(a){NyAS3Utils.assert(this._length>=a),this._length-=a},getArray:function(){return this._items},getItem:function(a){return this._items[a]},getLength:function(){return this._length},clear:function(){this._length=0}}),NyARLabelOverlapChecker=ASKlass("NyARLabelOverlapChecker",{_labels:null,_length:0,NyARLabelOverlapChecker:function(a){this._labels=this.createArray(a)},createArray:function(a){return new Array(a)},push:function(a){this._labels[this._length]=a,this._length++},check:function(a){for(var b=this._labels,c=toInt(a.pos_x),d=toInt(a.pos_y),e=this._length-1;e>=0;e--){var f=toInt(b[e].pos_x),g=toInt(b[e].pos_y),h=(c-f)*(c-f)+(d-g)*(d-g);if(h<b[e].area/4)return!1}return!0},setMaxLabels:function(a){a>this._labels.length&&(this._labels=this.createArray(a)),this._length=0}}),NyARLabeling_Rle=ASKlass("NyARLabeling_Rle",{AR_AREA_MAX:1e5,AR_AREA_MIN:70,_rlestack:null,_rle1:null,_rle2:null,_max_area:0,_min_area:0,NyARLabeling_Rle:function(a,b){this._rlestack=new RleInfoStack(a*b*2048/76800+32),this._rle1=RleElement.createArray(a/2+1),this._rle2=RleElement.createArray(a/2+1),this.setAreaRange(this.AR_AREA_MAX,this.AR_AREA_MIN)},setAreaRange:function(a,b){this._max_area=a,this._min_area=b},toRLE:function(a,b,c,d,e){for(var f=0,g=0,h=1,i=3,j=-1,k=b,l=b+c-1;l>k;)if(4294967295==a[k])for(j=k-b,d[f+g]=j,j++,k++;l>k;){if(4294967295!=a[k]){d[f+h]=j,f+=i,k++,j=-1;break}j++,k++}else k++;return 4294967295!=a[k]?j>=0&&(d[f+h]=j,f+=i):(j>=0?d[f+h]=j+1:(d[f+g]=c-1,d[f+h]=c),f+=i),f/i},addFragment:function(a,b,c,d,e){var f=0,g=1,h=2,i=a[b+f],j=a[b+g],k=j-i;a[b+h]=c;var l=e.prePush();l.entry_x=i,l.area=k,l.clip_l=i,l.clip_r=j-1,l.clip_t=d,l.clip_b=d,l.pos_x=k*(2*i+(k-1))/2,l.pos_y=d*k},labeling_NyARBinRaster:function(a,b,c,d){return NyAS3Utils.assert(a.isEqualBufferType(NyARBufferType.INT1D_BIN_8)),this.imple_labeling(a,0,b,c,d)},labeling_NyARGrayscaleRaster:function(a,b,c,d,e){return NyAS3Utils.assert(a.isEqualBufferType(NyARBufferType.INT1D_GRAY_8)),this.imple_labeling(a,b,c,d,e)},labeling:function(a,b){return this.imple_labeling(a,0,0,a.getHeight(),b)},imple_labeling:function(a,b,c,d,e){var f=this._rlestack;f.clear();var g=this._rle1,h=this._rle2,i=0,j=0,k=a.getWidth(),l=a.getBuffer().data,m=0,n=0,o=0,p=1,q=2,r=3;i=this.toRLE(l,c,k,g,b);var s;for(s=0;i>s;s++)this.addFragment(g,s*r,m,c,f),m++,n++;for(var t=f.getArray(),u=c+1;d>u;u++){j=this.toRLE(l,u*k,k,h,b);var v=0;a:for(s=0;j>s;s++){var w=-1;b:for(;i>v;){if(!(h[s*r+o]-g[v*r+p]>0)){if(g[v*r+o]-h[s*r+p]>0){this.addFragment(h,s*r,m,u,f),m++,n++;continue a}w=g[v*r+q];var x=t[w];h[s*r+q]=w;var y=h[s*r+o],z=h[s*r+p],A=z-y;for(x.area+=A,x.clip_l=y<x.clip_l?y:x.clip_l,x.clip_r=z>x.clip_r?z-1:x.clip_r,x.clip_b=u,x.pos_x+=A*(2*y+(A-1))/2,x.pos_y+=u*A,v++;i>v;){if(h[s*r+o]-g[v*r+p]>0)break b;if(g[v*r+o]-h[s*r+p]>0){v--;continue a}var B=g[v*r+q],C=t[B];if(w!=B){n--;var D;for(D=v;i>D;D++)g[D*r+q]==B&&(g[D*r+q]=w);for(D=0;s>D;D++)h[D*r+q]==B&&(h[D*r+q]=w);x.area+=C.area,x.pos_x+=C.pos_x,x.pos_y+=C.pos_y,x.clip_t>C.clip_t?(x.clip_t=C.clip_t,x.entry_x=C.entry_x):x.clip_t<C.clip_t||x.entry_x>C.entry_x&&(x.entry_x=C.entry_x),x.clip_l>C.clip_l&&(x.clip_l=C.clip_l),x.clip_r<C.clip_r&&(x.clip_r=C.clip_r),C.area=0}v++}v--;break}v++}0>w&&(this.addFragment(h,s*r,m,u,f),m++,n++)}var E=g;g=h,i=j,h=E}e.init(n);var F=e.getArray(),G=this._max_area,H=this._min_area,I=0;for(s=m-1;s>=0;s--){var J=t[s].area;if(!(H>J||J>G)){var K=t[s],L=F[I];L.area=J,L.clip_b=K.clip_b,L.clip_r=K.clip_r,L.clip_t=K.clip_t,L.clip_l=K.clip_l,L.entry_x=K.entry_x,L.pos_x=K.pos_x/K.area,L.pos_y=K.pos_y/K.area,I++}}return e.pops(n-I),I}}),RleInfo=ASKlass("RleInfo",{entry_x:0,area:0,clip_r:0,clip_l:0,clip_b:0,clip_t:0,pos_x:0,pos_y:0}),RleInfoStack=ASKlass("RleInfoStack",NyARObjectStack,{RleInfoStack:function(a){NyARObjectStack.initialize.call(this,a)},createArray:function(a){for(var b=new Array(toInt(a)),c=0;a>c;c++)b[c]=new RleInfo;return b}}),RleElement=ASKlass("RleElement",{l:0,r:0,fid:0,createArray:function(a){return new IntVector(3*toInt(a))}}),NyARRleLabelFragmentInfo=ASKlass("NyARRleLabelFragmentInfo",NyARLabelInfo,{entry_x:0}),NyARRleLabelFragmentInfoStack=ASKlass("NyARRleLabelFragmentInfoStack",NyARLabelInfoStack,{NyARRleLabelFragmentInfoStack:function(a){NyARLabelInfoStack.initialize.call(this,a)},createArray:function(a){for(var b=new Array(toInt(a)),c=0;a>c;c++)b[c]=new NyARRleLabelFragmentInfo;return b}}),FLARLabeling=ASKlass("FLARLabeling",{AR_AREA_MAX:1e5,AR_AREA_MIN:70,ZERO_POINT:new Point,ONE_POINT:new Point(1,1),hSearch:null,hLineRect:null,_tmp_bmp:null,areaMax:0,areaMin:0,FLARLabeling:function(a,b){this._tmp_bmp=new BitmapData(a,b,!1,0),this.hSearch=new BitmapData(a,1,!1,0),this.hLineRect=new Rectangle(0,0,1,1),this.setAreaRange(this.AR_AREA_MAX,this.AR_AREA_MIN)},setAreaRange:function(a,b){this.areaMax=a,this.areaMin=b},labeling:function(a,b){var c=this._tmp_bmp;c.fillRect(c.rect,0);var d=c.rect.clone();d.inflate(-1,-1),c.copyPixels(a.getBuffer(),d,this.ONE_POINT);var e=c.getColorBoundsRect(16777215,16777215,!0),f=this.hLineRect;f.y=0,f.width=c.width;var g,h,i,j=this.hSearch,k=0;for(b.clear();!e.isEmpty();){f.y=e.top,j.copyPixels(c,f,this.ZERO_POINT),g=j.getColorBoundsRect(16777215,16777215,!0),c.floodFill(g.x,f.y,++k),h=c.getColorBoundsRect(16777215,k,!0),i=b.prePush();var l=h.width*h.height;if(l<=this.areaMax&&l>=this.areaMin){if(i.area=l,i.clip_l=h.left,i.clip_r=h.right-1,i.clip_t=h.top,i.clip_b=h.bottom-1,i.pos_x=.5*(h.left+h.right-1),i.pos_y=.5*(h.top+h.bottom-1),i.entry_x=this.getTopClipTangentX(c,k,i),-1==i.entry_x)return-1}else b.pop();e=c.getColorBoundsRect(16777215,16777215,!0)}return b.getLength()},getTopClipTangentX:function(a,b,c){var d,e,f=c.clip_r;for(e=c.clip_l;f>=e;e++)if(d=a.getPixel(e,c.clip_t),d>0&&d==b)return e;return-1}}),INyARCameraDistortionFactor=ASKlass("INyARCameraDistortionFactor",{ideal2Observ:function(a,b){},ideal2ObservBatch:function(a,b,c){},observ2Ideal:function(a,b,c){},observ2IdealBatch:function(a,b,c,d,e,f){}}),NyARCameraDistortionFactor=ASKlass("NyARCameraDistortionFactor",INyARCameraDistortionFactor,{PD_LOOP:3,_f0:0,_f1:0,_f2:0,_f3:0,copyFrom:function(a){this._f0=a._f0,this._f1=a._f1,this._f2=a._f2,this._f3=a._f3},setValue:function(a){this._f0=a[0],this._f1=a[1],this._f2=a[2],this._f3=a[3]},getValue:function(a){a[0]=this._f0,a[1]=this._f1,a[2]=this._f2,a[3]=this._f3},changeScale:function(a){this._f0=this._f0*a,this._f1=this._f1*a,this._f2=this._f2/(a*a)},ideal2Observ:function(a,b){var c=(a.x-this._f0)*this._f3,d=(a.y-this._f1)*this._f3;if(0==c&&0==d)b.x=this._f0,b.y=this._f1;else{var e=1-this._f2/1e8*(c*c+d*d);b.x=c*e+this._f0,b.y=d*e+this._f1}},ideal2ObservBatch:function(a,b,c){for(var d,e,f=this._f0,g=this._f1,h=this._f3,i=this._f2/1e8,j=0;c>j;j++)if(d=(a[j].x-f)*h,e=(a[j].y-g)*h,0==d&&0==e)b[j].x=f,b[j].y=g;else{var k=1-i*(d*d+e*e);b[j].x=d*k+f,b[j].y=e*k+g}},observ2Ideal:function(a,b,c){
var d,e,f,g,h,i,j,k,l=this._f0,m=this._f1;i=a-l,j=b-m,f=this._f2/1e8,d=i*i+j*j,g=e=Math.sqrt(d);for(var n=1;;n++){if(0==e){i=0,j=0;break}if(k=f*d,h=e-((1-k)*e-g)/(1-3*k),i=i*h/e,j=j*h/e,n==this.PD_LOOP)break;d=i*i+j*j,e=Math.sqrt(d)}c.x=i/this._f3+l,c.y=j/this._f3+m},observ2IdealBatch:function(a,b,c,d,e,f){for(var g,h,i,j,k,l,m,n=this._f0,o=this._f1,p=this._f3,q=this._f2/1e8,r=0;d>r;r++){k=a[c+r]-n,l=b[c+r]-o,g=k*k+l*l,i=h=Math.sqrt(g);for(var s=1;;s++){if(0==h){k=0,l=0;break}if(m=q*g,j=h-((1-m)*h-i)/(1-3*m),k=k*j/h,l=l*j/h,s==PD_LOOP)break;g=k*k+l*l,h=Math.sqrt(g)}e[r]=k/p+n,f[r]=l/p+o}}}),NyARObserv2IdealMap=ASKlass("NyARObserv2IdealMap",{_stride:0,_mapx:null,_mapy:null,NyARObserv2IdealMap:function(a,b){var c=new NyARDoublePoint2d;this._mapx=new FloatVector(b.w*b.h),this._mapy=new FloatVector(b.w*b.h),this._stride=b.w;for(var d=b.h*b.w-1,e=b.h-1;e>=0;e--)for(var f=b.w-1;f>=0;f--)a.observ2Ideal(f,e,c),this._mapx[d]=c.x,this._mapy[d]=c.y,d--},observ2Ideal:function(a,b,c){var d=a+b*this._stride;c.x=this._mapx[d],c.y=this._mapy[d]},observ2IdealBatch:function(a,b,c,d,e,f,g){for(var h,i=g,j=this._mapx,k=this._mapy,l=this._stride,m=0;d>m;m++)h=a[c+m]+b[c+m]*l,e[i]=j[h],f[i]=k[h],i++}}),NyARPerspectiveProjectionMatrix=ASKlass("NyARPerspectiveProjectionMatrix",NyARDoubleMatrix34,{dot:function(a,b,c,d,e,f){return a*d+b*e+c*f},norm:function(a,b,c){return Math.sqrt(a*a+b*b+c*c)},decompMat:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;this.m23>=0?(h=this.m00,i=this.m01,j=this.m02,k=this.m03,l=this.m10,m=this.m11,n=this.m12,o=this.m13,p=this.m20,q=this.m21,r=this.m22,s=this.m23):(h=-this.m00,i=-this.m01,j=-this.m02,k=-this.m03,l=-this.m10,m=-this.m11,n=-this.m12,o=-this.m13,p=-this.m20,q=-this.m21,r=-this.m22,s=-this.m23);var t=a.getArray(),u=b.getArray();for(c=0;3>c;c++)for(d=0;4>d;d++)t[c][d]=0;for(t[2][2]=this.norm(p,q,r),u[2][0]=p/t[2][2],u[2][1]=q/t[2][2],u[2][2]=r/t[2][2],u[2][3]=s/t[2][2],t[1][2]=this.dot(u[2][0],u[2][1],u[2][2],l,m,n),e=l-t[1][2]*u[2][0],f=m-t[1][2]*u[2][1],g=n-t[1][2]*u[2][2],t[1][1]=this.norm(e,f,g),u[1][0]=e/t[1][1],u[1][1]=f/t[1][1],u[1][2]=g/t[1][1],t[0][2]=this.dot(u[2][0],u[2][1],u[2][2],h,i,j),t[0][1]=this.dot(u[1][0],u[1][1],u[1][2],h,i,j),e=h-t[0][1]*u[1][0]-t[0][2]*u[2][0],f=i-t[0][1]*u[1][1]-t[0][2]*u[2][1],g=j-t[0][1]*u[1][2]-t[0][2]*u[2][2],t[0][0]=this.norm(e,f,g),u[0][0]=e/t[0][0],u[0][1]=f/t[0][0],u[0][2]=g/t[0][0],u[1][3]=(o-t[1][2]*u[2][3])/t[1][1],u[0][3]=(k-t[0][1]*u[1][3]-t[0][2]*u[2][3])/t[0][0],c=0;3>c;c++)for(d=0;3>d;d++)t[c][d]/=t[2][2]},changeScale:function(a){this.m00=this.m00*a,this.m10=this.m10*a,this.m01=this.m01*a,this.m11=this.m11*a,this.m02=this.m02*a,this.m12=this.m12*a,this.m03=this.m03*a,this.m13=this.m13*a},projectionConvert_NyARDoublePoint3d:function(a,b){var c=a.z*this.m22;b.x=(a.x*this.m00+a.y*this.m01+a.z*this.m02)/c,b.y=(a.y*this.m11+a.z*this.m12)/c},projectionConvert_Number:function(a,b,c,d){var e=c*this.m22;d.x=(a*this.m00+b*this.m01+c*this.m02)/e,d.y=(b*this.m11+c*this.m12)/e}}),NyARParam=ASKlass("NyARParam",{_screen_size:new NyARIntSize,SIZE_OF_PARAM_SET:136,_dist:new NyARCameraDistortionFactor,_projection_matrix:new NyARPerspectiveProjectionMatrix,getScreenSize:function(){return this._screen_size},getPerspectiveProjectionMatrix:function(){return this._projection_matrix},getDistortionFactor:function(){return this._dist},copyCameraMatrix:function(a,b,c){var d=new FLARMat(3,4),e=new FLARMat(3,4),f=ArrayUtil.createJaggedArray(3,3),g=ArrayUtil.createJaggedArray(4,4),h=0,i=0,j=this.getScreenSize(),k=j.w,l=j.h;this.getPerspectiveProjectionMatrix().decompMat(e,d);var m=e.getArray(),n=d.getArray();for(h=0;4>h;h++)m[1][h]=(l-1)*m[2][h]-m[1][h];for(h=0;3>h;h++)for(i=0;3>i;i++)f[h][i]=m[h][i]/m[2][2];for(g[0][0]=2*f[0][0]/(k-1),g[0][1]=2*f[0][1]/(k-1),g[0][2]=-(2*f[0][2]/(k-1)-1),g[0][3]=0,g[1][0]=0,g[1][1]=-(2*f[1][1]/(l-1)),g[1][2]=-(2*f[1][2]/(l-1)-1),g[1][3]=0,g[2][0]=0,g[2][1]=0,g[2][2]=-(c+b)/(b-c),g[2][3]=2*c*b/(b-c),g[3][0]=0,g[3][1]=0,g[3][2]=1,g[3][3]=0,h=0;4>h;h++){for(i=0;3>i;i++)a[4*i+h]=g[h][0]*n[0][i]+g[h][1]*n[1][i]+g[h][2]*n[2][i];a[h+12]=g[h][0]*n[0][3]+g[h][1]*n[1][3]+g[h][2]*n[2][3]+g[h][3]}},setValue:function(a,b){this._dist.setValue(a),this._projection_matrix.setValue(b)},changeScreenSize:function(a,b){var c=a/this._screen_size.w;this._dist.changeScale(c),this._projection_matrix.changeScale(c),this._screen_size.w=a,this._screen_size.h=b},loadARParam:function(a){var b=new FloatVector(12);a.endian=Endian.BIG_ENDIAN,this._screen_size.w=a.readInt(),this._screen_size.h=a.readInt();var c;for(c=0;12>c;c++)b[c]=a.readDouble();for(this._projection_matrix.setValue(b),c=0;4>c;c++)b[c]=a.readDouble();this._dist.setValue(b)}}),FLARParam=ASKlass("FLARParam",NyARParam,{FLARParam:function(a,b){a=a||640,b=b||480,this._screen_size.w=a,this._screen_size.h=b;var c=a/b/(4/3),d=new FloatVector([a/2,1.1*b/2,26.2,1.0127565206658486]),e=new FloatVector([700.9514702992245*c,0,a/2-.5,0,0,726.0941816535367,b/2-.5,0,0,0,1,0]);this.setValue(d,e)}}),INyARRaster=ASKlass("INyARRaster",{getWidth:function(){},getHeight:function(){},getSize:function(){},getBuffer:function(){},getBufferType:function(){},isEqualBufferType:function(a){},hasBuffer:function(){},wrapBuffer:function(a){}}),NyARRaster_BasicClass=ASKlass("NyARRaster_BasicClass",INyARRaster,{_size:null,_buffer_type:0,NyARRaster_BasicClass:function(){switch(arguments.length){case 1:arguments[0]==NyAS3Const_Inherited;break;case 3:this.overload_NyARRaster_BasicClass(toInt(arguments[0]),toInt(arguments[1]),toInt(arguments[2]));break;default:throw new NyARException}},overload_NyARRaster_BasicClass:function(a,b,c){this._size=new NyARIntSize(a,b),this._buffer_type=c},getWidth:function(){return this._size.w},getHeight:function(){return this._size.h},getSize:function(){return this._size},getBufferType:function(){return this._buffer_type},isEqualBufferType:function(a){return this._buffer_type==a},getBuffer:function(){throw new NyARException},hasBuffer:function(){throw new NyARException},wrapBuffer:function(a){throw new NyARException}}),NyARBinRaster=ASKlass("NyARBinRaster",NyARRaster_BasicClass,{_buf:null,_is_attached_buffer:null,NyARBinRaster:function(){switch(NyARRaster_BasicClass.initialize.call(this,NyAS3Const_Inherited),arguments.length){case 1:arguments[0]==NyAS3Const_Inherited;break;case 2:this.override_NyARBinRaster2(toInt(arguments[0]),toInt(arguments[1]));break;case 3:this.override_NyARBinRaster3(toInt(arguments[0]),toInt(arguments[1]),Boolean(arguments[2]));break;case 4:this.override_NyARBinRaster4(toInt(arguments[0]),toInt(arguments[1]),toInt(arguments[2]),Boolean(arguments[3]));break;default:throw new NyARException}},override_NyARBinRaster4:function(a,b,c,d){if(NyARRaster_BasicClass.overload_NyARRaster_BasicClass.call(this,a,b,c),!this.initInstance(this._size,c,d))throw new NyARException},override_NyARBinRaster3:function(a,b,c){if(NyARRaster_BasicClass.overload_NyARRaster_BasicClass.call(this,a,b,NyARBufferType.INT1D_BIN_8),!this.initInstance(this._size,NyARBufferType.INT1D_BIN_8,c))throw new NyARException},override_NyARBinRaster2:function(a,b){if(NyARRaster_BasicClass.overload_NyARRaster_BasicClass.call(this,a,b,NyARBufferType.INT1D_BIN_8),!this.initInstance(this._size,NyARBufferType.INT1D_BIN_8,!0))throw new NyARException},initInstance:function(a,b,c){switch(b){case NyARBufferType.INT1D_BIN_8:this._buf=c?new IntVector(a.w*a.h):null;break;default:return!1}return this._is_attached_buffer=c,!0},getBuffer:function(){return this._buf},hasBuffer:function(){return null!=this._buf},wrapBuffer:function(a){NyAS3Utils.assert(!this._is_attached_buffer),this._buf=a}}),NyARGrayscaleRaster=ASKlass("NyARGrayscaleRaster",NyARRaster_BasicClass,{_buf:null,_is_attached_buffer:null,NyARGrayscaleRaster:function(){switch(NyARRaster_BasicClass.initialize.call(this,NyAS3Const_Inherited),arguments.length){case 1:arguments[0]==NyAS3Const_Inherited;break;case 2:this.overload_NyARGrayscaleRaster2(toInt(arguments[0]),toInt(arguments[1]));break;case 3:this.overload_NyARGrayscaleRaster3(toInt(arguments[0]),toInt(arguments[1]),Boolean(arguments[2]));break;case 4:this.overload_NyARGrayscaleRaster4(toInt(arguments[0]),toInt(arguments[1]),toInt(arguments[2]),Boolean(arguments[3]));break;default:throw new NyARException}},overload_NyARGrayscaleRaster2:function(a,b){if(NyARRaster_BasicClass.overload_NyARRaster_BasicClass.call(this,a,b,NyARBufferType.INT1D_GRAY_8),!this.initInstance(this._size,NyARBufferType.INT1D_GRAY_8,!0))throw new NyARException},overload_NyARGrayscaleRaster3:function(a,b,c){if(NyARRaster_BasicClass.overload_NyARRaster_BasicClass.call(this,a,b,NyARBufferType.INT1D_GRAY_8),!this.initInstance(this._size,NyARBufferType.INT1D_GRAY_8,c))throw new NyARException},overload_NyARGrayscaleRaster4:function(a,b,c,d){if(NyARRaster_BasicClass.overload_NyARRaster_BasicClass.call(this,a,b,c),!this.initInstance(this._size,c,d))throw new NyARException},initInstance:function(a,b,c){switch(b){case NyARBufferType.INT1D_GRAY_8:this._buf=c?new IntVector(a.w*a.h):null;break;default:return!1}return this._is_attached_buffer=c,!0},getBuffer:function(){return this._buf},hasBuffer:function(){return null!=this._buf},wrapBuffer:function(a){NyAS3Utils.assert(!this._is_attached_buffer),this._buf=a}}),NyARRaster=ASKlass("NyARRaster",NyARRaster_BasicClass,{_buf:null,_buf_type:0,_is_attached_buffer:null,NyARRaster:function(){switch(NyARRaster_BasicClass.initialize.call(this,NyAS3Const_Inherited),arguments.length){case 1:arguments[0]==NyAS3Const_Inherited;break;case 3:this.overload_NyARRaster3(toInt(arguments[0]),toInt(arguments[1]),toInt(arguments[2]));break;case 4:this.overload_NyARRaster4(toInt(arguments[0]),toInt(arguments[1]),toInt(arguments[2]),Boolean(arguments[3]));break;default:throw new NyARException}},overload_NyARRaster4:function(a,b,c,d){if(NyARRaster_BasicClass.overload_NyARRaster_BasicClass.call(this,a,b,c),!this.initInstance(this._size,c,d))throw new NyARException},overload_NyARRaster3:function(a,b,c){if(NyARRaster_BasicClass.overload_NyARRaster_BasicClass.call(this,a,b,c),!this.initInstance(this._size,c,!0))throw new NyARException},initInstance:function(a,b,c){switch(b){case NyARBufferType.INT1D_X8R8G8B8_32:this._buf=c?new IntVector(a.w*a.h):null;break;default:return!1}return this._is_attached_buffer=c,!0},getBuffer:function(){return this._buf},hasBuffer:function(){return null!=this._buf},wrapBuffer:function(a){NyAS3Utils.assert(!this._is_attached_buffer),this._buf=a}}),INyARRgbRaster=ASKlass("INyARRgbRaster",INyARRaster,{getRgbPixelReader:function(){}}),NyARRgbRaster_BasicClass=ASKlass("NyARRgbRaster_BasicClass",INyARRgbRaster,{_size:null,_buffer_type:0,NyARRgbRaster_BasicClass:function(){switch(arguments.length){case 1:arguments[0]==NyAS3Const_Inherited;break;case 3:this.overload_NyARRgbRaster_BasicClass(toInt(arguments[0]),toInt(arguments[1]),toInt(arguments[2]));break;default:throw new NyARException}},overload_NyARRgbRaster_BasicClass:function(a,b,c){this._size=new NyARIntSize(a,b),this._buffer_type=c},getWidth:function(){return this._size.w},getHeight:function(){return this._size.h},getSize:function(){return this._size},getBufferType:function(){return this._buffer_type},isEqualBufferType:function(a){return this._buffer_type==a},getRgbPixelReader:function(){throw new NyARException},getBuffer:function(){throw new NyARException},hasBuffer:function(){throw new NyARException},wrapBuffer:function(a){throw new NyARException}}),NyARRgbRaster=ASKlass("NyARRgbRaster",NyARRgbRaster_BasicClass,{_buf:null,_reader:null,_is_attached_buffer:null,NyARRgbRaster:function(){switch(NyARRgbRaster_BasicClass.initialize.call(this,NyAS3Const_Inherited),arguments.length){case 1:arguments[0]==NyAS3Const_Inherited;break;case 3:this.overload_NyARRgbRaster3(toInt(arguments[0]),toInt(arguments[1]),toInt(arguments[2]));break;case 4:this.overload_NyARRgbRaster4(toInt(arguments[0]),toInt(arguments[1]),toInt(arguments[2]),Boolean(arguments[3]));break;default:throw new NyARException}},overload_NyARRgbRaster4:function(a,b,c,d){if(NyARRgbRaster_BasicClass.overload_NyARRgbRaster_BasicClass.call(this,a,b,c),!this.initInstance(this._size,c,d))throw new NyARException},overload_NyARRgbRaster3:function(a,b,c){if(NyARRgbRaster_BasicClass.overload_NyARRgbRaster_BasicClass.call(this,a,b,c),!this.initInstance(this._size,c,!0))throw new NyARException},initInstance:function(a,b,c){switch(b){case NyARBufferType.INT1D_X8R8G8B8_32:this._buf=c?new IntVector(a.w*a.h):null,this._reader=new NyARRgbPixelReader_INT1D_X8R8G8B8_32(this._buf||new IntVector(1),a);break;case NyARBufferType.BYTE1D_B8G8R8X8_32:case NyARBufferType.BYTE1D_R8G8B8_24:default:return!1}return this._is_attached_buffer=c,!0},getRgbPixelReader:function(){return this._reader},getBuffer:function(){return this._buf},hasBuffer:function(){return null!=this._buf},wrapBuffer:function(a){NyAS3Utils.assert(!this._is_attached_buffer),this._buf=a,this._reader.switchBuffer(a)}}),NyARRgbRaster_Canvas2D=ASKlass("NyARRgbRaster_Canvas2D",NyARRgbRaster_BasicClass,{_canvas:null,_rgb_reader:null,NyARRgbRaster_Canvas2D:function(a){NyARRgbRaster_BasicClass.initialize.call(this,a.width,a.height,NyARBufferType.OBJECT_JS_Canvas),this._canvas=a,this._rgb_reader=new NyARRgbPixelReader_Canvas2D(this._canvas)},getRgbPixelReader:function(){return this._rgb_reader},getBuffer:function(){return this._canvas},hasBuffer:function(){return null!=this._bitmapData}}),FLARCanvas=function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c},FLARBinRaster=ASKlass("FLARBinRaster",NyARBinRaster,{FLARBinRaster:function(a,b){NyARBinRaster.initialize.call(this,a,b,NyARBufferType.OBJECT_AS3_BitmapData,!0),this._gray_reader=new FLARGrayPixelReader_BitmapData(this._buf)},initInstance:function(a,b,c){return this._buf=c?new BitmapData(a.w,a.h,0):null,!0},getGrayPixelReader:function(){return this._gray_reader}}),FLARRgbRaster_BitmapData=ASKlass("FLARRgbRaster_BitmapData",NyARRgbRaster_BasicClass,{_bitmapData:null,_rgb_reader:null,FLARRgbRaster_BitmapData:function(a){NyARRgbRaster_BasicClass.initialize.call(this,a.width,a.height,NyARBufferType.OBJECT_AS3_BitmapData),this._bitmapData=a,this._rgb_reader=new FLARRgbPixelReader_BitmapData(this._bitmapData)},getRgbPixelReader:function(){return this._rgb_reader},getBuffer:function(){return this._bitmapData},hasBuffer:function(){return null!=this._bitmapData}}),NyARMatchPattDeviationBlackWhiteData=ASKlass("NyARMatchPattDeviationBlackWhiteData",{_data:null,_pow:0,_number_of_pixels:0,refData:function(){return this._data},getPow:function(){return this._pow},NyARMatchPattDeviationBlackWhiteData:function(a,b){this._number_of_pixels=b*a,this._data=new IntVector(this._number_of_pixels)},setRaster:function(a){var b,c,d,e=this._data,f=a.getBuffer(),g=this._number_of_pixels;for(c=0,b=g-1;b>=0;b--)d=f[b],c+=(d>>16&255)+(d>>8&255)+(255&d);c=(255*g*3-c)/(3*g);var h,i=0;for(b=g-1;b>=0;b--)d=f[b],h=(765-(255&d)-(d>>8&255)-(d>>16&255))/3-c,e[b]=h,i+=h*h;var j=Math.sqrt(i);this._pow=0!=j?j:1e-7}}),NyARMatchPattDeviationColorData=ASKlass("NyARMatchPattDeviationColorData",{_data:null,_pow:0,_number_of_pixels:0,_optimize_for_mod:0,refData:function(){return this._data},getPow:function(){return this._pow},NyARMatchPattDeviationColorData:function(a,b){this._number_of_pixels=b*a,this._data=new IntVector(3*this._number_of_pixels),this._optimize_for_mod=this._number_of_pixels-this._number_of_pixels%8},setRaster:function(a){NyAS3Utils.assert(a.isEqualBufferType(NyARBufferType.INT1D_X8R8G8B8_32)),NyAS3Utils.assert(a.getSize().isEqualSize_NyARIntSize(a.getSize()));var b,c,d,e=a.getBuffer(),f=this._data,g=this._number_of_pixels,h=this._optimize_for_mod;for(c=0,b=g-1;b>=h;b--)d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d);for(;b>=0;)d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d),b--,d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d),b--,d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d),b--,d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d),b--,d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d),b--,d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d),b--,d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d),b--,d=e[b],c+=(d>>16&255)+(d>>8&255)+(255&d),b--;c=255*g*3-c,c=255-c/(3*g);var i,j=0,k=3*g-1;for(b=g-1;b>=h;b--)d=e[b],i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i;for(;b>=0;)d=e[b],b--,i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i,d=e[b],b--,i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i,d=e[b],b--,i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i,d=e[b],b--,i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i,d=e[b],b--,i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i,d=e[b],b--,i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i,d=e[b],b--,i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i,d=e[b],b--,i=c-(255&d),f[k--]=i,j+=i*i,i=c-(d>>8&255),f[k--]=i,j+=i*i,i=c-(d>>16&255),f[k--]=i,j+=i*i;var l=Math.sqrt(j);this._pow=0!=l?l:1e-7}}),NyARMatchPattResult=ASKlass("NyARMatchPattResult",{DIRECTION_UNKNOWN:-1,confidence:0,direction:0}),NyARCode=ASKlass("NyARCode",{_color_pat:new Array(4),_bw_pat:new Array(4),_width:0,_height:0,NyARCode:function(a,b){this._width=a,this._height=b;for(var c=0;4>c;c++)this._color_pat[c]=new NyARMatchPattDeviationColorData(a,b),this._bw_pat[c]=new NyARMatchPattDeviationBlackWhiteData(a,b)},getColorData:function(a){return this._color_pat[a]},getBlackWhiteData:function(a){return this._bw_pat[a]},getWidth:function(){return this._width},getHeight:function(){return this._height},loadARPattFromFile:function(a){NyARCodeFileReader.loadFromARToolKitFormFile(a,this)},setRaster:function(a){NyAS3Utils.assert(4!=a.length);for(var b=0;4>b;b++)this._color_pat[b].setRaster(a[b])}}),NyARCodeFileReader=ASKlass("NyARCodeFileReader",{loadFromARToolKitFormFile:function(a,b){for(var c=b.getWidth(),d=b.getHeight(),e=new NyARRaster(c,d,NyARBufferType.INT1D_X8R8G8B8_32),f=a.match(/\d+/g),g=e.getBuffer(),h=0;4>h;h++)this.readBlock(f,c,d,g),b.getColorData(h).setRaster(e),b.getBlackWhiteData(h).setRaster(e);e=null},readBlock:function(a,b,c,d){var e,f=b*c;for(e=0;3>e;e++)for(var g=0;f>g;g++){var h=parseInt(a.shift());if(isNaN(h))throw new NyARException("syntax error in pattern file.");d[g]=d[g]<<8|255&toInt(h)}for(e=0;f>e;e++)d[e]=d[e]<<16&16711680|65280&d[e]|d[e]>>16&255}}),FLARCode=ASKlass("FLARCode",NyARCode,{markerPercentWidth:50,markerPercentHeight:50,FLARCode:function(a,b,c,d){NyARCode.initialize.call(this,a,b),this.markerPercentWidth=null==c?50:c,this.markerPercentHeight=null==d?50:d},loadARPatt:function(a){NyARCode.loadARPattFromFile.call(this,a)}}),INyARMatchPatt=ASKlass("INyARMatchPatt",{setARCode:function(a){}}),NyARMatchPatt_Color_WITHOUT_PCA=ASKlass("NyARMatchPatt_Color_WITHOUT_PCA",INyARMatchPatt,{_code_patt:null,_optimize_for_mod:0,_rgbpixels:0,NyARMatchPatt_Color_WITHOUT_PCA:function(){switch(arguments.length){case 1:var a=arguments[0],b=a.getWidth(),c=a.getHeight();return this._rgbpixels=b*c*3,this._optimize_for_mod=this._rgbpixels-this._rgbpixels%16,void this.setARCode(a);case 2:var d=toInt(arguments[0]),e=toInt(arguments[1]);return this._rgbpixels=e*d*3,void(this._optimize_for_mod=this._rgbpixels-this._rgbpixels%16)}throw new NyARException},setARCode:function(a){this._code_patt=a},evaluate:function(a,b){NyAS3Utils.assert(null!=this._code_patt);for(var c,d=a.refData(),e=Number.MIN_VALUE,f=NyARMatchPattResult.DIRECTION_UNKNOWN,g=this._optimize_for_mod,h=0;4>h;h++){c=0;var i,j=this._code_patt.getColorData(h),k=j.refData();for(i=this._rgbpixels-1;i>=g;i--)c+=d[i]*k[i];for(;i>=0;)c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--,c+=d[i]*k[i],i--;var l=c/j.getPow();l>e&&(e=l,f=h)}return b.direction=f,b.confidence=e/a.getPow(),!0}}),NyARRasterAnalyzer_Histogram=ASKlass("NyARRasterAnalyzer_Histogram",{_histImpl:null,_vertical_skip:0,NyARRasterAnalyzer_Histogram:function(a,b){if(!this.initInstance(a,b))throw new NyARException},initInstance:function(a,b){switch(a){case NyARBufferType.INT1D_GRAY_8:this._histImpl=new NyARRasterThresholdAnalyzer_Histogram_INT1D_GRAY_8;break;case NyARBufferType.INT1D_X8R8G8B8_32:this._histImpl=new NyARRasterThresholdAnalyzer_Histogram_INT1D_X8R8G8B8_32;break;default:return!1}return this._vertical_skip=b,!0},setVerticalInterval:function(a){this._vertical_skip=a},analyzeRaster:function(a,b){var c=a.getSize();NyAS3Utils.assert(c.w*c.h<1073741824),NyAS3Utils.assert(256==b.length);for(var d=b.data,e=b.length-1;e>=0;e--)d[e]=0;return b.total_of_data=c.w*c.h/this._vertical_skip,this._histImpl.createHistogram(a,c,d,this._vertical_skip)}}),ICreateHistogramImpl=ASKlass("ICreateHistogramImpl",{createHistogram:function(a,b,c,d){}}),NyARRasterThresholdAnalyzer_Histogram_INT1D_GRAY_8=ASKlass("NyARRasterThresholdAnalyzer_Histogram_INT1D_GRAY_8",ICreateHistogramImpl,{createHistogram:function(a,b,c,d){NyAS3Utils.assert(a.isEqualBufferType(NyARBufferType.INT1D_GRAY_8));for(var e=IntVector(a.getBuffer()),f=b.h-1;f>=0;f-=d)for(var g=f*b.w,h=b.w-1;h>=0;h--)c[e[g]]++,g++;return b.w*b.h}}),NyARRasterThresholdAnalyzer_Histogram_INT1D_X8R8G8B8_32=ASKlass("NyARRasterThresholdAnalyzer_Histogram_INT1D_X8R8G8B8_32",ICreateHistogramImpl,{createHistogram:function(a,b,c,d){NyAS3Utils.assert(a.isEqualBufferType(NyARBufferType.INT1D_X8R8G8B8_32));for(var e=a.getBuffer(),f=b.h-1;f>=0;f-=d)for(var g=f*b.w,h=b.w-1;h>=0;h--){var i=e[g];c[((255&i)+(255&i)+(255&i))/3]++,g++}return b.w*b.h}}),INyARRasterThresholdAnalyzer=ASKlass("INyARRasterThresholdAnalyzer",{analyzeRaster:function(a){}}),NyARRasterThresholdAnalyzer_SlidePTile=ASKlass("NyARRasterThresholdAnalyzer_SlidePTile",INyARRasterThresholdAnalyzer,{_raster_analyzer:null,_sptile:null,_histgram:null,NyARRasterThresholdAnalyzer_SlidePTile:function(a,b,c){if(NyAS3Utils.assert(a>=0&&50>=a),!this.initInstance(b,c))throw new NyARException;this._sptile=new NyARHistogramAnalyzer_SlidePTile(a),this._histgram=new NyARHistogram(256)},initInstance:function(a,b){return this._raster_analyzer=new NyARRasterAnalyzer_Histogram(a,b),!0},setVerticalInterval:function(a){this._raster_analyzer.setVerticalInterval(a)},analyzeRaster:function(a){return this._raster_analyzer.analyzeRaster(a,this._histgram),this._sptile.getThreshold(this._histgram)}}),FLARRasterAnalyzer_Histogram=ASKlass("FLARRasterAnalyzer_Histogram",NyARRasterAnalyzer_Histogram,{FLARRasterAnalyzer_Histogram:function(a){NyARRasterAnalyzer_Histogram.initialize.call(this,NyARBufferType.OBJECT_AS3_BitmapData,a)},initInstance:function(a,b){return a!=NyARBufferType.OBJECT_AS3_BitmapData?!1:(this._vertical_skip=b,!0)},analyzeRaster:function(a,b){var c=a.getSize();NyAS3Utils.assert(c.w*c.h<1073741824),NyAS3Utils.assert(256==b.length);for(var d=b.data,e=b.length-1;e>=0;e--)d[e]=0;return b.total_of_data=c.w*c.h/this._vertical_skip,this.createHistgram_AS3_BitmapData(a,c,d,this._vertical_skip)},createHistgram_AS3_BitmapData:function(a,b,c,d){NyAS3Utils.assert(a.isEqualBufferType(NyARBufferType.OBJECT_AS3_BitmapData));for(var e=a.getBuffer(),f=b.h-1;f>=0;f-=d)for(var g=f*b.w,h=b.w-1;h>=0;h--){var i=e.getPixel(h,f);c[toInt(((i>>8&255)+(i>>16&255)+(255&i))/3)]++,g++}return b.w*b.h}}),FLARRasterThresholdAnalyzer_SlidePTile=ASKlass("FLARRasterThresholdAnalyzer_SlidePTile",NyARRasterThresholdAnalyzer_SlidePTile,{FLARRasterThresholdAnalyzer_SlidePTile:function(a,b){NyARRasterThresholdAnalyzer_SlidePTile.initialize.call(this,a,NyARBufferType.OBJECT_AS3_BitmapData,b)},initInstance:function(a,b){return a!=NyARBufferType.OBJECT_AS3_BitmapData?!1:(this._raster_analyzer=new FLARRasterAnalyzer_Histogram(b),!0)}}),INyARRasterFilter=ASKlass("INyARRasterFilter",{doFilter:function(a,b){}}),INyARRasterFilter_Gs2Bin=ASKlass("INyARRasterFilter_Gs2Bin",{doFilter:function(a,b){}}),INyARRasterFilter_Rgb2Gs=ASKlass("INyARRasterFilter_Rgb2Gs",{doFilter:function(a,b){}}),INyARRasterFilter_Rgb2Bin=ASKlass("INyARRasterFilter_Rgb2Bin",{doFilter:function(a,b){}}),NyARRasterFilter_ARToolkitThreshold=ASKlass("NyARRasterFilter_ARToolkitThreshold",INyARRasterFilter_Rgb2Bin,{_threshold:0,_do_threshold_impl:null,NyARRasterFilter_ARToolkitThreshold:function(a,b){switch(this._threshold=a,b){case NyARBufferType.INT1D_X8R8G8B8_32:this._do_threshold_impl=new doThFilterImpl_BUFFERFORMAT_INT1D_X8R8G8B8_32;break;default:throw new NyARException}},setThreshold:function(a){this._threshold=a},doFilter:function(a,b){NyAS3Utils.assert(b.isEqualBufferType(NyARBufferType.INT1D_BIN_8)),NyAS3Utils.assert(1==a.getSize().isEqualSize_NyARIntSize(b.getSize())),this._do_threshold_impl.doThFilter(a,b,b.getSize(),this._threshold)}}),IdoThFilterImpl=ASKlass("IdoThFilterImpl",{doThFilter:function(a,b,c,d){}}),doThFilterImpl_BUFFERFORMAT_INT1D_X8R8G8B8_32=ASKlass("doThFilterImpl_BUFFERFORMAT_INT1D_X8R8G8B8_32",IdoThFilterImpl,{doThFilter:function(a,b,c,d){NyAS3Utils.assert(b.isEqualBufferType(NyARBufferType.INT1D_BIN_8));var e,f,g=IntVector(b.getBuffer()),h=IntVector(a.getBuffer()),i=3*d,j=c.h*c.w,k=j-j%8;for(f=j-1;f>=k;f--)e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1;for(;f>=0;)e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1,f--,e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1,f--,e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1,f--,e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1,f--,e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1,f--,e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1,f--,e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1,f--,e=h[f],g[f]=i>=(e>>16&255)+(e>>8&255)+(255&e)?0:1,f--}}),NyARContourPickup=ASKlass("NyARContourPickup",{_getContour_xdir:new IntVector([0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1]),_getContour_ydir:new IntVector([-1,-1,0,1,1,1,0,-1,-1,-1,0,1,1,1,0]),getContour_NyARBinRaster:function(a,b,c,d,e,f){return this.impl_getContour(a,0,b,c,d,e,f)},getContour_NyARGrayscaleRaster:function(a,b,c,d,e,f,g){return this.impl_getContour(a,b,c,d,e,f,g)},impl_getContour:function(a,b,c,d,e,f,g){var h=this._getContour_xdir,i=this._getContour_ydir,j=a.getBuffer(),k=a.getWidth(),l=a.getHeight(),m=1;f[0]=c,g[0]=d;for(var n=5,o=c,p=d;;){if(n=(n+5)%8,o>=1&&k-1>o&&p>=1&&l-1>p)for(;!(j[(p+i[n])*k+(o+h[n])]<=b)&&(n++,!(j[(p+i[n])*k+(o+h[n])]<=b))&&(n++,!(j[(p+i[n])*k+(o+h[n])]<=b))&&(n++,!(j[(p+i[n])*k+(o+h[n])]<=b))&&(n++,!(j[(p+i[n])*k+(o+h[n])]<=b))&&(n++,!(j[(p+i[n])*k+(o+h[n])]<=b))&&(n++,!(j[(p+i[n])*k+(o+h[n])]<=b))&&(n++,!(j[(p+i[n])*k+(o+h[n])]<=b));)throw new NyARException;else{var q;for(q=0;8>q;q++){var r=o+h[n],s=p+i[n];if(r>=0&&k>r&&s>=0&&l>s&&j[s*k+r]<=b)break;n++}if(8==q)throw new NyARException}if(n%=8,o+=h[n],p+=i[n],f[m]=o,g[m]=p,o==c&&p==d){m++;break}if(m++,m==e)return m}return m}}),NyARCoord2Linear=ASKlass("NyARCoord2Linear",{_xpos:null,_ypos:null,_pca:null,__getSquareLine_evec:new NyARDoubleMatrix22,__getSquareLine_mean:new FloatVector(2),__getSquareLine_ev:new FloatVector(2),_dist_factor:null,NyARCoord2Linear:function(a,b){this._dist_factor=new NyARObserv2IdealMap(b,a),this._pca=new NyARPca2d_MatrixPCA_O2,this._xpos=new FloatVector(a.w+a.h),this._ypos=new FloatVector(a.w+a.h)},coord2Line:function(a,b,c,d,e,f){var g,h,i,j;if(b>=a?(j=.05*(b-a+1)+.5,h=Math.floor(a+j),i=Math.floor(b-j)):(j=(b+e-a+1)%e*.05+.5,h=Math.floor(a+j)%e,i=Math.floor(b+e-j)%e),i>=h?(g=i-h+1,this._dist_factor.observ2IdealBatch(c,d,h,g,this._xpos,this._ypos,0)):(g=i+1+e-h,this._dist_factor.observ2IdealBatch(c,d,h,e-h,this._xpos,this._ypos,0),this._dist_factor.observ2IdealBatch(c,d,0,i+1,this._xpos,this._ypos,e-h)),2>g)return!1;var k=this.__getSquareLine_evec,l=this.__getSquareLine_mean;return this._pca.pca(this._xpos,this._ypos,g,k,this.__getSquareLine_ev,l),f.dy=k.m01,f.dx=-k.m00,f.c=-(f.dy*l[0]+f.dx*l[1]),!0}}),NyARVertexCounter=ASKlass("NyARVertexCounter",{vertex:new IntVector(10),number_of_vertex:0,thresh:0,x_coord:null,y_coord:null,getVertex:function(a,b,c,d,e,f){return this.number_of_vertex=0,this.thresh=f,this.x_coord=a,this.y_coord=b,this.get_vertex(d,e,c)},get_vertex:function(a,b,c){var d,e,f=0,g=this.x_coord,h=this.y_coord,i=h[b]-h[a],j=g[a]-g[b],k=g[b]*h[a]-h[b]*g[a],l=0;if(b>a)for(d=a+1;b>d;d++)e=i*g[d]+j*h[d]+k,e*e>l&&(l=e*e,f=d);else{for(d=a+1;c>d;d++)e=i*g[d]+j*h[d]+k,e*e>l&&(l=e*e,f=d);for(d=0;b>d;d++)e=i*g[d]+j*h[d]+k,e*e>l&&(l=e*e,f=d)}if(l/(i*i+j*j)>this.thresh){if(!this.get_vertex(a,f,c))return!1;if(this.number_of_vertex>5)return!1;if(this.vertex[this.number_of_vertex]=f,this.number_of_vertex++,!this.get_vertex(f,b,c))return!1}return!0}}),NyARCoord2SquareVertexIndexes=ASKlass("NyARCoord2SquareVertexIndexes",{VERTEX_FACTOR:1,__getSquareVertex_wv1:new NyARVertexCounter,__getSquareVertex_wv2:new NyARVertexCounter,NyARCoord2SquareVertexIndexes:function(){},getVertexIndexes:function(a,b,c,d,e){var f=this.__getSquareVertex_wv1,g=this.__getSquareVertex_wv2,h=this.getFarPoint(a,b,c,0),i=(h+c)%c,j=this.getFarPoint(a,b,c,h),k=d/.75*.01*this.VERTEX_FACTOR;if(e[0]=h,!f.getVertex(a,b,c,h,j,k))return!1;if(!g.getVertex(a,b,c,j,i,k))return!1;var l;if(1==f.number_of_vertex&&1==g.number_of_vertex)e[1]=f.vertex[0],e[2]=j,e[3]=g.vertex[0];else if(f.number_of_vertex>1&&0==g.number_of_vertex){if(l=j>=h?(j-h)/2+h:((j+c-h)/2+h)%c,!f.getVertex(a,b,c,h,l,k))return!1;if(!g.getVertex(a,b,c,l,j,k))return!1;if(1!=f.number_of_vertex||1!=g.number_of_vertex)return!1;e[1]=f.vertex[0],e[2]=g.vertex[0],e[3]=j}else{if(!(0==f.number_of_vertex&&g.number_of_vertex>1))return!1;if(l=i>=j?(j+i)/2:(j+c+i)/2%c,!f.getVertex(a,b,c,j,l,k))return!1;if(!g.getVertex(a,b,c,l,i,k))return!1;if(1!=f.number_of_vertex||1!=g.number_of_vertex)return!1;e[1]=j,e[2]=f.vertex[0],e[3]=g.vertex[0]}return!0},getFarPoint:function(a,b,c,d){var e,f,g,h,i=a[d],j=b[d],k=0,l=0;for(h=d+1;c>h;h++)f=a[h]-i,g=b[h]-j,e=f*f+g*g,e>k&&(k=e,l=h);for(h=0;d>h;h++)f=a[h]-i,g=b[h]-j,e=f*f+g*g,e>k&&(k=e,l=h);return l}}),NyARSquare=ASKlass("NyARSquare",{line:NyARLinear.createArray(4),sqvertex:NyARDoublePoint2d.createArray(4),getCenter2d:function(a){a.x=(this.sqvertex[0].x+this.sqvertex[1].x+this.sqvertex[2].x+this.sqvertex[3].x)/4,a.y=(this.sqvertex[0].y+this.sqvertex[1].y+this.sqvertex[2].y+this.sqvertex[3].y)/4}}),NyARSquareContourDetector=ASKlass("NyARSquareContourDetector",{detectMarkerCB:function(a,b){NyARException.trap("getRgbPixelReader not implemented.")}}),NyARSquareContourDetector_IDetectMarkerCallback=ASKlass("NyARSquareContourDetector_IDetectMarkerCallback",{onSquareDetect:function(a,b,c,d,e){}}),RleLabelOverlapChecker=ASKlass("RleLabelOverlapChecker",NyARLabelOverlapChecker,{RleLabelOverlapChecker:function(a){NyARLabelOverlapChecker.initialize.call(this,a)},createArray:function(a){return new Array(a)}}),NyARSquareContourDetector_Rle=ASKlass("NyARSquareContourDetector_Rle",NyARSquareContourDetector,{AR_AREA_MAX:1e5,AR_AREA_MIN:70,_width:0,_height:0,_labeling:null,_overlap_checker:new RleLabelOverlapChecker(32),_cpickup:new NyARContourPickup,_stack:null,_coord2vertex:new NyARCoord2SquareVertexIndexes,_max_coord:0,_xcoord:null,_ycoord:null,NyARSquareContourDetector_Rle:function(a){this._width=a.w,this._height=a.h,this._labeling=new NyARLabeling_Rle(this._width,this._height),this._labeling.setAreaRange(this.AR_AREA_MAX,this.AR_AREA_MIN),this._stack=new NyARRleLabelFragmentInfoStack(a.w*a.h*2048/76800+32);var b=2*(this._width+this._height);this._max_coord=b,this._xcoord=new IntVector(b),this._ycoord=new IntVector(b)},__detectMarker_mkvertex:new IntVector(4),detectMarkerCB:function(a,b){var c=this._stack,d=this._overlap_checker,e=this._labeling.labeling_NyARBinRaster(a,0,a.getHeight(),c);if(!(1>e)){c.sortByArea();var f=c.getArray(),g=this._width,h=this._height,i=this._xcoord,j=this._ycoord,k=this._max_coord,l=this.__detectMarker_mkvertex;d.setMaxLabels(e);for(var m=0;e>m;m++){var n=f[m],o=n.area;if(0!=n.clip_l&&n.clip_r!=g-1&&0!=n.clip_t&&n.clip_b!=h-1&&d.check(n)){var p=_cpickup.getContour_NyARBinRaster(a,n.entry_x,n.clip_t,k,i,j);
p!=k&&this._coord2vertex.getVertexIndexes(i,j,p,o,l)&&(b.onSquareDetect(this,i,j,p,l),d.push(n))}}}}}),NyARSquareStack=ASKlass("NyARSquareStack",NyARObjectStack,{NyARSquareStack:function(a){NyARObjectStack.initialize.call(this,a)},createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARSquare;return b}}),FLARSquare=NyARSquare,Cxdir=new IntVector([0,1,1,1,0,-1,-1,-1]),Cydir=new IntVector([-1,-1,0,1,1,1,0,-1]),FLContourPickup=ASKlass("FLContourPickup",NyARContourPickup,{FLContourPickup:function(){},getContour_FLARBinRaster:function(a,b,c,d,e,f){var g=this._getContour_xdir,h=this._getContour_ydir,i=a.getBuffer(),j=a.getWidth(),k=a.getHeight(),l=1;e[0]=b,f[0]=c;for(var m=5,n=b,o=c;;){if(m=(m+5)%8,n>=1&&j-1>n&&o>=1&&k-1>o)for(;!(i.getPixel(n+g[m],o+h[m])>0)&&(m++,!(i.getPixel(n+g[m],o+h[m])>0))&&(m++,!(i.getPixel(n+g[m],o+h[m])>0))&&(m++,!(i.getPixel(n+g[m],o+h[m])>0))&&(m++,!(i.getPixel(n+g[m],o+h[m])>0))&&(m++,!(i.getPixel(n+g[m],o+h[m])>0))&&(m++,!(i.getPixel(n+g[m],o+h[m])>0))&&(m++,!(i.getPixel(n+g[m],o+h[m])>0));)return-1;else{var p;for(p=0;8>p;p++){var q=n+g[m],r=o+h[m];if(q>=0&&j>q&&r>=0&&k>r&&i.getPixel(r,q)>0)break;m++}if(8==p)return-1}if(m%=8,n+=g[m],o+=h[m],e[l]=n,f[l]=o,n==b&&o==c){l++;break}if(l++,l==d)return l}return l}}),FLARSquareContourDetector=ASKlass("FLARSquareContourDetector",NyARSquareContourDetector,{AR_AREA_MAX:1e5,AR_AREA_MIN:70,_width:0,_height:0,_labeling:null,_overlap_checker:new NyARLabelOverlapChecker(32),_cpickup:new FLContourPickup,_stack:null,_coord2vertex:new NyARCoord2SquareVertexIndexes,_max_coord:0,_xcoord:null,_ycoord:null,FLARSquareContourDetector:function(a){this._width=a.w,this._height=a.h,this._labeling=new NyARLabeling_Rle(this._width,this._height),this._stack=new NyARRleLabelFragmentInfoStack(a.w*a.h*2048/76800+32);var b=2*(this._width+this._height);this._max_coord=b,this._xcoord=new IntVector(b),this._ycoord=new IntVector(b)},setAreaRange:function(a,b){this._labeling.setAreaRange(a,b)},__detectMarker_mkvertex:new IntVector(4),detectMarkerCB:function(a,b){var c=this._stack,d=this._overlap_checker,e=this._labeling.labeling(a,c);if(!(1>e)){c.sortByArea();var f=c.getArray(),g=this._width,h=this._height,i=this._xcoord,j=this._ycoord,k=this._max_coord,l=this.__detectMarker_mkvertex;d.setMaxLabels(e);for(var m=0;e>m;m++){var n=f[m],o=n.area;if(0!=n.clip_l&&n.clip_r!=g-1&&0!=n.clip_t&&n.clip_b!=h-1&&d.check(n)){if(window.DEBUG){var p=document.getElementById("debugCanvas").getContext("2d");p.strokeStyle="red",p.strokeRect(n.clip_l,n.clip_t,n.clip_r-n.clip_l,n.clip_b-n.clip_t),p.fillStyle="red",p.fillRect(n.entry_x-1,n.clip_t-1,3,3),p.fillStyle="cyan",p.fillRect(n.pos_x-1,n.pos_y-1,3,3)}var q=this._cpickup.getContour_FLARBinRaster(a,n.entry_x,n.clip_t,k,i,j);if(-1==q)return-1;if(q!=k){var r=this._coord2vertex.getVertexIndexes(i,j,q,o,l);r&&(b.onSquareDetect(this,i,j,q,l),d.push(n))}}}}}}),INyARTransMat=Klass({transMat:function(a,b,c){},transMatContinue:function(a,b,c){}}),NyARRectOffset=ASKlass("NyARRectOffset",{vertex:NyARDoublePoint3d.createArray(4),createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARRectOffset;return b},setSquare:function(a){var b,c=a/2;b=this.vertex[0],b.x=-c,b.y=c,b.z=0,b=this.vertex[1],b.x=c,b.y=c,b.z=0,b=this.vertex[2],b.x=c,b.y=-c,b.z=0,b=this.vertex[3],b.x=-c,b.y=-c,b.z=0}}),NyARTransMat=ASKlass("NyARTransMat",INyARTransMat,{_projection_mat_ref:null,_rotmatrix:null,_transsolver:null,_mat_optimize:null,_ref_dist_factor:null,NyARTransMat:function(a){var b=a.getDistortionFactor(),c=a.getPerspectiveProjectionMatrix();this._transsolver=new NyARTransportVectorSolver(c,4),this._rotmatrix=new NyARRotMatrix(c),this._mat_optimize=new NyARPartialDifferentiationOptimize(c),this._ref_dist_factor=b,this._projection_mat_ref=c,this.__transMat_vertex_2d=NyARDoublePoint2d.createArray(4),this.__transMat_vertex_3d=NyARDoublePoint3d.createArray(4),this.__transMat_trans=new NyARDoublePoint3d,this.__rot=new NyARDoubleMatrix33},makeErrThreshold:function(a){var b,c,d,e;return b=a[0].x-a[2].x,c=a[0].y-a[2].y,d=b*b+c*c,b=a[1].x-a[3].x,c=a[1].y-a[3].y,e=b*b+c*c,Math.sqrt(d>e?d:e)/200},transMat:function(a,b,c){var d=this.__transMat_trans,e=this.makeErrThreshold(a.sqvertex),f=this.__transMat_vertex_2d,g=this.__transMat_vertex_3d;this._ref_dist_factor.ideal2ObservBatch(a.sqvertex,f,4),this._transsolver.set2dVertex(f,4),this._rotmatrix.initRotBySquare(a.line,a.sqvertex),this._rotmatrix.getPoint3dBatch(b.vertex,g,4),this._transsolver.solveTransportVector(g,d),c.error=this.optimize(this._rotmatrix,d,this._transsolver,b.vertex,f,e),this.updateMatrixValue(this._rotmatrix,d,c)},transMatContinue:function(a,b,c){var d=this.__transMat_trans;if(!c.has_value)return void this.transMat(a,b,c);var e=this.makeErrThreshold(a.sqvertex),f=this.__transMat_vertex_2d,g=this.__transMat_vertex_3d;this._ref_dist_factor.ideal2ObservBatch(a.sqvertex,f,4),this._transsolver.set2dVertex(f,4),this._rotmatrix.initRotByPrevResult(c),this._rotmatrix.getPoint3dBatch(b.vertex,g,4),this._transsolver.solveTransportVector(g,d);var h=this.errRate(this._rotmatrix,d,b.vertex,f,4,g),i=this.__rot;if(h<c.error+e){i.setValue_NyARDoubleMatrix33(this._rotmatrix);for(var j=0;5>j;j++){this._mat_optimize.modifyMatrix(i,d,b.vertex,f,4);var k=this.errRate(i,d,b.vertex,f,4,g);if(e/2>h-k)break;this._transsolver.solveTransportVector(g,d),this._rotmatrix.setValue_NyARDoubleMatrix33(i),h=k}this.updateMatrixValue(this._rotmatrix,d,c)}else this._rotmatrix.initRotBySquare(a.line,a.sqvertex),this._rotmatrix.getPoint3dBatch(b.vertex,g,4),this._transsolver.solveTransportVector(g,d),h=this.optimize(this._rotmatrix,d,this._transsolver,b.vertex,f,e),this.updateMatrixValue(this._rotmatrix,d,c);c.error=h},optimize:function(a,b,c,d,e,f){var g=this.__transMat_vertex_3d,h=this.errRate(a,b,d,e,4,g),i=this.__rot;i.setValue_NyARDoubleMatrix33(a);for(var j=0;5>j;j++){this._mat_optimize.modifyMatrix(i,b,d,e,4);var k=this.errRate(i,b,d,e,4,g);if(f>h-k)break;c.solveTransportVector(g,b),a.setValue_NyARDoubleMatrix33(i),h=k}return h},errRate:function(a,b,c,d,e,f){for(var g=this._projection_mat_ref,h=g.m00,i=g.m01,j=g.m02,k=g.m11,l=g.m12,m=0,n=0;e>n;n++){var o,p,q;f[n].x=o=a.m00*c[n].x+a.m01*c[n].y+a.m02*c[n].z,f[n].y=p=a.m10*c[n].x+a.m11*c[n].y+a.m12*c[n].z,f[n].z=q=a.m20*c[n].x+a.m21*c[n].y+a.m22*c[n].z,o+=b.x,p+=b.y,q+=b.z;var r=o*h+p*i+q*j,s=p*k+q*l,t=q,u=d[n].x-r/t,v=d[n].y-s/t;m+=u*u+v*v}return m/e},updateMatrixValue:function(a,b,c){c.m00=a.m00,c.m01=a.m01,c.m02=a.m02,c.m03=b.x,c.m10=a.m10,c.m11=a.m11,c.m12=a.m12,c.m13=b.y,c.m20=a.m20,c.m21=a.m21,c.m22=a.m22,c.m23=b.z,c.has_value=!0}}),NyARTransMatResult=ASKlass("NyARTransMatResult",NyARDoubleMatrix34,{error:0,has_value:!1,getZXYAngle:function(a){var b=this.m21;b>=1?(a.x=Math.PI/2,a.y=0,a.z=Math.atan2(-this.m10,this.m00)):-1>=b?(a.x=-Math.PI/2,a.y=0,a.z=Math.atan2(-this.m10,this.m00)):(a.x=Math.asin(b),a.z=Math.atan2(-this.m01,this.m11),a.y=Math.atan2(-this.m20,this.m22))},transformVertex_Number:function(a,b,c,d){d.x=this.m00*a+this.m01*b+this.m02*c+this.m03,d.y=this.m10*a+this.m11*b+this.m12*c+this.m13,d.z=this.m20*a+this.m21*b+this.m22*c+this.m23},transformVertex_NyARDoublePoint3d:function(a,b){this.transformVertex_Number(a.x,a.y,a.z,b)}}),NyARPartialDifferentiationOptimize=ASKlass("NyARPartialDifferentiationOptimize",{_projection_mat_ref:null,NyARPartialDifferentiationOptimize:function(a){this._projection_mat_ref=a,this.__angles_in=TSinCosValue.createArray(3),this.__ang=new NyARDoublePoint3d,this.__sin_table=new FloatVector(4)},sincos2Rotation_ZXY:function(a,b){var c=a[0].sin_val,d=a[0].cos_val,e=a[1].sin_val,f=a[1].cos_val,g=a[2].sin_val,h=a[2].cos_val;b.m00=h*f-g*c*e,b.m01=-g*d,b.m02=h*e+g*c*f,b.m10=g*f+h*c*e,b.m11=h*d,b.m12=g*e-h*c*f,b.m20=-d*e,b.m21=c,b.m22=f*d},rotation2Sincos_ZXY:function(a,b,c){var d,e,f,g=a.m21;g>=1?(d=Math.PI/2,e=0,f=Math.atan2(-a.m10,a.m00)):-1>=g?(d=-Math.PI/2,e=0,f=Math.atan2(-a.m10,a.m00)):(d=Math.asin(g),e=Math.atan2(-a.m20,a.m22),f=Math.atan2(-a.m01,a.m11)),c.x=d,c.y=e,c.z=f,b[0].sin_val=Math.sin(d),b[0].cos_val=Math.cos(d),b[1].sin_val=Math.sin(e),b[1].cos_val=Math.cos(e),b[2].sin_val=Math.sin(f),b[2].cos_val=Math.cos(f)},optimizeParamX:function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n=this._projection_mat_ref,o=a.sin_val,p=a.cos_val,q=b.sin_val,r=b.cos_val;h=i=j=k=l=m=0;for(var s=0;f>s;s++){var t,u,v;t=d[s].x,u=d[s].y,v=d[s].z;var w,x,y,z,A,B,C=n.m00,D=n.m01,E=n.m02,F=n.m11,G=n.m12,H=C*(-q*o*t+q*p*v)+D*(r*o*t-r*p*v)+E*u,I=C*(-q*u)+D*(r*u)+E*(-o*t+p*v),J=C*(c.x+r*p*t+r*o*v)+D*(c.y+q*p*t+q*o*v)+E*c.z,K=F*(r*o*t-r*p*v)+G*u,L=F*(r*u)+G*(-o*t+p*v),M=F*(c.y+q*p*t+q*o*v)+G*c.z,N=u,O=-o*t+p*v,P=c.z,Q=e[s].x,R=e[s].y;w=Q*N-H,x=Q*O-I,y=Q*P-J,z=R*N-K,A=R*O-L,B=R*P-M,h+=z*A+w*x,l+=z*z+w*w,i+=z*B+w*y,k+=A*A+x*x,j+=A*B+x*y,m+=B*B+y*y}return h*=2,i*=2,j*=2,this.getMinimumErrorAngleFromParam(h,i,j,k,l,m,g)},optimizeParamY:function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n=this._projection_mat_ref,o=a.sin_val,p=a.cos_val,q=b.sin_val,r=b.cos_val;h=i=j=k=l=m=0;for(var s=0;f>s;s++){var t,u,v;t=d[s].x,u=d[s].y,v=d[s].z;var w,x,y,z,A,B,C=n.m00,D=n.m01,E=n.m02,F=n.m11,G=n.m12,H=C*(-q*o*t+r*v)+D*(r*o*t+q*v)+E*(-p*t),I=D*(q*t-r*o*v)+C*(r*t+q*o*v)+E*(p*v),J=C*(c.x+-q*p*u)+D*(c.y+r*p*u)+E*(c.z+o*u),K=F*(r*o*t+q*v)+G*(-p*t),L=F*(q*t-r*o*v)+G*(p*v),M=F*(c.y+r*p*u)+G*(c.z+o*u),N=-p*t,O=p*v,P=c.z+o*u,Q=e[s].x,R=e[s].y;w=Q*N-H,x=Q*O-I,y=Q*P-J,z=R*N-K,A=R*O-L,B=R*P-M,h+=z*A+w*x,l+=z*z+w*w,i+=z*B+w*y,k+=A*A+x*x,j+=A*B+x*y,m+=B*B+y*y}return h*=2,i*=2,j*=2,this.getMinimumErrorAngleFromParam(h,i,j,k,l,m,g)},optimizeParamZ:function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n=this._projection_mat_ref,o=a.sin_val,p=a.cos_val,q=b.sin_val,r=b.cos_val;h=i=j=k=l=m=0;for(var s=0;f>s;s++){var t,u,v;t=d[s].x,u=d[s].y,v=d[s].z;var w,x,y,z,A,B,C=n.m00,D=n.m01,E=n.m02,F=n.m11,G=n.m12,H=C*(-o*q*t-p*u+o*r*v)+D*(t*r+q*v),I=D*(o*t*q+p*u-o*v*r)+C*(r*t+q*v),J=C*c.x+D*c.y+E*(-p*q)*t+E*o*u+E*(r*p*v+c.z),K=F*(t*r+q*v),L=F*(o*t*q+p*u-o*v*r),M=F*c.y+G*(-p*q)*t+G*(o*u+r*p*v+c.z),N=0,O=0,P=-p*q*t+o*u+r*p*v+c.z,Q=e[s].x,R=e[s].y;w=Q*N-H,x=Q*O-I,y=Q*P-J,z=R*N-K,A=R*O-L,B=R*P-M,h+=z*A+w*x,l+=z*z+w*w,i+=z*B+w*y,k+=A*A+x*x,j+=A*B+x*y,m+=B*B+y*y}return h*=2,i*=2,j*=2,this.getMinimumErrorAngleFromParam(h,i,j,k,l,m,g)},modifyMatrix:function(a,b,c,d,e){var f=this.__angles_in,g=this.__ang;this.rotation2Sincos_ZXY(a,f,g),g.x+=this.optimizeParamX(f[1],f[2],b,c,d,e,g.x),g.y+=this.optimizeParamY(f[0],f[2],b,c,d,e,g.y),g.z+=this.optimizeParamZ(f[0],f[1],b,c,d,e,g.z),a.setZXYAngle_Number(g.x,g.y,g.z)},getMinimumErrorAngleFromParam:function(a,b,c,d,e,f,g){for(var h=this.__sin_table,i=(e-d)/a,j=b/a,k=-c/a,l=NyAREquationSolver.solve4Equation(-4*i*i-4,4*k-4*j*i,4*i*i-(k*k-4)-j*j,4*j*i-2*k,j*j-1,h),m=Number.MAX_VALUE,n=Number.MAX_VALUE,o=Number.MAX_VALUE,p=Number.MAX_VALUE,q=0;l>q;q++){var r=h[q],s=Math.sqrt(1-r*r),t=2*s*r*i+r*(k-r)+s*(s+j),u=2*-s*r*i+r*(k-r)+-s*(-s+j);t=0>t?-t:t,u=0>u?-u:u,s=u>t?s:-s;var v=Math.atan2(r,s),w=e*r*r+(a*s+b)*r+d*s*s+c*s+f;o>w?(p=o,n=m,o=w,m=v):p>w&&(p=w,n=v)}var x;x=m-g,x>Math.PI?x=m-2*Math.PI-g:x<-Math.PI&&(x=m+2*Math.PI-g);var y;return y=n-g,y>Math.PI?y=n-2*Math.PI-g:y<-Math.PI&&(y=n+2*Math.PI-g),Math.abs(y)<Math.abs(x)?y:x}}),TSinCosValue=ASKlass("TSinCosValue",{cos_val:0,sin_val:0,createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new TSinCosValue;return b}}),NyARRotMatrix=ASKlass("NyARRotMatrix",NyARDoubleMatrix33,{NyARRotMatrix:function(a){this.__initRot_vec1=new NyARRotVector(a),this.__initRot_vec2=new NyARRotVector(a)},__initRot_vec1:null,__initRot_vec2:null,initRotByPrevResult:function(a){this.m00=a.m00,this.m01=a.m01,this.m02=a.m02,this.m10=a.m10,this.m11=a.m11,this.m12=a.m12,this.m20=a.m20,this.m21=a.m21,this.m22=a.m22},initRotBySquare:function(a,b){var c=this.__initRot_vec1,d=this.__initRot_vec2;c.exteriorProductFromLinear(a[0],a[2]),c.checkVectorByVertex(b[0],b[1]),d.exteriorProductFromLinear(a[1],a[3]),d.checkVectorByVertex(b[3],b[0]),NyARRotVector.checkRotation(c,d),this.m00=c.v1,this.m10=c.v2,this.m20=c.v3,this.m01=d.v1,this.m11=d.v2,this.m21=d.v3;var e=c.v2*d.v3-c.v3*d.v2,f=c.v3*d.v1-c.v1*d.v3,g=c.v1*d.v2-c.v2*d.v1,h=Math.sqrt(e*e+f*f+g*g);this.m02=e/h,this.m12=f/h,this.m22=g/h},getPoint3d:function(a,b){var c=a.x,d=a.y,e=a.z;b.x=this.m00*c+this.m01*d+this.m02*e,b.y=this.m10*c+this.m11*d+this.m12*e,b.z=this.m20*c+this.m21*d+this.m22*e},getPoint3dBatch:function(a,b,c){for(var d=c-1;d>=0;d--){var e=b[d],f=a[d],g=f.x,h=f.y,i=f.z;e.x=this.m00*g+this.m01*h+this.m02*i,e.y=this.m10*g+this.m11*h+this.m12*i,e.z=this.m20*g+this.m21*h+this.m22*i}}}),NyARRotVector=ASKlass("NyARRotVector",{v1:0,v2:0,v3:0,_projection_mat_ref:null,_inv_cpara_array_ref:null,NyARRotVector:function(a){var b=new NyARMat(3,3),c=b.getArray();c[0][0]=a.m00,c[0][1]=a.m01,c[0][2]=a.m02,c[1][0]=a.m10,c[1][1]=a.m11,c[1][2]=a.m12,c[2][0]=a.m20,c[2][1]=a.m21,c[2][2]=a.m22,b.matrixSelfInv(),this._projection_mat_ref=a,this._inv_cpara_array_ref=b.getArray()},exteriorProductFromLinear:function(a,b){var c=this._projection_mat_ref,d=a.dy*b.dx-b.dy*a.dx,e=a.dx*b.c-b.dx*a.c,f=a.c*b.dy-b.c*a.dy,g=d*(c.m01*c.m12-c.m02*c.m11)+e*c.m11-f*c.m01,h=-d*c.m00*c.m12+f*c.m00,i=d*c.m00*c.m11,j=Math.sqrt(g*g+h*h+i*i);this.v1=g/j,this.v2=h/j,this.v3=i/j},checkVectorByVertex:function(a,b){var c,d=this._inv_cpara_array_ref,e=d[0][0]*a.x*10+d[0][1]*a.y*10+10*d[0][2],f=d[1][0]*a.x*10+d[1][1]*a.y*10+10*d[1][2],g=d[2][0]*a.x*10+d[2][1]*a.y*10+10*d[2][2],h=e+this.v1,i=f+this.v2,j=g+this.v3,k=this._projection_mat_ref;if(c=k.m20*e+k.m21*f+k.m22*g,0==c)throw new NyARException;var l=(k.m00*e+k.m01*f+k.m02*g)/c,m=(k.m10*e+k.m11*f+k.m12*g)/c;if(c=k.m20*h+k.m21*i+k.m22*j,0==c)throw new NyARException;var n=(k.m00*h+k.m01*i+k.m02*j)/c,o=(k.m10*h+k.m11*i+k.m12*j)/c,p=(b.x-a.x)*(n-l)+(b.y-a.y)*(o-m);0>p&&(this.v1=-this.v1,this.v2=-this.v2,this.v3=-this.v3)},checkRotation:function(a,b){var c,d,e=a.v1,f=a.v2,g=a.v3,h=b.v1,i=b.v2,j=b.v3,k=f*j-g*i,l=g*h-e*j,m=e*i-f*h;if(c=Math.sqrt(k*k+l*l+m*m),0==c)throw new NyARException;k/=c,l/=c,m/=c;var n=e*h+f*i+g*j;0>n&&(n=-n);var o=.5*(Math.sqrt(n+1)+Math.sqrt(1-n));if(l*e-f*k!=0?d=0:m*e-g*k!=0?(c=f,f=g,g=c,c=l,l=m,m=c,d=1):(c=e,e=g,g=c,c=k,k=m,m=c,d=2),l*e-f*k==0)throw new NyARException;var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;if(p=(f*m-l*g)/(l*e-f*k),q=l*o/(l*e-f*k),r=(e*m-k*g)/(k*f-e*l),s=k*o/(k*f-e*l),t=p*p+r*r+1,u=p*q+r*s,v=q*q+s*s-1,w=u*u-t*v,0>w)throw new NyARException;if(z=(-u+Math.sqrt(w))/t,x=p*z+q,y=r*z+s,C=(-u-Math.sqrt(w))/t,A=p*C+q,B=r*C+s,1==d&&(c=y,y=z,z=c,c=B,B=C,C=c,c=f,f=g,g=c,c=l,l=m,m=c,d=0),2==d&&(c=x,x=z,z=c,c=A,A=C,C=c,c=e,e=g,g=c,c=k,k=m,m=c,d=0),l*h-i*k!=0?d=0:m*h-j*k!=0?(c=i,i=j,j=c,c=l,l=m,m=c,d=1):(c=h,h=j,j=c,c=k,k=m,m=c,d=2),l*h-i*k==0)throw new NyARException;if(p=(i*m-l*j)/(l*h-i*k),q=l*o/(l*h-i*k),r=(h*m-k*j)/(k*i-h*l),s=k*o/(k*i-h*l),t=p*p+r*r+1,u=p*q+r*s,v=q*q+s*s-1,w=u*u-t*v,0>w)throw new NyARException;F=(-u+Math.sqrt(w))/t,D=p*F+q,E=r*F+s,I=(-u-Math.sqrt(w))/t,G=p*I+q,H=r*I+s,1==d&&(c=E,E=F,F=c,c=H,H=I,I=c,c=i,i=j,j=c,c=l,l=m,m=c,d=0),2==d&&(c=D,D=F,F=c,c=G,G=I,I=c,c=h,h=j,j=c,c=k,k=m,m=c,d=0);var J=x*D+y*E+z*F;0>J&&(J=-J);var K=x*G+y*H+z*I;0>K&&(K=-K);var L=A*D+B*E+C*F;0>L&&(L=-L);var M=A*G+B*H+C*I;0>M&&(M=-M),K>J?L>J?M>J?(a.v1=x,a.v2=y,a.v3=z,b.v1=D,b.v2=E,b.v3=F):(a.v1=A,a.v2=B,a.v3=C,b.v1=G,b.v2=H,b.v3=I):M>L?(a.v1=A,a.v2=B,a.v3=C,b.v1=D,b.v2=E,b.v3=F):(a.v1=A,a.v2=B,a.v3=C,b.v1=G,b.v2=H,b.v3=I):L>K?M>K?(a.v1=x,a.v2=y,a.v3=z,b.v1=G,b.v2=H,b.v3=I):(a.v1=A,a.v2=B,a.v3=C,b.v1=G,b.v2=H,b.v3=I):M>L?(a.v1=A,a.v2=B,a.v3=C,b.v1=D,b.v2=E,b.v3=F):(a.v1=A,a.v2=B,a.v3=C,b.v1=G,b.v2=H,b.v3=I)}}),INyARTransportVectorSolver=ASKlass("INyARTransportVectorSolver",{set2dVertex:function(a,b){},solveTransportVector:function(a,b){}}),NyARTransportVectorSolver=ASKlass("NyARTransportVectorSolver",INyARTransportVectorSolver,{_cx:null,_cy:null,_projection_mat:null,_nmber_of_vertex:0,NyARTransportVectorSolver:function(a,b){this._projection_mat=a,this._cx=new FloatVector(b),this._cy=new FloatVector(b)},_a00:0,_a01_10:0,_a02_20:0,_a11:0,_a12_21:0,_a22:0,set2dVertex:function(a,b){var c,d,e,f,g,h=this._cx,i=this._cy,j=this._projection_mat.m00,k=this._projection_mat.m01,l=this._projection_mat.m11,m=this._projection_mat.m12,n=this._projection_mat.m02;this._a00=b*j*j,this._a01_10=b*j*k,this._a11=b*(k*k+l*l),c=0,d=e=0;for(var o=0;b>o;o++)f=n-(h[o]=a[o].x),g=m-(i[o]=a[o].y),d+=f,e+=g,c+=f*f+g*g;this._a02_20=d*j,this._a12_21=k*d+l*e,this._a22=c,this._nmber_of_vertex=b},solveTransportVector:function(a,b){var c,d,e,f=this._nmber_of_vertex,g=this._projection_mat.m00,h=this._projection_mat.m01,i=this._projection_mat.m02,j=this._projection_mat.m11,k=this._projection_mat.m12,l=this._cx,m=this._cy;c=d=e=0;for(var n=0;f>n;n++){var o=a[n].z*l[n]-g*a[n].x-h*a[n].y-i*a[n].z,p=a[n].z*m[n]-j*a[n].y-k*a[n].z;c+=o,d+=p,e+=l[n]*o+m[n]*p}e=i*c+k*d-e,d=h*c+j*d,c=g*c;var q=this._a00,r=this._a01_10,s=this._a02_20,t=this._a11,u=this._a12_21,v=this._a22,w=v*d-u*e,x=u*d-t*e,y=r*e-s*d,z=u*u-t*v,A=s*u-r*v,B=s*t-r*u,C=q*z-r*A+s*B;b.x=(r*w-s*x+c*z)/C,b.y=-(q*w+s*y+c*A)/C,b.z=(q*x+r*y+c*B)/C}}),FLARTransMatResult=NyARTransMatResult,NyARMath=Klass({sqNorm_NyARDoublePoint2d:function(a,b){var c,d;return c=b.x-a.x,d=b.y-a.y,c*c+d*d},sqNorm_Number:function(a,b,c,d){var e,f;return e=c-a,f=d-b,e*e+f*f},sqNorm_NyARDoublePoint3d:function(a,b){var c,d,e;return c=b.x-a.x,d=b.y-a.y,e=b.z-a.z,c*c+d*d+e*e},cubeRoot:function(a){var b=Math.pow(Math.abs(a),1/3);return a>=0?b:-b}}),NyAREquationSolver=Klass({solve2Equation_3:function(a,b,c,d){return NyAS3Utils.assert(0!=a),this.solve2Equation_2b(b/a,c/a,d,0)},solve2Equation_2a:function(a,b,c){return this.solve2Equation_2b(a,b,c,0)},solve2Equation_2b:function(a,b,c,d){var e=a*a-4*b;return 0>e?0:0==e?(c[d+0]=-a/2,1):(e=Math.sqrt(e),c[d+0]=(-a+e)/2,c[d+1]=(-a-e)/2,2)},solve3Equation_4:function(a,b,c,d,e){return NyAS3Utils.assert(0!=a),this.solve3Equation_3(b/a,c/a,d/a,e)},solve3Equation_3:function(a,b,c,d){var e,f,g,h;if(f=a/3,g=f*f-b/3,h=(f*(b-2*f*f)-c)/2,0==(e=h*h-g*g*g))return h=NyARMath.cubeRoot(h),d[0]=2*h-f,d[1]=-h-f,2;if(e>0){var i=NyARMath.cubeRoot(h+(h>0?1:-1)*Math.sqrt(e)),j=g/i;return d[0]=i+j-f,1}e=2*Math.sqrt(g);var k=Math.acos(h/(g*e/2));return d[0]=e*Math.cos(k/3)-f,d[1]=e*Math.cos((k+2*Math.PI)/3)-f,d[2]=e*Math.cos((k+4*Math.PI)/3)-f,3},solve4Equation:function(a,b,c,d,e,f){NyAS3Utils.assert(0!=a);var g,h,i,j,k;g=b/a,h=c/a,i=d/a,j=e/a,k=g/4;var l,m,n,o=k*k;if(l=h-6*o,m=i+k*(-2*h+8*o),n=j+k*(-i+h*k)-3*o*o,0!=m){var p=this.solve3Equation_1(2*l,-4*n+l*l,-m*m);if(0>p)return 0;var q,r,s=Math.sqrt(p);switch(q=this.solve2Equation_2b(-s,(l+p)/2+s*m/(2*p),f,0)){case 0:break;case 1:f[0]=f[0]-k;break;case 2:f[0]=f[0]-k,f[1]=f[1]-k;break;default:throw new NyARException}switch(r=this.solve2Equation_2b(s,(l+p)/2-s*m/(2*p),f,q)){case 0:break;case 1:f[q+0]=f[q+0]-k;break;case 2:f[q+0]=f[q+0]-k,f[q+1]=f[q+1]-k;break;default:throw new NyARException}return q+r}var t,u,v=this.solve2Equation_2b(l,n,f,0);switch(v){case 0:return 0;case 1:return t=f[0],0>t?0:0==t?(f[0]=0-k,1):(t=Math.sqrt(t),f[0]=t-k,f[1]=-t-k,2);case 2:t=f[0],u=f[1];var w=0;return t>0&&(t=Math.sqrt(t),f[0]=t-k,f[1]=-t-k,w+=2),u>0&&(u=Math.sqrt(u),f[w+0]=u-k,f[w+1]=-u-k,w+=2),w;default:throw new NyARException}},solve3Equation_1:function(a,b,c){var d,e,f,g;if(e=a/3,f=e*e-b/3,g=(e*(b-2*e*e)-c)/2,0==(d=g*g-f*f*f))return g=NyARMath.cubeRoot(g),2*g-e;if(d>0){var h=NyARMath.cubeRoot(g+(g>0?1:-1)*Math.sqrt(d)),i=f/h;return h+i-e}d=2*Math.sqrt(f);var j=Math.acos(g/(f*d/2));return d*Math.cos(j/3)-e}}),NyARPerspectiveParamGenerator_O1=Klass({_local_x:0,_local_y:0,_width:0,_height:0,initialize:function(a,b,c,d){this._height=d,this._width=c,this._local_x=a,this._local_y=b},getParam:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_=this._local_x,aa=this._local_y,ba=_+this._width,ca=aa+this._height;H=a[0].x,I=a[1].x,J=a[2].x,K=a[3].x,d=-_*H,e=-aa*H,f=-ba*I,g=-aa*I,h=-ba*J,i=-ca*J,j=-_*K,k=-ca*K,B=h*k-i*j,E=i*_-ba*k,F=ba*j-h*_,C=ca*(i-k),D=ca*(j-h),G=ca*(ba-_),p=-f*E-g*F-ba*B,l=f*C+g*D+aa*B,t=g*G-ba*C+aa*E,x=-ba*D-f*G+aa*F,B=j*e-k*d,C=k*aa-ca*e,D=ca*d-j*aa,E=_*(k-e),F=_*(d-j),G=_*(aa-ca),m=-ca*B-h*C-i*D,q=h*E+i*F+ba*B,u=-i*G-ca*E+ba*C,y=-ca*F+h*G+ba*D,B=d*g-e*f,E=e*ba-_*g,F=_*f-d*ba,C=aa*(e-g),D=aa*(f-d),G=aa*(_-ba),r=-j*E-k*F-_*B,n=j*C+k*D+ca*B,v=k*G-_*C+ca*E,z=-_*D-j*G+ca*F,B=f*i-g*h,C=g*ca-aa*i,D=aa*h-f*ca,E=ba*(g-i),F=ba*(h-f),G=ba*(ca-aa),o=-aa*B-d*C-e*D,s=d*E+e*F+_*B,w=-e*G-aa*E+_*C,A=-aa*F+d*G+_*D,c=_*(l+o)+ba*(m+n),0==c&&(c=1e-4),c=1/c,L=(l*H+m*I+n*J+o*K)*c,M=(l+m+n+o)*c,N=(p*H+q*I+r*J+s*K)*c,O=(p+q+r+s)*c,P=(t*H+u*I+v*J+w*K)*c,Q=(t+u+v+w)*c,R=(x*H+y*I+z*J+A*K)*c,S=(x+y+z+A)*c,H=a[0].y,I=a[1].y,J=a[2].y,K=a[3].y,d=-_*H,e=-aa*H,f=-ba*I,g=-aa*I,h=-ba*J,i=-ca*J,j=-_*K,k=-ca*K,B=h*k-i*j,E=i*_-ba*k,F=ba*j-h*_,C=ca*(i-k),D=ca*(j-h),G=ca*(ba-_),p=-f*E-g*F-ba*B,l=f*C+g*D+aa*B,t=g*G-ba*C+aa*E,x=-ba*D-f*G+aa*F,B=j*e-k*d,C=k*aa-ca*e,D=ca*d-j*aa,E=_*(k-e),F=_*(d-j),G=_*(aa-ca),m=-ca*B-h*C-i*D,q=h*E+i*F+ba*B,u=-i*G-ca*E+ba*C,y=-ca*F+h*G+ba*D,B=d*g-e*f,E=e*ba-_*g,F=_*f-d*ba,C=aa*(e-g),D=aa*(f-d),G=aa*(_-ba),r=-j*E-k*F-_*B,n=j*C+k*D+ca*B,v=k*G-_*C+ca*E,z=-_*D-j*G+ca*F,B=f*i-g*h,C=g*ca-aa*i,D=aa*h-f*ca,E=ba*(g-i),F=ba*(h-f),G=ba*(ca-aa),o=-aa*B-d*C-e*D,s=d*E+e*F+_*B,w=-e*G-aa*E+_*C,A=-aa*F+d*G+_*D,c=_*(l+o)+ba*(m+n),0==c&&(c=1e-4),c=1/c,T=(l*H+m*I+n*J+o*K)*c,U=(l+m+n+o)*c,V=(p*H+q*I+r*J+s*K)*c,W=(p+q+r+s)*c,X=(t*H+u*I+v*J+w*K)*c,Y=(t+u+v+w)*c,Z=(x*H+y*I+z*J+A*K)*c,$=(x+y+z+A)*c,c=Q*-$- -Y*S,0==c&&(c=1e-4),c=1/c;var da,ea;return b[2]=da=-$*c*(P-X)+Y*c*(R-Z),b[5]=ea=-S*c*(P-X)+Q*c*(R-Z),b[6]=P-da*Q,b[7]=R-da*S,b[0]=L-da*M,b[1]=N-da*O,b[3]=T-ea*U,b[4]=V-ea*W,!0}}),NyIdMarkerParam=ASKlass("NyIdMarkerParam",{direction:0,threshold:0}),NyIdMarkerPattern=ASKlass("NyIdMarkerPattern",{model:0,ctrl_domain:0,ctrl_mask:0,check:0,data:new IntVector(32)}),TThreshold=ASKlass("TThreshold",{th_h:0,th_l:0,th:0,lt_x:0,lt_y:0,rb_x:0,rb_y:0}),THighAndLow=ASKlass("THighAndLow",{h:0,l:0}),_bit_table_3=new IntVector([25,26,27,28,29,30,31,48,9,10,11,12,13,32,47,24,1,2,3,14,33,46,23,8,0,4,15,34,45,22,7,6,5,16,35,44,21,20,19,18,17,36,43,42,41,40,39,38,37]),_bit_table_2=new IntVector([9,10,11,12,13,24,1,2,3,14,23,8,0,4,15,22,7,6,5,16,21,20,19,18,17]),MarkerPattEncoder=ASKlass("MarkerPattEncoder",{_bit_table_2:_bit_table_2,_bit_table_3:_bit_table_3,_bit_tables:[_bit_table_2,_bit_table_3,null,null,null,null,null],_bit_table:null,_bits:new IntVector(16),_work:new IntVector(16),_model:0,setBitByBitIndex:function(a,b){NyAS3Utils.assert(0==b||1==b);var c=this._bit_table[a];if(0==c)this._bits[0]=b;else{var d=toInt((c-1)/8)+1,e=(c-1)%8;this._bits[d]=this._bits[d]&~(1<<e)|b<<e}},setBit:function(a,b){if(NyAS3Utils.assert(0==b||1==b),0==a)this._bits[0]=b;else{var c=toInt((a-1)/8)+1,d=(a-1)%8;this._bits[c]=this._bits[c]&~(1<<d)|b<<d}},getBit:function(a){if(0==a)return this._bits[0];var b=toInt((a-1)/8)+1,c=(a-1)%8;return this._bits[b]>>c&1},getModel:function(){return this._model},getControlValue:function(a,b){var c;switch(a){case 2:return c=(14&b[2])>>1,c>=5?c-1:c;case 3:return c=(62&b[4])>>1,c>=21?c-1:c;case 4:case 5:case 6:case 7:}return-1},getCheckValue:function(a,b){var c;switch(a){case 2:return c=(224&b[2])>>5,c>5?c-1:c;case 3:return c=(128&b[4])>>7|(15&b[5])<<1,c>21?c-1:c;case 4:case 5:case 6:case 7:}return-1},initEncoder:function(a){return a>3||2>a?!1:(this._bit_table=this._bit_tables[a-2],this._model=a,!0)},getDirection:function(){var a,b,c,d,e;switch(this._model){case 2:b=31&this._bits[2],c=(240&this._bits[2])>>4|(1&this._bits[3])<<4,d=31&this._bits[3],a=(240&this._bits[3])>>4|(1&this._bits[2])<<4,e=10;break;case 3:b=127&this._bits[4],c=(192&this._bits[4])>>6|(31&this._bits[5])<<2,d=(240&this._bits[5])>>4|(7&this._bits[6])<<4,a=(252&this._bits[6])>>2|(1&this._bits[4])<<6,e=42;break;default:return-3}if(b==e){if(c==e)return d!=e&&a!=e?2:-2;if(a==e)return d!=e&&c!=e?3:-2}else if(d==e){if(c==e)return b!=e&&a!=e?1:-2;if(a==e)return b!=e&&c!=e?0:-2}return-1},encode:function(a){var b=this.getDirection();if(0>b)return-1;this.getRotatedBits(b,a.data);var c=this._model;a.model=c;var d=this.getControlValue(c,a.data);return a.check=this.getCheckValue(c,a.data),a.ctrl_mask=d%5,a.ctrl_domain=toInt(d/5),0!=a.ctrl_domain||0!=a.ctrl_mask?-1:b},getRotatedBits:function(a,b){var c,d=2*a,e=8-d;b[0]=this._bits[0],c=this._bits[1],b[1]=255&(c<<d|c>>e),d=4*a,e=16-d,c=this._bits[2]|this._bits[3]<<8,c=c<<d|c>>e,b[2]=255&c,b[3]=c>>8&255,this._model<2||(d=6*a,e=24-d,c=this._bits[4]|this._bits[5]<<8|this._bits[6]<<16,c=c<<d|c>>e,b[4]=255&c,b[5]=c>>8&255,b[6]=c>>16&255,this._model<3)},shiftLeft:function(a,b,c,d){var e,f=this._work,g=d%8;for(e=c-1;e>=1;e--)f[e]=a[e+b]<<g|255&a[e+b-1]>>8-g;f[0]=a[b]<<g|255&a[b+c-1]>>8-g;var h=toInt(d/8)%c;for(e=c-1;e>=0;e--)a[(h+e)%c+b]=255&f[e]}}),INyIdMarkerData=ASKlass("INyIdMarkerData",{isEqual:function(a){},copyFrom:function(a){}}),NyIdMarkerPickup=ASKlass("NyIdMarkerPickup",{_perspective_reader:null,__pickFromRaster_th:new TThreshold,__pickFromRaster_encoder:new MarkerPattEncoder,NyIdMarkerPickup:function(){this._perspective_reader=new PerspectivePixelReader},init:function(){this._perspective_reader.newFrame()},pickFromRaster:function(a,b,c,d){if(!this._perspective_reader.setSourceSquare(b))return window.DEBUG&&console.log("NyIdMarkerPickup.pickFromRaster: could not setSourceSquare"),!1;var e=a.getGrayPixelReader(),f=a.getSize(),g=this.__pickFromRaster_th,h=this.__pickFromRaster_encoder;if(this._perspective_reader.detectThresholdValue(e,f,g),!this._perspective_reader.readDataBits(e,f,g,h))return window.DEBUG&&console.log("NyIdMarkerPickup.pickFromRaster: could not readDataBits"),!1;var i=h.encode(c);return 0>i?(window.DEBUG&&console.log("NyIdMarkerPickup.pickFromRaster: could not encode"),!1):(d.direction=i,d.threshold=g.th,!0)}}),PerspectivePixelReader=ASKlass("PerspectivePixelReader",{_param_gen:new NyARPerspectiveParamGenerator_O1(1,1,100,100),_cparam:new FloatVector(8),PerspectivePixelReader:function(){},maxPreviousFrameAge:1,newFrame:function(){for(var a in this.previousFrames){var b=this.previousFrames[a];b.age++,b.age>this.maxPreviousFrameAge&&delete this.previousFrames[a]}},setSourceSquare:function(a){for(var b=0,c=0,d=0;4>d;d++)b+=a[d].x,c+=a[d].y;b/=4,c/=4;var e=toInt(b/10),f=toInt(c/10);return this.centerPoint[0]=e,this.centerPoint[1]=f,this._param_gen.getParam(a,this._cparam)},rectPixels:function(a,b,c,d,e,f,g,h,i,j){for(var k=this._cparam,l=this._ref_x,m=this._ref_y,n=this._pixcel_temp,o=b.w,p=b.h,q=i,r=k[6],s=k[0],t=k[3],u=0;h>u;u++){var v,w=1+u*f+d,x=k[1]*w+k[2],y=k[4]*w+k[5],z=k[7]*w+1,A=0;for(v=0;g>v;v++){var B=1+v*e+c,C=r*B+z,D=toInt((s*B+x)/C),E=toInt((t*B+y)/C);if(0>D||0>E||D>=o||E>=p)return!1;l[A]=D,m[A]=E,A++}for(a.getPixelSet(l,m,g,n),v=0;g>v;v++){var F=v;j[q]=n[F],q++}}return!0},checkFreqWidth:function(a,b){for(var c=a[1]-a[0],d=2*b-1,e=1;d>e;e++){var f=a[e+1]-a[e],g=100*f/c;if(g>150||50>g)return!1;c=f}return!0},getMaxFreq:function(a,b,c){var d,e=-1,f=0;for(d=0;d<this.MAX_FREQ;d++)f<a[d]&&(e=d,f=a[d]);if(-1==e)return-1;var g=(e-1)*e;for(d=0;2*e>d;d++)c[d]=b[g+d]*this.FRQ_STEP/f;return e},FRQ_EDGE:10,FRQ_STEP:2,FRQ_POINTS:45,MIN_FREQ:3,MAX_FREQ:10,FREQ_SAMPLE_NUM:4,MAX_DATA_BITS:19,_ref_x:new IntVector(108),_ref_y:new IntVector(108),_pixcel_temp:new IntVector(108),_freq_count_table:new IntVector(10),_freq_table:new IntVector(190),getRowFrequency:function(a,b,c,d,e,f){var g,h=this._freq_count_table,i=this._freq_table,j=this._cparam,k=this._ref_x,l=this._ref_y,m=this._pixcel_temp;for(g=0;10>g;g++)h[g]=0;for(g=0;110>g;g++)i[g]=0;var n,o=b.w,p=b.h,q=j[0],r=j[3],s=j[6];for(window.DEBUG&&(n=document.getElementById("debugCanvas").getContext("2d"),n.fillStyle="orange"),g=0;g<this.FREQ_SAMPLE_NUM;g++){var t,u=1+c+g,v=j[1]*u+j[2],w=j[4]*u+j[5],x=j[7]*u+1,y=0;for(t=0;t<this.FRQ_POINTS;t++){var z=1+t*this.FRQ_STEP+this.FRQ_EDGE,A=s*z+x,B=toInt((q*z+v)/A),C=toInt((r*z+w)/A);if(0>B||0>C||B>=o||C>=p)return-1;k[y]=B,l[y]=C,y++}if(a.getPixelSet(k,l,this.FRQ_POINTS,m),window.DEBUG)for(var D=0;D<this.FRQ_POINTS;D++)n.fillRect(k[D],l[D],1,1);var E=this.getFreqInfo(m,d,e,f);if(!(E<this.MIN_FREQ||E>this.MAX_FREQ)&&this.checkFreqWidth(f,E)){h[E]++;var F=(E-1)*E;for(t=0;2*E>t;t++)i[F+t]+=f[t]}}return this.getMaxFreq(h,i,f)},getColFrequency:function(a,b,c,d,e,f){var g,h=this._cparam,i=this._ref_x,j=this._ref_y,k=this._pixcel_temp,l=this._freq_count_table;for(g=0;10>g;g++)l[g]=0;var m=this._freq_table;for(g=0;110>g;g++)m[g]=0;var n,o=b.w,p=b.h,q=h[7],r=h[4],s=h[1];for(window.DEBUG&&(n=document.getElementById("debugCanvas").getContext("2d"),n.fillStyle="green"),g=0;g<this.FREQ_SAMPLE_NUM;g++){var t,u=1+g+c,v=h[6]*u,w=h[0]*u+h[2],x=h[3]*u+h[5],y=0;for(t=0;t<this.FRQ_POINTS;t++){var z=1+t*this.FRQ_STEP+this.FRQ_EDGE,A=v+q*z+1,B=toInt((w+s*z)/A),C=toInt((x+r*z)/A);if(0>B||0>C||B>=o||C>=p)return-1;i[y]=B,j[y]=C,y++}if(a.getPixelSet(i,j,this.FRQ_POINTS,k),window.DEBUG)for(var D=0;D<this.FRQ_POINTS;D++)n.fillRect(i[D],j[D],1,1);var E=this.getFreqInfo(k,d,e,f);if(!(E<this.MIN_FREQ||E>this.MAX_FREQ)&&this.checkFreqWidth(f,E)){l[E]++;var F=(E-1)*E;for(t=0;2*E>t;t++)m[F+t]+=f[t]}}return this.getMaxFreq(l,m,f)},getFreqInfo:function(a,b,c,d){for(var e,f,g=0,h=0,i=0;g<this.FRQ_POINTS;){for(;g<this.FRQ_POINTS;){if(e=g,f=a[e],f>b){d[h+i]=g,h++;break}g++}for(g++;g<this.FRQ_POINTS;){if(e=g,f=a[e],c>=f){d[h+i]=g,i++;break}g++}g++}return h==i?h:-1},THRESHOLD_EDGE:10,THRESHOLD_STEP:2,THRESHOLD_WIDTH:10,THRESHOLD_PIXEL:5,THRESHOLD_SAMPLE:25,THRESHOLD_SAMPLE_LT:10,THRESHOLD_SAMPLE_RB:80,getPtailHighAndLow:function(a,b){var c,d,e,f,g,h,i,j;c=d=e=f=g=h=i=j=a[0];for(var k=a.length-1;k>=1;k--){var l=a[k];l>f&&(l>e?l>d?l>c?(f=e,e=d,d=c,c=l):(f=e,e=d,d=l):(f=e,e=l):f=l),j>l&&(i>l?h>l?g>l?(j=i,i=h,h=g,g=l):(j=i,i=h,h=l):(j=i,i=l):j=l)}b.l=(j+i+h+g)/4,b.h=(f+e+d+c)/4},__detectThresholdValue_hl:new THighAndLow,__detectThresholdValue_tpt:new NyARIntPoint2d,_th_pixels:new IntVector(100),detectThresholdValue:function(a,b,c){var d=this._th_pixels;this.rectPixels(a,b,this.THRESHOLD_SAMPLE_LT,this.THRESHOLD_SAMPLE_LT,this.THRESHOLD_STEP,this.THRESHOLD_STEP,this.THRESHOLD_PIXEL,this.THRESHOLD_PIXEL,0,d),this.rectPixels(a,b,this.THRESHOLD_SAMPLE_LT,this.THRESHOLD_SAMPLE_RB,this.THRESHOLD_STEP,this.THRESHOLD_STEP,this.THRESHOLD_PIXEL,this.THRESHOLD_PIXEL,this.THRESHOLD_SAMPLE,d),this.rectPixels(a,b,this.THRESHOLD_SAMPLE_RB,this.THRESHOLD_SAMPLE_LT,this.THRESHOLD_STEP,this.THRESHOLD_STEP,this.THRESHOLD_PIXEL,this.THRESHOLD_PIXEL,2*this.THRESHOLD_SAMPLE,d),this.rectPixels(a,b,this.THRESHOLD_SAMPLE_RB,this.THRESHOLD_SAMPLE_RB,this.THRESHOLD_STEP,this.THRESHOLD_STEP,this.THRESHOLD_PIXEL,this.THRESHOLD_PIXEL,3*this.THRESHOLD_SAMPLE,d);var e=this.__detectThresholdValue_hl;this.getPtailHighAndLow(d,e);var f=(e.h+e.l)/2,g=(e.h-e.l)/5;c.th=f,c.th_h=f+g,c.th_l=f-g;var h,i,j,k,l,m,n,o,p=this.__detectThresholdValue_tpt;this.getHighPixelCenter(0,d,this.THRESHOLD_PIXEL,this.THRESHOLD_PIXEL,f,p)?(h=p.x*this.THRESHOLD_STEP,i=p.y*this.THRESHOLD_STEP):(h=11,i=11),this.getHighPixelCenter(1*this.THRESHOLD_SAMPLE,d,this.THRESHOLD_PIXEL,this.THRESHOLD_PIXEL,f,p)?(j=p.x*this.THRESHOLD_STEP,k=p.y*this.THRESHOLD_STEP):(j=11,k=-1),this.getHighPixelCenter(2*this.THRESHOLD_SAMPLE,d,this.THRESHOLD_PIXEL,this.THRESHOLD_PIXEL,f,p)?(l=p.x*this.THRESHOLD_STEP,m=p.y*this.THRESHOLD_STEP):(l=-1,m=11),this.getHighPixelCenter(3*this.THRESHOLD_SAMPLE,d,this.THRESHOLD_PIXEL,this.THRESHOLD_PIXEL,f,p)?(n=p.x*this.THRESHOLD_STEP,o=p.y*this.THRESHOLD_STEP):(n=-1,o=-1),c.lt_x=(h+j)/2+this.THRESHOLD_SAMPLE_LT-1,c.rb_x=(l+n)/2+this.THRESHOLD_SAMPLE_RB+1,c.lt_y=(i+m)/2+this.THRESHOLD_SAMPLE_LT-1,c.rb_y=(k+o)/2+this.THRESHOLD_SAMPLE_RB+1},getHighPixelCenter:function(a,b,c,d,e,f){for(var g=a,h=0,i=0,j=0,k=0;d>k;k++)for(var l=0;c>l;l++)b[g++]>e&&(h+=l,i+=k,j++);return j>0?(h/=j,i/=j,f.x=h,f.y=i,!0):!1},__detectDataBitsIndex_freq_index1:new IntVector(45),__detectDataBitsIndex_freq_index2:new IntVector(45),detectDataBitsIndex:function(a,b,c,d,e){var f,g=this.__detectDataBitsIndex_freq_index1,h=this.__detectDataBitsIndex_freq_index2,i=(c.rb_y-c.lt_y,this.getRowFrequency(a,b,c.lt_y,c.th_h,c.th_l,g)),j=this.getRowFrequency(a,b,c.rb_y,c.th_h,c.th_l,h);
if(0>i&&0>j||i==j)return window.DEBUG&&console.log("bad row frq",i,j),-1;var k,l,m;for(i>j?(k=i,m=g):(k=j,m=h),f=0;k+k-1>f;f++)d[2*f]=2*(m[f+1]-m[f])/5+m[f]+this.FRQ_EDGE,d[2*f+1]=3*(m[f+1]-m[f])/5+m[f]+this.FRQ_EDGE;var n=(c.rb_x-c.lt_x,this.getColFrequency(a,b,c.lt_x,c.th_h,c.th_l,g)),o=this.getColFrequency(a,b,c.rb_x,c.th_h,c.th_l,h);if(0>n&&0>o||n==o)return window.DEBUG&&console.log("bad col frq",n,o),-1;if(n>o?(l=n,m=g):(l=o,m=h),l!=k)return window.DEBUG&&console.log("freq mismatch",l,k),-1;for(f=0;l+l-1>f;f++){var p=m[f],q=m[f+1]-p;e[2*f]=2*q/5+p+this.FRQ_EDGE,e[2*f+1]=3*q/5+p+this.FRQ_EDGE}return l>this.MAX_FREQ?(window.DEBUG&&console.log("too high freq",l),-1):l},__readDataBits_index_bit_x:new FloatVector(38),__readDataBits_index_bit_y:new FloatVector(38),previousFrames:{},centerPoint:new IntVector(2),getPreviousFrameSize:function(a,b){var c=this.centerPoint[0],d=this.centerPoint[1],e=this.previousFrames,f=e[c+":"+d]||e[c-1+":"+d]||e[c+1+":"+d]||e[c+":"+(d-1)]||e[c-1+":"+(d-1)]||e[c+1+":"+(d-1)]||e[c+":"+(d+1)]||e[c-1+":"+(d+1)]||e[c+1+":"+(d+1)];return f?(a.set(f.index_x),b.set(f.index_y),f.size):-1},setPreviousFrameSize:function(a,b,c){var d=this.previousFrames[this.centerPoint[0]+":"+this.centerPoint[1]];return d?(d.age=0,d.size=a,d.index_x.set(b),void d.index_y.set(c)):(d={age:0,size:a,index_x:new FloatVector(b),index_y:new FloatVector(c)},void(this.previousFrames[this.centerPoint[0]+":"+this.centerPoint[1]]=d))},readDataBits:function(a,b,c,d){var e=this.__readDataBits_index_bit_x,f=this.__readDataBits_index_bit_y,g=this.detectDataBitsIndex(a,b,c,e,f);0>g&&(g=this.getPreviousFrameSize(e,f));var h=g+g-1;if(0>g)return window.DEBUG&&console.log("readDataBits: size < 0"),!1;if(!d.initEncoder(g-1))return window.DEBUG&&console.log("readDataBits: initEncoder"),!1;for(var i=this._cparam,j=this._ref_x,k=this._ref_y,l=this._pixcel_temp,m=i[0],n=i[1],o=i[3],p=i[6],q=c.th,r=0,s=0;h>s;s++){var t,u=1+f[2*s+0],v=1+f[2*s+1],w=n*u+i[2],x=i[4]*u+i[5],y=i[7]*u+1,z=n*v+i[2],A=i[4]*v+i[5],B=i[7]*v+1,C=0;for(t=0;h>t;t++){var D,E=1+e[2*t+0],F=1+e[2*t+1],G=p*E,H=m*E,I=o*E,J=p*F,K=m*F,L=o*F;D=G+y,j[C]=toInt((H+w)/D),k[C]=toInt((I+x)/D),C++,D=G+B,j[C]=toInt((H+z)/D),k[C]=toInt((I+A)/D),C++,D=J+y,j[C]=toInt((K+w)/D),k[C]=toInt((L+x)/D),C++,D=J+B,j[C]=toInt((K+z)/D),k[C]=toInt((L+A)/D),C++}for(a.getPixelSet(j,k,4*h,l),t=0;h>t;t++){var M=4*t,N=(l[M+0]+l[M+1]+l[M+2]+l[M+3])/4;d.setBitByBitIndex(r,N>q?0:1),r++}}return this.setPreviousFrameSize(g,e,f),!0},setSquare:function(a){return this._param_gen.getParam(a,this._cparam)?!0:!1}}),MarkerPattDecoder=ASKlass("MarkerPattDecoder",{decode:function(a,b,c){}}),INyIdMarkerDataEncoder=ASKlass("INyIdMarkerDataEncoder",{encode:function(a,b){},createDataInstance:function(){}}),NyIdMarkerDataEncoder_RawBit=ASKlass("NyIdMarkerDataEncoder_RawBit",INyIdMarkerDataEncoder,{_DOMAIN_ID:0,_mod_data:new IntVector([7,31,127,511,2047,4095]),encode:function(a,b){var c=b;if(a.ctrl_domain!=this._DOMAIN_ID)return!1;for(var d=2*a.model-1,e=d*d/8+1,f=0,g=0;e>g;g++)c.packet[g]=a.data[g],f+=a.data[g];return f%=this._mod_data[a.model-2],a.check!=f?!1:(c.length=e,!0)},createDataInstance:function(){return new NyIdMarkerData_RawBit}}),NyIdMarkerData_RawBit=ASKlass("NyIdMarkerData_RawBit",INyIdMarkerData,{packet:new IntVector(22),length:0,isEqual:function(a){var b=a;if(b.length!=this.length)return!1;for(var c=b.length-1;c>=0;c--)if(b.packet[c]!=this.packet[c])return!1;return!0},copyFrom:function(a){var b=a;ArrayUtils.copyInt(b.packet,0,this.packet,0,b.length),this.length=b.length}}),INyARColorPatt=ASKlass("INyARColorPatt",INyARRgbRaster,{pickFromRaster:function(a,b){}}),NyARColorPatt_Perspective=ASKlass("NyARColorPatt_Perspective",INyARColorPatt,{_patdata:null,_pickup_lt:new NyARIntPoint2d,_resolution:0,_size:null,_perspective_gen:null,_pixelreader:null,LOCAL_LT:1,BUFFER_FORMAT:NyARBufferType.INT1D_X8R8G8B8_32,initializeInstance:function(a,b,c){NyAS3Utils.assert(a>2&&b>2),this._resolution=c,this._size=new NyARIntSize(a,b),this._patdata=new IntVector(b*a),this._pixelreader=new NyARRgbPixelReader_INT1D_X8R8G8B8_32(this._patdata,this._size)},NyARColorPatt_Perspective:function(a,b,c,d){null==d&&(d=-1),-1==d?(this.initializeInstance(a,b,c),this.setEdgeSize(0,0,c)):(this.initializeInstance(a,b,c),this.setEdgeSizeByPercent(d,d,c))},setEdgeSize:function(a,b,c){NyAS3Utils.assert(a>=0),NyAS3Utils.assert(b>=0),this._perspective_gen=new NyARPerspectiveParamGenerator_O1(this.LOCAL_LT,this.LOCAL_LT,(2*a+this._size.w)*c,(2*b+this._size.h)*c),this._pickup_lt.x=a*c+this.LOCAL_LT,this._pickup_lt.y=b*c+this.LOCAL_LT},setEdgeSizeByPercent:function(a,b,c){NyAS3Utils.assert(a>=0),NyAS3Utils.assert(b>=0),this.setEdgeSize(this._size.w*a/50,this._size.h*b/50,c)},getWidth:function(){return this._size.w},getHeight:function(){return this._size.h},getSize:function(){return this._size},getRgbPixelReader:function(){return this._pixelreader},getBuffer:function(){return this._patdata},hasBuffer:function(){return null!=this._patdata},wrapBuffer:function(a){NyARException.notImplement()},getBufferType:function(){return this.BUFFER_FORMAT},isEqualBufferType:function(a){return this.BUFFER_FORMAT==a},__pickFromRaster_rgb_tmp:new IntVector(3),__pickFromRaster_cpara:new FloatVector(8),pickFromRaster:function(a,b){var c=this.__pickFromRaster_cpara;if(!this._perspective_gen.getParam(b,c))return!1;for(var d=this._resolution,e=a.getWidth(),f=a.getHeight(),g=d*d,h=this.__pickFromRaster_rgb_tmp,i=a.getRgbPixelReader(),j=0,k=0;k<this._size.h*d;k+=d)for(var l=0;l<this._size.w*d;l+=d){var m,n,o;m=n=o=0;for(var p=k;k+d>p;p++)for(var q=this._pickup_lt.y+p,r=l;l+d>r;r++){var s=this._pickup_lt.x+r,t=c[6]*s+c[7]*q+1,u=toInt((c[0]*s+c[1]*q+c[2])/t),v=toInt((c[3]*s+c[4]*q+c[5])/t);0>u&&(u=0),u>=e&&(u=e-1),0>v&&(v=0),v>=f&&(v=f-1),i.getPixel(u,v,h),m+=h[0],n+=h[1],o+=h[2]}m/=g,n/=g,o/=g,this._patdata[j]=(255&m)<<16|(255&n)<<8|255&o,j++}return!0}}),NyARColorPatt_Perspective_O2=ASKlass("NyARColorPatt_Perspective_O2",NyARColorPatt_Perspective,{_pickup:null,NyARColorPatt_Perspective_O2:function(a,b,c,d){switch(NyARColorPatt_Perspective.initialize.call(this,a,b,c,d),c){case 1:this._pickup=new NyARPickFromRaster_1(this._pickup_lt,this._size);break;case 2:this._pickup=new NyARPickFromRaster_2x(this._pickup_lt,this._size);break;case 4:this._pickup=new NyARPickFromRaster_4x(this._pickup_lt,this._size);break;default:this._pickup=new NyARPickFromRaster_N(this._pickup_lt,c,this._size)}},pickFromRaster:function(a,b){var c=this.__pickFromRaster_cpara;return this._perspective_gen.getParam(b,c)?(this._pickup.pickFromRaster(c,a,this._patdata),!0):!1}}),IpickFromRaster_Impl=ASKlass("IpickFromRaster_Impl",{pickFromRaster:function(a,b,c){}}),NyARPickFromRaster_1=ASKlass("NyARPickFromRaster_1",IpickFromRaster_Impl,{_size_ref:null,_lt_ref:null,NyARPickFromRaster_1:function(a,b){this._lt_ref=a,this._size_ref=b,this._rgb_temp=new IntVector(3*b.w),this._rgb_px=new IntVector(b.w),this._rgb_py=new IntVector(b.w)},_rgb_temp:null,_rgb_px:null,_rgb_py:null,pickFromRaster:function(a,b,c){for(var d,e,f,g,h,i,j=b.getWidth(),k=b.getHeight(),l=this._size_ref.w,m=this._rgb_temp,n=this._rgb_px,o=this._rgb_py,p=a[0],q=a[3],r=a[6],s=a[1],t=a[4],u=a[7],v=this._lt_ref.y,w=this._lt_ref.x,x=b.getRgbPixelReader(),y=0,z=s*v+a[2]+p*w,A=t*v+a[5]+q*w,B=u*v+1+r*w,C=this._size_ref.h-1;C>=0;C--){e=1/B,d=-r/(B*(B+r)),h=z,i=A;var D;for(D=l-1;D>=0;D--)f=n[D]=toInt(h*e),g=o[D]=toInt(i*e),(0>f||f>=j||0>g||g>=k)&&(0>f?n[D]=0:f>=j&&(n[D]=j-1),0>g?o[D]=0:g>=k&&(o[D]=k-1)),h+=p,i+=q,e+=d;for(z+=s,A+=t,B+=u,x.getPixelSet(n,o,l,m),D=l-1;D>=0;D--){var E=3*D;c[y]=m[E]<<16|m[E+1]<<8|255&m[E+2],y++}}}}),NyARPickFromRaster_2x=ASKlass("NyARPickFromRaster_2x",IpickFromRaster_Impl,{_size_ref:null,_lt_ref:null,NyARPickFromRaster_2x:function(a,b){this._lt_ref=a,this._size_ref=b,this._rgb_temp=new IntVector(4*b.w*3),this._rgb_px=new IntVector(4*b.w),this._rgb_py=new IntVector(4*b.w)},_rgb_temp:null,_rgb_px:null,_rgb_py:null,pickFromRaster:function(a,b,c){for(var d,e,f,g,h,i,j,k,l,m,n=b.getWidth(),o=b.getHeight(),p=this._size_ref.w,q=this._rgb_temp,r=this._rgb_px,s=this._rgb_py,t=a[0],u=a[3],v=a[6],w=a[1],x=a[4],y=a[7],z=this._lt_ref.y,A=this._lt_ref.x,B=b.getRgbPixelReader(),C=0,D=w*z+a[2]+t*A,E=x*z+a[5]+u*A,F=y*z+1+v*A,G=D+w,H=E+x,I=F+y,J=w+w,K=y+y,L=x+x,M=this._size_ref.h-1;M>=0;M--){j=D,k=E,l=G,m=H,e=1/F,d=-v/(F*(F+v)),g=1/I,f=-v/(I*(I+v));var N,O=2*p*2-1;for(N=2*p-1;N>=0;N--)h=r[O]=toInt(j*e),i=s[O]=toInt(k*e),(0>h||h>=n||0>i||i>=o)&&(0>h?r[O]=0:h>=n&&(r[O]=n-1),0>i?s[O]=0:i>=o&&(s[O]=o-1)),j+=t,k+=u,e+=d,O--,h=r[O]=toInt(l*g),i=s[O]=toInt(m*g),(0>h||h>=n||0>i||i>=o)&&(0>h?r[O]=0:h>=n&&(r[O]=n-1),0>i?s[O]=0:i>=o&&(s[O]=o-1)),l+=t,m+=u,g+=f,O--;for(F+=K,I+=K,D+=J,E+=L,G+=J,H+=L,B.getPixelSet(r,s,4*p,q),N=p-1;N>=0;N--){var P=12*N,Q=(q[P+0]+q[P+3]+q[P+6]+q[P+9])/4,R=(q[P+1]+q[P+4]+q[P+7]+q[P+10])/4,S=(q[P+2]+q[P+5]+q[P+8]+q[P+11])/4;c[C]=Q<<16|R<<8|255&S,C++}}}}),NyARPickFromRaster_4x=ASKlass("NyARPickFromRaster_4x",IpickFromRaster_Impl,{_size_ref:null,_lt_ref:null,NyARPickFromRaster_4x:function(a,b){this._lt_ref=a,this._size_ref=b,this._rgb_temp=new IntVector(48),this._rgb_px=new IntVector(16),this._rgb_py=new IntVector(16)},_rgb_temp:null,_rgb_px:null,_rgb_py:null,pickFromRaster:function(a,b,c){for(var d,e,f,g,h,i,j,k,l,m,n=this._rgb_px,o=this._rgb_py,p=b.getWidth(),q=b.getHeight(),r=this._rgb_temp,s=a[0],t=a[3],u=a[6],v=a[1],w=a[2],x=a[4],y=a[5],z=a[7],A=this._lt_ref.x,B=b.getRgbPixelReader(),C=0,D=this._lt_ref.y,E=this._size_ref.h-1;E>=0;E--,D+=4)for(var F=v*D+w,G=x*D+y,H=z*D+1,I=F+v,J=I+v,K=J+v,L=G+x,M=L+x,N=M+x,O=A,P=this._size_ref.w-1;P>=0;P--,O+=4)h=u*O,i=s*O,j=t*O,h+=H,g=1/h,f=-z/((h+z)*h),d=n[0]=toInt((i+F)*g),e=o[0]=toInt((j+G)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[0]=0:d>=p&&(n[0]=p-1),0>e?o[0]=0:e>=q&&(o[0]=q-1)),g+=f,d=n[4]=toInt((i+I)*g),e=o[4]=toInt((j+L)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[4]=0:d>=p&&(n[4]=p-1),0>e?o[4]=0:e>=q&&(o[4]=q-1)),g+=f,d=n[8]=toInt((i+J)*g),e=o[8]=toInt((j+M)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[8]=0:d>=p&&(n[8]=p-1),0>e?o[8]=0:e>=q&&(o[8]=q-1)),g+=f,d=n[12]=toInt((i+K)*g),e=o[12]=toInt((j+N)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[12]=0:d>=p&&(n[12]=p-1),0>e?o[12]=0:e>=q&&(o[12]=q-1)),h+=u,i+=s,j+=t,g=1/h,f=-z/((h+z)*h),d=n[1]=toInt((i+F)*g),e=o[1]=toInt((j+G)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[1]=0:d>=p&&(n[1]=p-1),0>e?o[1]=0:e>=q&&(o[1]=q-1)),g+=f,d=n[5]=toInt((i+I)*g),e=o[5]=toInt((j+L)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[5]=0:d>=p&&(n[5]=p-1),0>e?o[5]=0:e>=q&&(o[5]=q-1)),g+=f,d=n[9]=toInt((i+J)*g),e=o[9]=toInt((j+M)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[9]=0:d>=p&&(n[9]=p-1),0>e?o[9]=0:e>=q&&(o[9]=q-1)),g+=f,d=n[13]=toInt((i+K)*g),e=o[13]=toInt((j+N)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[13]=0:d>=p&&(n[13]=p-1),0>e?o[13]=0:e>=q&&(o[13]=q-1)),h+=u,i+=s,j+=t,g=1/h,f=-z/((h+z)*h),d=n[2]=toInt((i+F)*g),e=o[2]=toInt((j+G)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[2]=0:d>=p&&(n[2]=p-1),0>e?o[2]=0:e>=q&&(o[2]=q-1)),g+=f,d=n[6]=toInt((i+I)*g),e=o[6]=toInt((j+L)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[6]=0:d>=p&&(n[6]=p-1),0>e?o[6]=0:e>=q&&(o[6]=q-1)),g+=f,d=n[10]=toInt((i+J)*g),e=o[10]=toInt((j+M)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[10]=0:d>=p&&(n[10]=p-1),0>e?o[10]=0:e>=q&&(o[10]=q-1)),g+=f,d=n[14]=toInt((i+K)*g),e=o[14]=toInt((j+N)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[14]=0:d>=p&&(n[14]=p-1),0>e?o[14]=0:e>=q&&(o[14]=q-1)),h+=u,i+=s,j+=t,g=1/h,f=-z/((h+z)*h),d=n[3]=toInt((i+F)*g),e=o[3]=toInt((j+G)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[3]=0:d>=p&&(n[3]=p-1),0>e?o[3]=0:e>=q&&(o[3]=q-1)),g+=f,d=n[7]=toInt((i+I)*g),e=o[7]=toInt((j+L)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[7]=0:d>=p&&(n[7]=p-1),0>e?o[7]=0:e>=q&&(o[7]=q-1)),g+=f,d=n[11]=toInt((i+J)*g),e=o[11]=toInt((j+M)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[11]=0:d>=p&&(n[11]=p-1),0>e?o[11]=0:e>=q&&(o[11]=q-1)),g+=f,d=n[15]=toInt((i+K)*g),e=o[15]=toInt((j+N)*g),(0>d||d>=p||0>e||e>=q)&&(0>d?n[15]=0:d>=p&&(n[15]=p-1),0>e?o[15]=0:e>=q&&(o[15]=q-1)),B.getPixelSet(n,o,16,r),k=(r[0]+r[3]+r[6]+r[9]+r[12]+r[15]+r[18]+r[21]+r[24]+r[27]+r[30]+r[33]+r[36]+r[39]+r[42]+r[45])/16,l=(r[1]+r[4]+r[7]+r[10]+r[13]+r[16]+r[19]+r[22]+r[25]+r[28]+r[31]+r[34]+r[37]+r[40]+r[43]+r[46])/16,m=(r[2]+r[5]+r[8]+r[11]+r[14]+r[17]+r[20]+r[23]+r[26]+r[29]+r[32]+r[35]+r[38]+r[41]+r[44]+r[47])/16,c[C]=(255&k)<<16|(255&l)<<8|255&m,C++}}),NyARPickFromRaster_N=ASKlass("NyARPickFromRaster_N",IpickFromRaster_Impl,{_resolution:0,_size_ref:null,_lt_ref:null,NyARPickFromRaster_N:function(a,b,c){this._lt_ref=a,this._resolution=b,this._size_ref=c,this._rgb_temp=new IntVector(b*b*3),this._rgb_px=new IntVector(b*b),this._rgb_py=new IntVector(b*b),this._cp1cy_cp2=new FloatVector(b),this._cp4cy_cp5=new FloatVector(b),this._cp7cy_1=new FloatVector(b)},_rgb_temp:null,_rgb_px:null,_rgb_py:null,_cp1cy_cp2:null,_cp4cy_cp5:null,_cp7cy_1:null,pickFromRaster:function(a,b,c){for(var d,e,f,g,h,i,j,k,l=this._resolution,m=l*l,n=b.getWidth(),o=b.getHeight(),p=this._rgb_temp,q=this._rgb_px,r=this._rgb_py,s=this._cp1cy_cp2,t=this._cp4cy_cp5,u=this._cp7cy_1,v=a[0],w=a[3],x=a[6],y=a[1],z=a[2],A=a[4],B=a[5],C=a[7],D=this._lt_ref.y,E=this._lt_ref.x,F=b.getRgbPixelReader(),G=0,H=0;H<this._size_ref.h*l;H+=l){for(h=D+H,s[0]=y*h+z,t[0]=A*h+B,u[0]=C*h+1,e=1;l>e;e++)s[e]=s[e-1]+y,t[e]=t[e-1]+A,u[e]=u[e-1]+C;for(var I=0;I<this._size_ref.w*l;I+=l){var J=0;for(h=E+I,e=l-1;e>=0;e--){var K=v*h+s[e],L=x*h+u[e],M=w*h+t[e],N=1/L,O=-x/(L*(L+x)),P=K*N,Q=M*N,R=K*O+v*(N+O),S=M*O+w*(N+O);for(d=l-1;d>=0;d--)f=q[J]=toInt(P),g=r[J]=toInt(Q),(0>f||f>=n||0>g||g>=o)&&(0>f?q[J]=0:f>=n&&(q[J]=n-1),0>g?r[J]=0:g>=o&&(r[J]=o-1)),J++,P+=R,Q+=S}F.getPixelSet(q,r,m,p),i=j=k=0;for(var T=3*m-1;T>0;)k+=p[T--],j+=p[T--],i+=p[T--];i/=m,j/=m,k/=m,c[G]=(255&i)<<16|(255&j)<<8|255&k,G++}}}}),FLSingleARMarkerProcesser=ASKlass("FLSingleARMarkerProcesser",{tag:null,_lost_delay_count:0,_lost_delay:5,_square_detect:null,_transmat:null,_offset:null,_threshold:110,_bin_raster:null,_tobin_filter:null,_current_arcode_index:-1,_threshold_detect:null,FLSingleARMarkerProcesser:function(){},_initialized:!1,initInstance:function(a){NyAS3Utils.assert(0==this._initialized);var b=a.getScreenSize();this._square_detect=new FLARSquareContourDetector(b),this._transmat=new NyARTransMat(a),this._tobin_filter=new FLARRasterFilter_Threshold(110),this._bin_raster=new FLARBinRaster(b.w,b.h),this._threshold_detect=new FLARRasterThresholdAnalyzer_SlidePTile(15,4),this._initialized=!0,this._detectmarker_cb=new FLARDetectSquareCB_1(a),this._offset=new NyARRectOffset},setARCodeTable:function(a,b,c){-1!=this._current_arcode_index&&this.reset(!0),this._detectmarker_cb.setNyARCodeTable(a,b),this._offset.setSquare(c)},reset:function(a){-1!=this._current_arcode_index&&0==a&&this.onLeaveHandler(),this._current_arcode_index=-1},_detectmarker_cb:null,detectMarker:function(a){NyAS3Utils.assert(this._bin_raster.getSize().isEqualSize_int(a.getSize().w,a.getSize().h)),this._tobin_filter.setThreshold(this._threshold),this._tobin_filter.doFilter(a,this._bin_raster),this._detectmarker_cb.init(a,this._current_arcode_index),this._square_detect.detectMarkerCB(this._bin_raster,this._detectmarker_cb);var b=updateStatus(this._detectmarker_cb.square,this._detectmarker_cb.code_index);if(!b){var c=this._threshold_detect.analyzeRaster(a);this._threshold=(this._threshold+c)/2}},setConfidenceThreshold:function(a,b){this._detectmarker_cb.cf_threshold_exist=b,this._detectmarker_cb.cf_threshold_new=a},__NyARSquare_result:new FLARTransMatResult,updateStatus:function(a,b){var c=this.__NyARSquare_result;if(this._current_arcode_index<0)return 0>b?!1:(this._current_arcode_index=b,this.onEnterHandler(b),this._transmat.transMat(a,this._offset,c),this.onUpdateHandler(a,c),this._lost_delay_count=0,!0);if(0>b)return this._lost_delay_count++,this._lost_delay<this._lost_delay_count&&(this._current_arcode_index=-1,this.onLeaveHandler()),!1;if(b==this._current_arcode_index)return this._transmat.transMat(a,this._offset,c),this.onUpdateHandler(a,c),this._lost_delay_count=0,!0;throw new NyARException},onEnterHandler:function(a){throw new NyARException("onEnterHandler not implemented.")},onLeaveHandler:function(){throw new NyARException("onLeaveHandler not implemented.")},onUpdateHandler:function(a,b){throw new NyARException("onUpdateHandler not implemented.")}}),FLARDetectSquareCB_1=ASKlass("DetectSquareCB",{square:new FLARSquare,confidence:0,code_index:-1,cf_threshold_new:.5,cf_threshold_exist:.3,_ref_raster:null,_inst_patt:null,_deviation_data:null,_match_patt:null,__detectMarkerLite_mr:new NyARMatchPattResult,_coordline:null,DetectSquareCB:function(a){this._match_patt=null,this._coordline=new NyARCoord2Linear(a.getScreenSize(),a.getDistortionFactor())},setNyARCodeTable:function(a,b){this._deviation_data=new NyARMatchPattDeviationColorData(b,b),this._inst_patt=new NyARColorPatt_Perspective_O2(b,b,4,25),this._match_patt=new Array(a.length);for(var c=0;c<a.length;c++)this._match_patt[c]=new NyARMatchPatt_Color_WITHOUT_PCA(a[c])},__tmp_vertex:NyARIntPoint2d.createArray(4),_target_id:0,init:function(a,b){this._ref_raster=a,this._target_id=b,this.code_index=-1,this.confidence=Number.MIN_VALUE},onSquareDetect:function(a,b,c,d,e){if(null!=this._match_patt){var f=this.__tmp_vertex;if(f[0].x=b[e[0]],f[0].y=c[e[0]],f[1].x=b[e[1]],f[1].y=c[e[1]],f[2].x=b[e[2]],f[2].y=c[e[2]],f[3].x=b[e[3]],f[3].y=c[e[3]],this._inst_patt.pickFromRaster(this._ref_raster,f)){this._deviation_data.setRaster(this._inst_patt);var g,h=this.__detectMarkerLite_mr,i=0,j=0,k=0;for(g=0;g<this._match_patt.length;g++){this._match_patt[g].evaluate(this._deviation_data,h);var l=h.confidence;l>k&&(i=g,k=l,j=h.direction)}if(-1==this._target_id){if(k<this.cf_threshold_new)return;if(this.confidence>k)return;this.code_index=i}else{if(i!=this._target_id)return;if(k<this.cf_threshold_exist)return;if(this.confidence>k)return;this.code_index=this._target_id}this.confidence=k;var m=this.square;for(g=0;4>g;g++){var n=(g+4-j)%4;this._coordline.coord2Line(e[n],e[(n+1)%4],b,c,d,m.line[g])}for(g=0;4>g;g++)if(!NyARLinear.crossPos(m.line[g],m.line[(g+3)%4],m.sqvertex[g]))throw new NyARException}}}}),FLSingleNyIdMarkerProcesser=ASKlass("FLSingleNyIdMarkerProcesser",{tag:null,_lost_delay_count:0,_lost_delay:5,_square_detect:null,_transmat:null,_offset:null,_is_active:null,_current_threshold:110,_bin_raster:null,_tobin_filter:null,_callback:null,_data_current:null,FLSingleNyIdMarkerProcesser:function(){},_initialized:!1,initInstance:function(a,b,c){NyAS3Utils.assert(0==this._initialized);var d=a.getScreenSize();this._square_detect=new FLARSquareContourDetector(d),this._transmat=new NyARTransMat(a),this._callback=new FLARDetectSquareCB_2(a,b),this._bin_raster=new FLARBinRaster(d.w,d.h),this._data_current=b.createDataInstance(),this._tobin_filter=new FLARRasterFilter_Threshold(110),this._threshold_detect=new FLARRasterThresholdAnalyzer_SlidePTile(15,4),this._initialized=!0,this._is_active=!1,this._offset=new NyARRectOffset,this._offset.setSquare(c)},setMarkerWidth:function(a){this._offset.setSquare(a)},reset:function(a){0==a&&this._is_active&&this.onLeaveHandler(),this._is_active=!1},detectMarker:function(a){if(!this._bin_raster.getSize().isEqualSize_int(a.getSize().w,a.getSize().h))throw new NyARException;this._tobin_filter.setThreshold(this._current_threshold),this._tobin_filter.doFilter(a,this._bin_raster),this._callback.init(a,this._is_active?this._data_current:null),this._square_detect.detectMarkerCB(this._bin_raster,this._callback);var b=updateStatus(this._callback.square,this._callback.marker_data);if(b)this._current_threshold=(this._current_threshold+this._callback.threshold)/2;else{var c=this._threshold_detect.analyzeRaster(a);this._current_threshold=(this._current_threshold+c)/2}},_threshold_detect:null,__NyARSquare_result:new FLARTransMatResult,updateStatus:function(a,b){var c=!1,d=this.__NyARSquare_result;if(this._is_active)if(null==b)this._lost_delay_count++,this._lost_delay<this._lost_delay_count&&(this.onLeaveHandler(),this._is_active=!1);else{if(!this._data_current.isEqual(b))throw new NyARException;this._transmat.transMatContinue(a,this._offset,d),this.onUpdateHandler(a,d),this._lost_delay_count=0,c=!0}else null==b?this._is_active=!1:(this._data_current.copyFrom(b),this.onEnterHandler(this._data_current),this._transmat.transMat(a,this._offset,d),this.onUpdateHandler(a,d),this._lost_delay_count=0,this._is_active=!0,c=!0);return c},onEnterHandler:function(a){throw new NyARException("onEnterHandler not implemented.")},onLeaveHandler:function(){throw new NyARException("onLeaveHandler not implemented.")},onUpdateHandler:function(a,b){throw new NyARException("onUpdateHandler not implemented.")}}),FLARDetectSquareCB_2=ASKlass("DetectSquareCB",{square:new FLARSquare,marker_data:null,threshold:0,_ref_raster:null,_current_data:null,_id_pickup:new NyIdMarkerPickup,_coordline:null,_encoder:null,_data_temp:null,_prev_data:null,DetectSquareCB:function(a,b){this._coordline=new NyARCoord2Linear(a.getScreenSize(),a.getDistortionFactor()),this._data_temp=b.createDataInstance(),this._current_data=b.createDataInstance(),this._encoder=b},__tmp_vertex:NyARIntPoint2d.createArray(4),init:function(a,b){this.marker_data=null,this._prev_data=b,this._ref_raster=a},_marker_param:new NyIdMarkerParam,_marker_data:new NyIdMarkerPattern,onSquareDetect:function(a,b,c,d,e){if(null==this.marker_data){var f=this.__tmp_vertex;f[0].x=b[e[0]],f[0].y=c[e[0]],f[1].x=b[e[1]],f[1].y=c[e[1]],f[2].x=b[e[2]],f[2].y=c[e[2]],f[3].x=b[e[3]],f[3].y=c[e[3]];var g=this._marker_param,h=this._marker_data;if(this._id_pickup.pickFromRaster(this._ref_raster,f,h,g)&&this._encoder.encode(h,this._data_temp)){if(null==this._prev_data)this._current_data.copyFrom(this._data_temp);else if(!this._prev_data.isEqual(this._data_temp))return;var i,j=this.square;for(i=0;4>i;i++){var k=(i+4-g.direction)%4;this._coordline.coord2Line(e[k],e[(k+1)%4],b,c,d,j.line[i])}for(i=0;4>i;i++)if(!NyARLinear.crossPos(j.line[i],j.line[(i+3)%4],j.sqvertex[i]))throw new NyARException;this.threshold=g.threshold,this.marker_data=this._current_data}}}}),NyARCustomSingleDetectMarker=ASKlass("NyARCustomSingleDetectMarker",{_is_continue:!1,_square_detect:null,_transmat:null,_bin_raster:null,_tobin_filter:null,_detect_cb:null,_offset:null,NyARCustomSingleDetectMarker:function(){},initInstance:function(a,b,c,d,e,f,g){var h=e.getScreenSize();this._square_detect=b,this._transmat=c,this._tobin_filter=d,this._bin_raster=new NyARBinRaster(h.w,h.h),this._detect_cb=new DetectSquareCB_3(a,f,e),this._offset=new NyARRectOffset,this._offset.setSquare(g)},detectMarkerLiteB:function(a){if(!this._bin_raster.getSize().isEqualSize_NyARIntSize(a.getSize()))throw new NyARException;return this._tobin_filter.doFilter(a,this._bin_raster),this._detect_cb.init(a),this._square_detect.detectMarkerCB(this._bin_raster,_detect_cb),0==this._detect_cb.confidence?!1:!0},getTransmationMatrix:function(a){this._is_continue?this._transmat.transMatContinue(this._detect_cb.square,this._offset,a):this._transmat.transMat(this._detect_cb.square,this._offset,a)},refSquare:function(){return this._detect_cb.square},getConfidence:function(){return this._detect_cb.confidence},setContinueMode:function(a){this._is_continue=a}}),DetectSquareCB_3=ASKlass("DetectSquareCB",NyARSquareContourDetector_IDetectMarkerCallback,{confidence:0,square:new NyARSquare,_ref_raster:null,_inst_patt:null,_deviation_data:null,_match_patt:null,__detectMarkerLite_mr:new NyARMatchPattResult,_coordline:null,DetectSquareCB:function(a,b,c){this._inst_patt=a,this._deviation_data=new NyARMatchPattDeviationColorData(b.getWidth(),b.getHeight()),this._coordline=new NyARCoord2Linear(c.getScreenSize(),c.getDistortionFactor()),this._match_patt=new NyARMatchPatt_Color_WITHOUT_PCA(b)},__tmp_vertex:NyARIntPoint2d.createArray(4),onSquareDetect:function(a,b,c,d,e){var f,g=this.__detectMarkerLite_mr,h=this.__tmp_vertex;if(h[0].x=b[e[0]],h[0].y=c[e[0]],h[1].x=b[e[1]],h[1].y=c[e[1]],h[2].x=b[e[2]],h[2].y=c[e[2]],h[3].x=b[e[3]],h[3].y=c[e[3]],this._inst_patt.pickFromRaster(this._ref_raster,h)&&(this._deviation_data.setRaster(this._inst_patt),this._match_patt.evaluate(this._deviation_data,g)&&!(this.confidence>g.confidence))){var i=this.square;for(this.confidence=g.confidence,f=0;4>f;f++){var j=(f+4-g.direction)%4;this._coordline.coord2Line(e[j],e[(j+1)%4],b,c,d,i.line[f])}for(f=0;4>f;f++)if(!NyARLinear.crossPos(i.line[f],i.line[(f+3)%4],i.sqvertex[f]))throw new NyARException}},init:function(a){this.confidence=0,this._ref_raster=a}}),NyARDetectMarker=ASKlass("NyARDetectMarker",{_detect_cb:null,AR_SQUARE_MAX:300,_is_continue:!1,_square_detect:null,_transmat:null,_offset:null,NyARDetectMarker:function(a,b,c,d,e){this.initInstance(a,b,c,d,e)},initInstance:function(a,b,c,d,e){var f=a.getScreenSize(),g=b[0].getWidth(),h=b[0].getHeight();this._detect_cb=new NyARDetectSquareCB(new NyARColorPatt_Perspective_O2(g,h,4,25),b,d,a),this._transmat=new NyARTransMat(a),this._square_detect=new NyARSquareContourDetector_Rle(a.getScreenSize()),this._tobin_filter=new NyARRasterFilter_ARToolkitThreshold(100,e),this._offset=NyARRectOffset.createArray(d);for(var i=0;d>i;i++)this._offset[i].setSquare(c[i]);this._bin_raster=new NyARBinRaster(f.w,f.h)},_bin_raster:null,_tobin_filter:null,detectMarkerLite:function(a,b){if(!this._bin_raster.getSize().isEqualSize_NyARIntSize(a.getSize()))throw new NyARException;return NyARRasterFilter_ARToolkitThreshold(this._tobin_filter).setThreshold(b),this._tobin_filter.doFilter(a,this._bin_raster),this._detect_cb.init(a),this._square_detect.detectMarkerCB(this._bin_raster,this._detect_cb),this._detect_cb.result_stack.getLength()},getTransmationMatrix:function(a,b){var c=this._detect_cb.result_stack.getItem(a);_is_continue?_transmat.transMatContinue(c.square,this._offset[c.arcode_id],b):_transmat.transMat(c.square,this._offset[c.arcode_id],b)},getConfidence:function(a){return this._detect_cb.result_stack.getItem(a).confidence},getARCodeIndex:function(a){return this._detect_cb.result_stack.getItem(a).arcode_id},setContinueMode:function(a){this._is_continue=a}}),NyARDetectMarkerResult=ASKlass("NyARDetectMarkerResult",{arcode_id:0,confidence:0,square:new NyARSquare}),NyARDetectMarkerResultStack=ASKlass("NyARDetectMarkerResultStack ",NyARObjectStack,{NyARDetectMarkerResultStack:function(a){NyARObjectStack.initialize.call(this,a)},createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new NyARDetectMarkerResult;return b}}),NyARDetectSquareCB=ASKlass("NyARDetectSquareCB ",NyARSquareContourDetector_IDetectMarkerCallback,{result_stack:new NyARDetectMarkerResultStack(NyARDetectMarker.AR_SQUARE_MAX),_ref_raster:null,_inst_patt:null,_deviation_data:null,_match_patt:null,__detectMarkerLite_mr:new NyARMatchPattResult,_coordline:null,NyARDetectSquareCB:function(a,b,c,d){var e=b[0].getWidth(),f=b[0].getHeight();this._inst_patt=a,this._coordline=new NyARCoord2Linear(d.getScreenSize(),d.getDistortionFactor()),this._deviation_data=new NyARMatchPattDeviationColorData(e,f),this._match_patt=new Array(c),this._match_patt[0]=new NyARMatchPatt_Color_WITHOUT_PCA(b[0]);for(var g=1;c>g;g++){if(e!=b[g].getWidth()||f!=b[g].getHeight())throw new NyARException;this._match_patt[g]=new NyARMatchPatt_Color_WITHOUT_PCA(b[g])}},__tmp_vertex:NyARIntPoint2d.createArray(4),onSquareDetect:function(a,b,c,d,e){var f=this.__detectMarkerLite_mr,g=this.__tmp_vertex;if(g[0].x=b[e[0]],g[0].y=c[e[0]],g[1].x=b[e[1]],g[1].y=c[e[1]],g[2].x=b[e[2]],g[2].y=c[e[2]],g[3].x=b[e[3]],g[3].y=c[e[3]],this._inst_patt.pickFromRaster(this._ref_raster,g)){this._deviation_data.setRaster(this._inst_patt);var h,i,j;this._match_patt[0].evaluate(this._deviation_data,f),h=0,i=f.direction,j=f.confidence;var k;for(k=1;k<this._match_patt.length;k++)this._match_patt[k].evaluate(this._deviation_data,f),j>f.confidence||(h=k,i=f.direction,j=f.confidence);var l=this.result_stack.prePush();l.arcode_id=h,l.confidence=j;var m=l.square;for(k=0;4>k;k++){var n=(k+4-i)%4;this._coordline.coord2Line(e[n],e[(n+1)%4],b,c,d,m.line[k])}for(k=0;4>k;k++)if(!NyARLinear.crossPos(m.line[k],m.line[(k+3)%4],m.sqvertex[k]))throw new NyARException}},init:function(a){this._ref_raster=a,this.result_stack.clear()}}),NyARSingleDetectMarker=ASKlass("NyARSingleDetectMarker",NyARCustomSingleDetectMarker,{PF_ARTOOLKIT_COMPATIBLE:1,PF_NYARTOOLKIT:2,PF_NYARTOOLKIT_ARTOOLKIT_FITTING:100,PF_TEST2:201,NyARSingleDetectMarker:function(a,b,c,d,e){null==e&&(e=this.PF_NYARTOOLKIT),NyARCustomSingleDetectMarker.initialize.call(this),this.initInstance2(a,b,c,d,e)},initInstance2:function(a,b,c,d,e){var f,g,h,i=new NyARRasterFilter_ARToolkitThreshold(100,d);switch(e){case this.PF_NYARTOOLKIT:f=new NyARColorPatt_Perspective_O2(b.getWidth(),b.getHeight(),4,25),g=new NyARSquareContourDetector_Rle(a.getScreenSize()),h=new NyARTransMat(a);break;default:throw new NyARException}NyARCustomSingleDetectMarker.initInstance.call(this,f,g,h,i,a,b,c)},detectMarkerLite:function(a,b){return NyARRasterFilter_ARToolkitThreshold(this._tobin_filter).setThreshold(b),NyARCustomSingleDetectMarker.detectMarkerLiteB.call(this,a)}}),FLARDetectMarkerResult=ASKlass("FLARDetectMarkerResult",{arcode_id:0,confidence:0,direction:0,square:new NyARSquare}),FLARDetectMarkerResultStack=ASKlass("FLARDetectMarkerResultStack",NyARObjectStack,{FLARDetectMarkerResultStack:function(a){NyARObjectStack.initialize.call(this,a)},createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new FLARDetectMarkerResult;return b}}),FLARMultiMarkerDetector=ASKlass("FLARMultiMarkerDetector",{_detect_cb:null,AR_SQUARE_MAX:300,_is_continue:!1,_square_detect:null,_transmat:null,_offset:null,_flarcode:null,FLARMultiMarkerDetector:function(a,b,c,d){this.initInstance(a,b,c,d)},initInstance:function(a,b,c,d){var e=a.getScreenSize(),f=b[0].getWidth(),g=b[0].getHeight(),h=(100-b[0].markerPercentWidth)/2,i=(100-b[0].markerPercentHeight)/2,j=new NyARColorPatt_Perspective_O2(f,g,4,h);j.setEdgeSizeByPercent(h,i,4),this._detect_cb=new MultiDetectSquareCB(j,b,d,a),this._transmat=new NyARTransMat(a),this._square_detect=new FLARSquareContourDetector(a.getScreenSize()),this._tobin_filter=new FLARRasterFilter_Threshold(100),this._offset=NyARRectOffset.createArray(d);for(var k=0;d>k;k++)this._offset[k].setSquare(c[k]);this._bin_raster=new FLARBinRaster(e.w,e.h)},_bin_raster:null,_tobin_filter:null,detectMarkerLite:function(a,b){if(!this._bin_raster.getSize().isEqualSize_NyARIntSize(a.getSize()))throw new NyARException;if(-1!=b)FLARRasterFilter_Threshold(this._tobin_filter).setThreshold(b),this._tobin_filter.doFilter(a,this._bin_raster);else{var c=a.getBuffer(),d=this._bin_raster.getBuffer();d.copyPixels(c,c.rect,new Point)}return this._detect_cb.init(a),this._square_detect.detectMarkerCB(this._bin_raster,this._detect_cb),this._detect_cb.result_stack.getLength()},getTransformMatrix:function(a,b){var c=this._detect_cb.result_stack.getItem(a);_is_continue?_transmat.transMatContinue(c.square,this._offset[c.arcode_id],b):_transmat.transMat(c.square,this._offset[c.arcode_id],b)},getConfidence:function(a){return this._detect_cb.result_stack.getItem(a).confidence},getARCodeIndex:function(a){return this._detect_cb.result_stack.getItem(a).arcode_id},getDirection:function(a){return this._detect_cb.result_stack.getItem(a).direction},getSquare:function(a){return this._detect_cb.result_stack.getItem(a).square},setContinueMode:function(a){this._is_continue=a},setAreaRange:function(a,b){if(null==a&&(a=1e5),null==b&&(b=70),0>a&&(a=FLARLabeling.AR_AREA_MAX),0>b&&(b=FLARLabeling.AR_AREA_MIN),b>a){var c=a;a=b,b=c}this._square_detect.setAreaRange(a,b)},thresholdedBitmapData:function(){try{return this._bin_raster.getBuffer()}catch(a){return null}return null}}),FLARSingleMarkerDetector=ASKlass("FLARSingleMarkerDetector",{_is_continue:!1,_square_detect:null,_transmat:null,_bin_raster:null,_tobin_filter:null,_detect_cb:null,_offset:null,FLARSingleMarkerDetector:function(a,b,c){var d,e,f,g=new FLARRasterFilter_Threshold(100),h=(100-b.markerPercentWidth)/2,i=(100-b.markerPercentHeight)/2;d=new NyARColorPatt_Perspective_O2(b.getWidth(),b.getHeight(),4,h),d.setEdgeSizeByPercent(h,i,4),e=new FLARSquareContourDetector(a.getScreenSize()),
f=new NyARTransMat(a),this.initInstance(d,e,f,g,a,b,c)},initInstance:function(a,b,c,d,e,f,g){var h=e.getScreenSize();this._square_detect=b,this._transmat=c,this._tobin_filter=d,this._bin_raster=new FLARBinRaster(h.w,h.h),this._detect_cb=new SingleDetectSquareCB(a,f,e),this._offset=new NyARRectOffset,this._offset.setSquare(g)},detectMarkerLite:function(a,b){if(this._tobin_filter.setThreshold(b),!this._bin_raster.getSize().isEqualSize_NyARIntSize(a.getSize()))throw new FLARException;return this._tobin_filter.doFilter(a,this._bin_raster),this._detect_cb.init(a),this._square_detect.detectMarkerCB(this._bin_raster,this._detect_cb),0==this._detect_cb.confidence?!1:!0},getTransformMatrix:function(a){this._is_continue?this._transmat.transMatContinue(this._detect_cb.square,this._offset,a):this._transmat.transMat(this._detect_cb.square,this._offset,a)},getConfidence:function(){return this._detect_cb.confidence},getDirection:function(){return this._detect_cb.direction},getSquare:function(){return this._detect_cb.square},setContinueMode:function(a){this._is_continue=a},setAreaRange:function(a,b){if(null==a&&(a=1e5),null==b&&(b=70),0>a&&(a=FLARLabeling.AR_AREA_MAX),0>b&&(b=FLARLabeling.AR_AREA_MIN),b>a){var c=a;a=b,b=c}this._square_detect.setAreaRange(a,b)},thresholdedBitmapData:function(){try{return this._bin_raster.getBuffer()}catch(a){return null}return null}}),MultiDetectSquareCB=ASKlass("MultiDetectSquareCB",{result_stack:new FLARDetectMarkerResultStack(NyARDetectMarker.AR_SQUARE_MAX),_ref_raster:null,_inst_patt:null,_deviation_data:null,_match_patt:null,__detectMarkerLite_mr:new NyARMatchPattResult,_coordline:null,MultiDetectSquareCB:function(a,b,c,d){var e=b[0].getWidth(),f=b[0].getHeight();this._inst_patt=a,this._coordline=new NyARCoord2Linear(d.getScreenSize(),d.getDistortionFactor()),this._deviation_data=new NyARMatchPattDeviationColorData(e,f),this._match_patt=new Array(c),this._match_patt[0]=new NyARMatchPatt_Color_WITHOUT_PCA(b[0]);for(var g=1;c>g;g++){if(e!=b[g].getWidth()||f!=b[g].getHeight())throw new NyARException;this._match_patt[g]=new NyARMatchPatt_Color_WITHOUT_PCA(b[g])}},__tmp_vertex:NyARIntPoint2d.createArray(4),onSquareDetect:function(a,b,c,d,e){var f=this.__detectMarkerLite_mr,g=this.__tmp_vertex;if(g[0].x=b[e[0]],g[0].y=c[e[0]],g[1].x=b[e[1]],g[1].y=c[e[1]],g[2].x=b[e[2]],g[2].y=c[e[2]],g[3].x=b[e[3]],g[3].y=c[e[3]],this._inst_patt.pickFromRaster(this._ref_raster,g)){this._deviation_data.setRaster(this._inst_patt);var h,i,j;this._match_patt[0].evaluate(this._deviation_data,f),h=0,i=f.direction,j=f.confidence;var k;for(k=1;k<this._match_patt.length;k++)this._match_patt[k].evaluate(this._deviation_data,f),j>f.confidence||(h=k,i=f.direction,j=f.confidence);var l=this.result_stack.prePush();l.arcode_id=h,l.confidence=j,l.direction=i;var m=l.square;for(k=0;4>k;k++){var n=(k+4-i)%4;this._coordline.coord2Line(e[n],e[(n+1)%4],b,c,d,m.line[k])}for(k=0;4>k;k++)if(!NyARLinear.crossPos(m.line[k],m.line[(k+3)%4],m.sqvertex[k]))throw new NyARException}},init:function(a){this._ref_raster=a,this.result_stack.clear()}}),SingleDetectSquareCB=ASKlass("SingleDetectSquareCB",{confidence:0,square:new NyARSquare,direction:0,_ref_raster:null,_inst_patt:null,_deviation_data:null,_match_patt:null,__detectMarkerLite_mr:new NyARMatchPattResult,_coordline:null,SingleDetectSquareCB:function(a,b,c){this._inst_patt=a,this._deviation_data=new NyARMatchPattDeviationColorData(b.getWidth(),b.getHeight()),this._coordline=new NyARCoord2Linear(c.getScreenSize(),c.getDistortionFactor()),this._match_patt=new NyARMatchPatt_Color_WITHOUT_PCA(b)},__tmp_vertex:NyARIntPoint2d.createArray(4),onSquareDetect:function(a,b,c,d,e){var f,g=this.__detectMarkerLite_mr,h=this.__tmp_vertex;if(h[0].x=b[e[0]],h[0].y=c[e[0]],h[1].x=b[e[1]],h[1].y=c[e[1]],h[2].x=b[e[2]],h[2].y=c[e[2]],h[3].x=b[e[3]],h[3].y=c[e[3]],this._inst_patt.pickFromRaster(this._ref_raster,h)&&(this._deviation_data.setRaster(this._inst_patt),this._match_patt.evaluate(this._deviation_data,g)&&!(this.confidence>g.confidence))){var i=this.square;for(this.confidence=g.confidence,this.direction=g.direction,f=0;4>f;f++){var j=(f+4-g.direction)%4;this._coordline.coord2Line(e[j],e[(j+1)%4],b,c,d,i.line[f])}for(f=0;4>f;f++)if(!NyARLinear.crossPos(i.line[f],i.line[(f+3)%4],i.sqvertex[f]))throw new NyARException}},init:function(a){this.confidence=0,this._ref_raster=a}}),FLARIdMarkerData=ASKlass("FLARIdMarkerData",{_packet:new IntVector(22),_model:0,_controlDomain:0,_controlMask:0,_check:0,_dataDot:0,packetLength:0,FLARIdMarkerData:function(){},isEqual:function(a){if(null==a||!(a instanceof FLARIdMarkerData))return!1;var b=a;if(b.packetLength!=this.packetLength||b._check!=this._check||b._controlDomain!=this._controlDomain||b._controlMask!=this._controlMask||b._dataDot!=this._dataDot||b._model!=this._model)return!1;for(var c=b.packetLength-1;c>=0;c--)if(b._packet[c]!=this._packet[c])return!1;return!0},copyFrom:function(a){var b=a;if(null!=b){this._check=b._check,this._controlDomain=b._controlDomain,this._controlMask=b._controlMask,this._dataDot=b._dataDot,this._model=b._model,this.packetLength=b.packetLength;for(var c=b.packetLength-1;c>=0;c--)this._packet[c]=b._packet[c]}},setModel:function(a){this._model=a},setControlDomain:function(a){this._controlDomain=a},setControlMask:function(a){this._controlMask=a},setCheck:function(a){this._check=a},setPacketData:function(a,b){if(!(a<this.packetLength))throw"packet index over "+a+" >= "+this.packetLength;this._packet[a]=b},setDataDotLength:function(a){this._dataDot=a},setPacketLength:function(a){this.packetLength=a},dataDotLength:function(){return this._dataDot},model:function(){return this._model},controlDomain:function(){return this._controlDomain},controlMask:function(){return this._controlMask},check:function(){return this._check},getPacketData:function(a){if(this.packetLength<=a)throw new ArgumentError("packet index over");return this._packet[a]}}),FLARDetectIdMarkerResult=ASKlass("FLARDetectIdMarkerResult",{arcode_id:0,direction:0,markerdata:new FLARIdMarkerData,square:new NyARSquare}),FLARDetectIdMarkerResultStack=ASKlass("FLARDetectIdMarkerResultStack",NyARObjectStack,{FLARDetectIdMarkerResultStack:function(a){NyARObjectStack.initialize.call(this,a)},createArray:function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=new FLARDetectIdMarkerResult;return b}}),FLARMultiIdMarkerDetectCB=ASKlass("FLARMultiIdMarkerDetectCB",{result_stack:new FLARDetectIdMarkerResultStack(NyARDetectMarker.AR_SQUARE_MAX),square:new FLARSquare,marker_data:null,threshold:0,direction:0,_ref_raster:null,_current_data:null,_data_temp:null,_prev_data:null,_id_pickup:new NyIdMarkerPickup,_coordline:null,_encoder:null,__tmp_vertex:NyARIntPoint2d.createArray(4),_marker_param:new NyIdMarkerParam,_maker_pattern:new NyIdMarkerPattern,FLARMultiIdMarkerDetectCB:function(a,b){this._coordline=new NyARCoord2Linear(a.getScreenSize(),a.getDistortionFactor()),this._data_temp=b.createDataInstance(),this._current_data=b.createDataInstance(),this._encoder=b},init:function(a){this.marker_data=null,this.result_stack.clear(),this._id_pickup.init(),this._ref_raster=a},_previous_verts:{},onSquareDetect:function(a,b,c,d,e){var f=this.__tmp_vertex;f[0].x=b[e[0]],f[0].y=c[e[0]],f[1].x=b[e[1]],f[1].y=c[e[1]],f[2].x=b[e[2]],f[2].y=c[e[2]],f[3].x=b[e[3]],f[3].y=c[e[3]];var g,h=this._marker_param,i=this._maker_pattern;if(window.DEBUG){g=document.getElementById("debugCanvas").getContext("2d"),g.fillStyle="blue";for(var j=0;4>j;j++)g.fillRect(f[j].x-2,f[j].y-2,5,5)}for(var k=0,l=0,j=0;4>j;j++)k+=f[j].x,l+=f[j].y;k/=4,l/=4;var m=this._id_pickup.pickFromRaster(this._ref_raster,f,i,h);if(!m)return void(window.DEBUG&&(g.fillStyle="#ff0000",g.fillText("No pick",k+3,l)));var n=this._encoder.encode(i,this._data_temp);if(n){this._current_data.copyFrom(this._data_temp),this.marker_data=this._current_data,this.threshold=h.threshold,this.direction=h.direction;var o=this.result_stack.prePush();o.direction=this.direction,o.markerdata.copyFrom(this.marker_data),o.arcode_id=this.getId(o.markerdata),window.DEBUG&&(g.fillStyle="#00ffff",g.fillText(o.arcode_id,k+3,l));var j,p=o.square;for(j=0;4>j;j++){var q=(j+4-h.direction)%4;this._coordline.coord2Line(e[q],e[(q+1)%4],b,c,d,p.line[j])}for(j=0;4>j;j++)if(!NyARLinear.crossPos(p.line[j],p.line[(j+3)%4],p.sqvertex[j]))throw new NyARException}},getId:function(a){var b;if(a.packetLength>4)b=-1;else{b=0;for(var c=0;c<a.packetLength;c++)b=b<<8|a.getPacketData(c)}return b}}),FLARMultiIdMarkerDetector=ASKlass("FLARMultiIdMarkerDetector",{_is_continue:!1,_square_detect:null,_offset:null,_current_threshold:110,_bin_raster:null,_tobin_filter:null,_callback:null,_data_current:null,_threshold_detect:null,_transmat:null,FLARMultiIdMarkerDetector:function(a,b){var c=a.getScreenSize(),d=new FLARIdMarkerDataEncoder_RawBit;this._square_detect=new FLARSquareContourDetector(c),this._callback=new FLARMultiIdMarkerDetectCB(a,d),this._transmat=new NyARTransMat(a),this._bin_raster=new FLARBinRaster(c.w,c.h),this._data_current=d.createDataInstance(),this._tobin_filter=new FLARRasterFilter_Threshold(110),this._threshold_detect=new FLARRasterThresholdAnalyzer_SlidePTile(15,4),this._offset=new NyARRectOffset,this._offset.setSquare(b)},detectMarkerLite:function(a,b){if(!this._bin_raster.getSize().isEqualSize_int(a.getSize().w,a.getSize().h))throw new FLARException;return this._tobin_filter.setThreshold(b),this._tobin_filter.doFilter(a,this._bin_raster),this._callback.init(this._bin_raster),this._square_detect.detectMarkerCB(this._bin_raster,this._callback),this._callback.result_stack.getLength()},getTransformMatrix:function(a,b){var c=this._callback.result_stack.getItem(a);this._is_continue?this._transmat.transMatContinue(c.square,this._offset,b):this._transmat.transMat(c.square,this._offset,b)},getIdMarkerData:function(a){var b=new FLARIdMarkerData;return b.copyFrom(this._callback.result_stack.getItem(a).markerdata),b},getARCodeIndex:function(a){return this._callback.result_stack.getItem(a).arcode_id},getDirection:function(a){return this._callback.result_stack.getItem(a).direction},getSquare:function(a){return this._callback.result_stack.getItem(a).square},setContinueMode:function(a){this._is_continue=a},thresholdedBitmapData:function(){try{return this._bin_raster.getBuffer()}catch(a){return null}return null}}),FLARSingleIdMarkerDetectCB=ASKlass("FLARSingleIdMarkerDetectCB",{square:new FLARSquare,marker_data:null,threshold:0,direction:0,_ref_raster:null,_current_data:null,_data_temp:null,_prev_data:null,_id_pickup:new NyIdMarkerPickup,_coordline:null,_encoder:null,__tmp_vertex:NyARIntPoint2d.createArray(4),_marker_param:new NyIdMarkerParam,_maker_pattern:new NyIdMarkerPattern,FLARSingleIdMarkerDetectCB:function(a,b){this._coordline=new NyARCoord2Linear(a.getScreenSize(),a.getDistortionFactor()),this._data_temp=b.createDataInstance(),this._current_data=b.createDataInstance(),this._encoder=b},init:function(a,b){this.marker_data=null,this._prev_data=b,this._ref_raster=a},onSquareDetect:function(a,b,c,d,e){if(null==this.marker_data){var f=this.__tmp_vertex;f[0].x=b[e[0]],f[0].y=c[e[0]],f[1].x=b[e[1]],f[1].y=c[e[1]],f[2].x=b[e[2]],f[2].y=c[e[2]],f[3].x=b[e[3]],f[3].y=c[e[3]];var g=this._marker_param,h=this._maker_pattern,i=this._id_pickup.pickFromRaster(this._ref_raster,f,h,g);if(window.DEBUG){var j=document.getElementById("debugCanvas").getContext("2d");j.fillStyle="blue";for(var k=0;4>k;k++)j.fillRect(f[k].x-2,f[k].y-2,5,5)}if(i&&(this.direction=g.direction,this._encoder.encode(h,this._data_temp))){if(null==this._prev_data)this._current_data.copyFrom(this._data_temp);else if(!this._prev_data.isEqual(this._data_temp))return;var k,l=this.square;for(k=0;4>k;k++){var m=(k+4-g.direction)%4;this._coordline.coord2Line(e[m],e[(m+1)%4],b,c,d,l.line[k])}for(k=0;4>k;k++)if(!NyARLinear.crossPos(l.line[k],l.line[(k+3)%4],l.sqvertex[k]))throw new NyARException;this.threshold=g.threshold,this.marker_data=this._current_data}}}}),FLARSingleIdMarkerDetector=ASKlass("FLARSingleIdMarkerDetector",{_is_continue:!1,_square_detect:null,_offset:null,_is_active:null,_current_threshold:110,_bin_raster:null,_tobin_filter:null,_callback:null,_data_current:null,_threshold_detect:null,_transmat:null,FLARSingleIdMarkerDetector:function(a,b){var c=a.getScreenSize(),d=new FLARIdMarkerDataEncoder_RawBit;this._square_detect=new FLARSquareContourDetector(c),this._callback=new FLARSingleIdMarkerDetectCB(a,d),this._transmat=new NyARTransMat(a),this._bin_raster=new FLARBinRaster(c.w,c.h),this._data_current=d.createDataInstance(),this._tobin_filter=new FLARRasterFilter_Threshold(110),this._threshold_detect=new FLARRasterThresholdAnalyzer_SlidePTile(15,4),this._offset=new NyARRectOffset,this._offset.setSquare(b)},detectMarkerLite:function(a,b){if(!this._bin_raster.getSize().isEqualSize_int(a.getSize().w,a.getSize().h))throw new FLARException;return this._tobin_filter.setThreshold(b),this._tobin_filter.doFilter(a,this._bin_raster),this._callback.init(this._bin_raster,this._is_active?this._data_current:null),this._square_detect.detectMarkerCB(this._bin_raster,this._callback),null==this._callback.marker_data?(this._is_active=!1,!1):(this._is_active=!0,this._data_current.copyFrom(this._callback.marker_data),!0)},getIdMarkerData:function(){var a=new FLARIdMarkerData;return a.copyFrom(this._callback.marker_data),a},getDirection:function(){return this._callback.direction},getTransformMatrix:function(a){this._is_continue?this._transmat.transMatContinue(this._callback.square,this._offset,a):this._transmat.transMat(this._callback.square,this._offset,a)},setContinueMode:function(a){this._is_continue=a}}),FLARIdMarkerDataEncoder_RawBit=ASKlass("FLARIdMarkerDataEncoder_RawBit",{_DOMAIN_ID:0,_mod_data:new IntVector([7,31,127,511,2047,4095]),encode:function(a,b){var c=b;if(null==c)throw new FLARException('type of o_dest must be "FLARIdMarkerData"');if(a.ctrl_domain!=this._DOMAIN_ID)return!1;c.setCheck(a.check),c.setControlDomain(a.ctrl_domain),c.setControlMask(a.ctrl_mask),c.setModel(a.model);var d=toInt(2*a.model-1);c.setDataDotLength(d);var e=toInt(d*d/8)+1;c.setPacketLength(e);for(var f=0,g=0;e>g;g++)c.setPacketData(g,a.data[g]),f+=a.data[g];return f%=this._mod_data[a.model-2],a.check!=f?!1:!0},createDataInstance:function(){return new FLARIdMarkerData}}),SingleARMarkerProcesser=ASKlass("SingleARMarkerProcesser",{tag:null,_lost_delay_count:0,_lost_delay:5,_square_detect:null,_transmat:null,_offset:null,_threshold:110,_bin_raster:null,_tobin_filter:null,_current_arcode_index:-1,_threshold_detect:null,SingleARMarkerProcesser:function(){},_initialized:!1,initInstance:function(a,b){NyAS3Utils.assert(0==this._initialized);var c=a.getScreenSize();this._square_detect=new NyARSquareContourDetector_Rle(c),this._transmat=new NyARTransMat(a),this._tobin_filter=new NyARRasterFilter_ARToolkitThreshold(110,b),this._bin_raster=new NyARBinRaster(c.w,c.h),this._threshold_detect=new NyARRasterThresholdAnalyzer_SlidePTile(15,b,4),this._initialized=!0,this._detectmarker_cb=new DetectSquareCB_1(a),this._offset=new NyARRectOffset},setARCodeTable:function(a,b,c){-1!=this._current_arcode_index&&this.reset(!0),this._detectmarker_cb.setNyARCodeTable(a,b),this._offset.setSquare(c)},reset:function(a){-1!=this._current_arcode_index&&0==a&&this.onLeaveHandler(),this._current_arcode_index=-1},_detectmarker_cb:null,detectMarker:function(a){NyAS3Utils.assert(this._bin_raster.getSize().isEqualSize_int(a.getSize().w,a.getSize().h)),this._tobin_filter.setThreshold(this._threshold),this._tobin_filter.doFilter(a,this._bin_raster),this._detectmarker_cb.init(a,this._current_arcode_index),this._square_detect.detectMarkerCB(this._bin_raster,this._detectmarker_cb);var b=updateStatus(this._detectmarker_cb.square,this._detectmarker_cb.code_index);if(!b){var c=this._threshold_detect.analyzeRaster(a);this._threshold=(this._threshold+c)/2}},setConfidenceThreshold:function(a,b){this._detectmarker_cb.cf_threshold_exist=b,this._detectmarker_cb.cf_threshold_new=a},__NyARSquare_result:new NyARTransMatResult,updateStatus:function(a,b){var c=this.__NyARSquare_result;if(this._current_arcode_index<0)return 0>b?!1:(this._current_arcode_index=b,this.onEnterHandler(b),this._transmat.transMat(a,this._offset,c),this.onUpdateHandler(a,c),this._lost_delay_count=0,!0);if(0>b)return this._lost_delay_count++,this._lost_delay<this._lost_delay_count&&(this._current_arcode_index=-1,this.onLeaveHandler()),!1;if(b==this._current_arcode_index)return this._transmat.transMatContinue(a,this._offset,c),this.onUpdateHandler(a,c),this._lost_delay_count=0,!0;throw new NyARException},onEnterHandler:function(a){throw new NyARException("onEnterHandler not implemented.")},onLeaveHandler:function(){throw new NyARException("onLeaveHandler not implemented.")},onUpdateHandler:function(a,b){throw new NyARException("onUpdateHandler not implemented.")}}),DetectSquareCB_1=ASKlass("DetectSquareCB",NyARSquareContourDetector_IDetectMarkerCallback,{square:new NyARSquare,confidence:0,code_index:-1,cf_threshold_new:.5,cf_threshold_exist:.3,_ref_raster:null,_inst_patt:null,_deviation_data:null,_match_patt:null,__detectMarkerLite_mr:new NyARMatchPattResult,_coordline:null,DetectSquareCB:function(a){this._match_patt=null,this._coordline=new NyARCoord2Linear(a.getScreenSize(),a.getDistortionFactor())},setNyARCodeTable:function(a,b){this._deviation_data=new NyARMatchPattDeviationColorData(b,b),this._inst_patt=new NyARColorPatt_Perspective_O2(b,b,4,25),this._match_patt=new Array(a.length);for(var c=0;c<a.length;c++)this._match_patt[c]=new NyARMatchPatt_Color_WITHOUT_PCA(a[c])},__tmp_vertex:NyARIntPoint2d.createArray(4),_target_id:0,init:function(a,b){this._ref_raster=a,this._target_id=b,this.code_index=-1,this.confidence=Number.MIN_VALUE},onSquareDetect:function(a,b,c,d,e){if(null!=this._match_patt){var f=this.__tmp_vertex;if(f[0].x=b[e[0]],f[0].y=c[e[0]],f[1].x=b[e[1]],f[1].y=c[e[1]],f[2].x=b[e[2]],f[2].y=c[e[2]],f[3].x=b[e[3]],f[3].y=c[e[3]],this._inst_patt.pickFromRaster(this._ref_raster,f)){this._deviation_data.setRaster(this._inst_patt);var g,h=this.__detectMarkerLite_mr,i=0,j=0,k=0;for(g=0;g<this._match_patt.length;g++){this._match_patt[g].evaluate(this._deviation_data,h);var l=h.confidence;l>k&&(i=g,k=l,j=h.direction)}if(-1==this._target_id){if(k<this.cf_threshold_new)return;if(this.confidence>k)return;this.code_index=i}else{if(i!=this._target_id)return;if(k<this.cf_threshold_exist)return;if(this.confidence>k)return;this.code_index=this._target_id}this.confidence=k;var m=this.square;for(g=0;4>g;g++){var n=(g+4-j)%4;this._coordline.coord2Line(e[n],e[(n+1)%4],b,c,d,m.line[g])}for(g=0;4>g;g++)if(!NyARLinear.crossPos(m.line[g],m.line[(g+3)%4],m.sqvertex[g]))throw new NyARException}}}}),SingleNyIdMarkerProcesser=ASKlass("SingleNyIdMarkerProcesser",{tag:null,_lost_delay_count:0,_lost_delay:5,_square_detect:null,_transmat:null,_offset:null,_is_active:null,_current_threshold:110,_bin_raster:null,_tobin_filter:null,_callback:null,_data_current:null,SingleNyIdMarkerProcesser:function(){},_initialized:!1,initInstance:function(a,b,c,d){NyAS3Utils.assert(0==this._initialized);var e=a.getScreenSize();this._square_detect=new NyARSquareContourDetector_Rle(e),this._transmat=new NyARTransMat(a),this._callback=new DetectSquareCB_2(a,b),this._bin_raster=new NyARBinRaster(e.w,e.h),this._data_current=b.createDataInstance(),this._tobin_filter=new NyARRasterFilter_ARToolkitThreshold(110,d),this._threshold_detect=new NyARRasterThresholdAnalyzer_SlidePTile(15,d,4),this._initialized=!0,this._is_active=!1,this._offset=new NyARRectOffset,this._offset.setSquare(c)},setMarkerWidth:function(a){this._offset.setSquare(a)},reset:function(a){0==a&&this._is_active&&this.onLeaveHandler(),this._is_active=!1},detectMarker:function(a){if(!this._bin_raster.getSize().isEqualSize_int(a.getSize().w,a.getSize().h))throw new NyARException;this._tobin_filter.setThreshold(this._current_threshold),this._tobin_filter.doFilter(a,this._bin_raster),this._callback.init(a,this._is_active?this._data_current:null),this._square_detect.detectMarkerCB(this._bin_raster,this._callback);var b=updateStatus(this._callback.square,this._callback.marker_data);if(b)this._current_threshold=(this._current_threshold+this._callback.threshold)/2;else{var c=this._threshold_detect.analyzeRaster(a);this._current_threshold=(this._current_threshold+c)/2}},_threshold_detect:null,__NyARSquare_result:new NyARTransMatResult,updateStatus:function(a,b){var c=!1,d=this.__NyARSquare_result;if(this._is_active)if(null==b)this._lost_delay_count++,this._lost_delay<this._lost_delay_count&&(this.onLeaveHandler(),this._is_active=!1);else{if(!this._data_current.isEqual(b))throw new NyARException;this._transmat.transMatContinue(a,this._offset,d),this.onUpdateHandler(a,d),this._lost_delay_count=0,c=!0}else null==b?this._is_active=!1:(this._data_current.copyFrom(b),this.onEnterHandler(this._data_current),this._transmat.transMat(a,this._offset,d),this.onUpdateHandler(a,d),this._lost_delay_count=0,this._is_active=!0,c=!0);return c},onEnterHandler:function(a){throw new NyARException("onEnterHandler not implemented.")},onLeaveHandler:function(){throw new NyARException("onLeaveHandler not implemented.")},onUpdateHandler:function(a,b){throw new NyARException("onUpdateHandler not implemented.")}}),DetectSquareCB_2=ASKlass("DetectSquareCB",NyARSquareContourDetector_IDetectMarkerCallback,{square:new NyARSquare,marker_data:null,threshold:0,_ref_raster:null,_current_data:null,_id_pickup:new NyIdMarkerPickup,_coordline:null,_encoder:null,_data_temp:null,_prev_data:null,DetectSquareCB:function(a,b){this._coordline=new NyARCoord2Linear(a.getScreenSize(),a.getDistortionFactor()),this._data_temp=b.createDataInstance(),this._current_data=b.createDataInstance(),this._encoder=b},__tmp_vertex:NyARIntPoint2d.createArray(4),init:function(a,b){this.marker_data=null,this._prev_data=b,this._ref_raster=a},_marker_param:new NyIdMarkerParam,_marker_data:new NyIdMarkerPattern,onSquareDetect:function(a,b,c,d,e){if(null==this.marker_data){var f=this.__tmp_vertex;f[0].x=b[e[0]],f[0].y=c[e[0]],f[1].x=b[e[1]],f[1].y=c[e[1]],f[2].x=b[e[2]],f[2].y=c[e[2]],f[3].x=b[e[3]],f[3].y=c[e[3]];var g=this._marker_param,h=this._marker_data;if(this._id_pickup.pickFromRaster(this._ref_raster,f,h,g)&&this._encoder.encode(h,this._data_temp)){if(null==this._prev_data)this._current_data.copyFrom(this._data_temp);else if(!this._prev_data.isEqual(this._data_temp))return;var i,j=this.square;for(i=0;4>i;i++){var k=(i+4-g.direction)%4;this._coordline.coord2Line(e[k],e[(k+1)%4],b,c,d,j.line[i])}for(i=0;4>i;i++)if(!NyARLinear.crossPos(j.line[i],j.line[(i+3)%4],j.sqvertex[i]))throw new NyARException;this.threshold=g.threshold,this.marker_data=this._current_data}}}}),TransformedBitmapPickup=ASKlass("TransformedBitmapPickup",NyARColorPatt_Perspective_O2,{_work_points:NyARIntPoint2d.createArray(4),_ref_perspective:null,TransformedBitmapPickup:function(a,b,c,d){NyARColorPatt_Perspective_O2.initialize.call(this,b,c,d,0),this._ref_perspective=a},pickupImage2d:function(a,b,c,d,e,f){var g,h,i,j,k;g=this._ref_perspective.m00,h=this._ref_perspective.m01,i=this._ref_perspective.m02,j=this._ref_perspective.m11,k=this._ref_perspective.m12;var l,m,n,o,p,q,r=this._work_points,s=f.m00,t=f.m10,u=f.m20;return l=f.m01*c+f.m03,m=f.m11*c+f.m13,n=f.m21*c+f.m23,o=s*b+l,p=t*b+m,q=u*b+n,r[0].x=toInt((o*g+p*h+q*i)/q),r[0].y=toInt((p*j+q*k)/q),o=s*d+l,p=t*d+m,q=u*d+n,r[1].x=toInt((o*g+p*h+q*i)/q),r[1].y=toInt((p*j+q*k)/q),l=f.m01*e+f.m03,m=f.m11*e+f.m13,n=f.m21*e+f.m23,o=s*d+l,p=t*d+m,q=u*d+n,r[2].x=toInt((o*g+p*h+q*i)/q),r[2].y=toInt((p*j+q*k)/q),o=s*b+l,p=t*b+m,q=u*b+n,r[3].x=toInt((o*g+p*h+q*i)/q),r[3].y=toInt((p*j+q*k)/q),this.pickFromRaster(a,r)}}),module.exports={NyARRgbRaster_Canvas2D:NyARRgbRaster_Canvas2D,FLARParam:FLARParam,FLARCode:FLARCode,FLARSingleMarkerDetector:FLARSingleMarkerDetector};